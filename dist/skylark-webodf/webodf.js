/**
 * skylark-webodf - A version of webodf.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define([],function(){var webodf_version="0.5.9";function Runtime(){}Runtime.prototype.getVariable=function(e){},Runtime.prototype.toJson=function(e){},Runtime.prototype.fromJson=function(e){},Runtime.prototype.byteArrayFromString=function(e,t){},Runtime.prototype.byteArrayToString=function(e,t){},Runtime.prototype.read=function(e,t,n,o){},Runtime.prototype.readFile=function(e,t,n){},Runtime.prototype.readFileSync=function(e,t){},Runtime.prototype.loadXML=function(e,t){},Runtime.prototype.writeFile=function(e,t,n){},Runtime.prototype.deleteFile=function(e,t){},Runtime.prototype.log=function(e,t){},Runtime.prototype.setTimeout=function(e,t){},Runtime.prototype.clearTimeout=function(e){},Runtime.prototype.libraryPaths=function(){},Runtime.prototype.currentDirectory=function(){},Runtime.prototype.setCurrentDirectory=function(e){},Runtime.prototype.type=function(){},Runtime.prototype.getDOMImplementation=function(){},Runtime.prototype.parseXML=function(e){},Runtime.prototype.exit=function(e){},Runtime.prototype.getWindow=function(){},Runtime.prototype.requestAnimationFrame=function(e){},Runtime.prototype.cancelAnimationFrame=function(e){},Runtime.prototype.assert=function(e,t){};var IS_COMPILED_CODE=!0;function BrowserRuntime(){function e(e){var t,n,o=e.length,r=0;for(t=0;t<o;t+=1)r+=1+(128<(n=e.charCodeAt(t)))+(2048<n),55040<n&&57344>n&&(r+=1,t+=1);return r}function t(e,t,n){var o,r,i=e.length;for(t=new Uint8Array(new ArrayBuffer(t)),n?(t[0]=239,t[1]=187,t[2]=191,r=3):r=0,n=0;n<i;n+=1)128>(o=e.charCodeAt(n))?(t[r]=o,r+=1):2048>o?(t[r]=192|o>>>6,t[r+1]=128|63&o,r+=2):55040>=o||57344<=o?(t[r]=224|o>>>12&15,t[r+1]=128|o>>>6&63,t[r+2]=128|63&o,r+=3):(n+=1,o=65536+(o-55296<<10|e.charCodeAt(n)-56320),t[r]=240|o>>>18&7,t[r+1]=128|o>>>12&63,t[r+2]=128|o>>>6&63,t[r+3]=128|63&o,r+=4);return t}function n(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)o[t]=255&e.charCodeAt(t);return o}function o(e,t){var n;void 0!==t?n=e:t=e,console.log(t),s.enableAlerts&&"alert"===n&&alert(t)}function r(o,r,i){if(0!==i.status||i.responseText)if(200===i.status||0===i.status){if(i.response&&"string"!=typeof i.response)"binary"===r?(i=i.response,i=new Uint8Array(i)):i=String(i.response);else if("binary"===r)if(null!==i.responseBody&&"undefined"!==String(typeof VBArray)){var a=(i=new VBArray(i.responseBody).toArray()).length;for(r=new Uint8Array(new ArrayBuffer(a)),o=0;o<a;o+=1)r[o]=i[o];i=r}else{if((o=i.getResponseHeader("Content-Length"))&&(o=parseInt(o,10)),o&&o!==i.responseText.length)e:{r=!1;var s=e(a=i.responseText);if("number"==typeof o){if(o!==s&&o!==s+3){a=void 0;break e}r=s+3===o,s=o}a=t(a,s,r)}void 0===a&&(a=n(i.responseText)),i=a}else i=i.responseText;i={err:null,data:i}}else i={err:i.responseText||i.statusText,data:null};else i={err:"File "+o+" is empty.",data:null};return i}function i(e,t,n){var o=new XMLHttpRequest;return o.open("GET",e,n),o.overrideMimeType&&("binary"!==t?o.overrideMimeType("text/plain; charset="+t):o.overrideMimeType("text/plain; charset=x-user-defined")),o}function a(e,t,n){var o=i(e,t,!0);o.onreadystatechange=function(){var i;4===o.readyState&&(i=r(e,t,o),n(i.err,i.data))};try{o.send(null)}catch(e){n(e.message,null)}}var s=this;this.byteArrayFromString=function(o,r){var i;return"utf8"===r?i=t(o,e(o),!1):("binary"!==r&&s.log("unknown encoding: "+r),i=n(o)),i},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=a,this.read=function(e,t,n,o){a(e,"binary",function(e,r){var i=null;if(r){if("string"==typeof r)throw"This should not happen.";i=r.subarray(t,t+n)}o(e,i)})},this.readFileSync=function(e,t){var n,o=i(e,t,!1);try{if(o.send(null),(n=r(e,t,o)).err)throw n.err;if(null===n.data)throw"No data read from "+e+"."}catch(e){throw e}return n.data},this.writeFile=function(e,t,n){var o,r=new XMLHttpRequest;r.open("PUT",e,!0),r.onreadystatechange=function(){4===r.readyState&&(0!==r.status||r.responseText?200<=r.status&&300>r.status||0===r.status?n(null):n("Status "+String(r.status)+": "+r.responseText||r.statusText):n("File "+e+" is empty."))},o=t.buffer&&!r.sendAsBinary?t.buffer:s.byteArrayToString(t,"binary");try{r.sendAsBinary?r.sendAsBinary(o):r.send(o)}catch(e){s.log("HUH? "+e+" "+t),n(e.message)}},this.deleteFile=function(e,t){var n=new XMLHttpRequest;n.open("DELETE",e,!0),n.onreadystatechange=function(){4===n.readyState&&(200>n.status&&300<=n.status?t(n.responseText):t(null))},n.send(null)},this.loadXML=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?t(null,n.responseXML):t(n.responseText,null):t("File "+e+" is empty.",null))};try{n.send(null)}catch(e){t(e.message,null)}},this.log=o,this.enableAlerts=!0,this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(){},this.currentDirectory=function(){return""},this.type=function(){return"BrowserRuntime"},this.getDOMImplementation=function(){return window.document.implementation},this.parseXML=function(e){return(new DOMParser).parseFromString(e,"text/xml")},this.exit=function(e){o("Calling exit with code "+String(e)+", but exit() is not implemented.")},this.getWindow=function(){return window},this.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;return t?(t.bind(window),t(e)):setTimeout(e,15)},this.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;t?(t.bind(window),t(e)):clearTimeout(e)}}function NodeJSRuntime(){function e(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)o[t]=e[t];return o}function t(t,n,o){function r(n,r){return n?o(n,null):r?"string"==typeof r?o(n,r):void o(n,e(r)):o("No data for "+t+".",null)}t=a.resolve(s,t),"binary"!==n?i.readFile(t,n,r):i.readFile(t,null,r)}var n,o,r=this,i=require("fs"),a=require("path"),s="";this.byteArrayFromString=function(e,t){var n,o=new Buffer(e,t),r=o.length,i=new Uint8Array(new ArrayBuffer(r));for(n=0;n<r;n+=1)i[n]=o[n];return i},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=t,this.loadXML=function(e,n){t(e,"utf-8",function(t,o){return t?n(t,null):o?void n(null,r.parseXML(o)):n("No data for "+e+".",null)})},this.writeFile=function(e,t,n){t=new Buffer(t),e=a.resolve(s,e),i.writeFile(e,t,"binary",function(e){n(e||null)})},this.deleteFile=function(e,t){e=a.resolve(s,e),i.unlink(e,t)},this.read=function(t,n,o,r){t=a.resolve(s,t),i.open(t,"r+",666,function(t,a){if(t)r(t,null);else{var s=new Buffer(o);i.read(a,s,0,o,n,function(t){i.close(a),r(t,e(s))})}})},this.readFileSync=function(t,n){var o;if(null===(o=i.readFileSync(t,"binary"===n?null:n)))throw"File "+t+" could not be read.";return"binary"===n&&(o=e(o)),o},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&process.stderr.write("\n!!!!! ALERT !!!!!\n"),process.stderr.write(t+"\n"),"alert"===n&&process.stderr.write("!!!!! ALERT !!!!!\n")},this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return[__dirname]},this.setCurrentDirectory=function(e){s=e},this.currentDirectory=function(){return s},this.type=function(){return"NodeJSRuntime"},this.getDOMImplementation=function(){return o},this.parseXML=function(e){return n.parseFromString(e,"text/xml")},this.exit=process.exit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return setTimeout(e,15)},this.cancelAnimationFrame=function(e){clearTimeout(e)},n=new(require("xmldom").DOMParser),o=r.parseXML("<a/>").implementation}function RhinoRuntime(){var e,t,n=this,o={},r=o.javax.xml.parsers.DocumentBuilderFactory.newInstance(),i="";r.setValidating(!1),r.setNamespaceAware(!0),r.setExpandEntityReferences(!1),r.setSchema(null),t=o.org.xml.sax.EntityResolver({resolveEntity:function(e,t){var n=new o.java.io.FileReader(t);return new o.org.xml.sax.InputSource(n)}}),(e=r.newDocumentBuilder()).setEntityResolver(t),this.byteArrayFromString=function(e,t){var n,o=e.length,r=new Uint8Array(new ArrayBuffer(o));for(n=0;n<o;n+=1)r[n]=255&e.charCodeAt(n);return r},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.loadXML=function(t,n){var r=new o.java.io.File(t),i=null;try{i=e.parse(r)}catch(e){return print(e),n(e,null)}n(null,i)},this.readFile=function(e,t,r){i&&(e=i+"/"+e);var a=new o.java.io.File(e),s="binary"===t?"latin1":t;a.isFile()?((e=readFile(e,s))&&"binary"===t&&(e=n.byteArrayFromString(e,"binary")),r(null,e)):r(e+" is not a file.",null)},this.writeFile=function(e,t,n){i&&(e=i+"/"+e),e=new o.java.io.FileOutputStream(e);var r,a=t.length;for(r=0;r<a;r+=1)e.write(t[r]);e.close(),n(null)},this.deleteFile=function(e,t){i&&(e=i+"/"+e);var n=new o.java.io.File(e),r=e+Math.random();r=new o.java.io.File(r);n.rename(r)?(r.deleteOnExit(),t(null)):t("Could not delete "+e)},this.read=function(e,t,n,r){var a;i&&(e=i+"/"+e),a=e;var s="binary";new o.java.io.File(a).isFile()?("binary"===s&&(s="latin1"),a=readFile(a,s)):a=null,a?r(null,this.byteArrayFromString(a.substring(t,t+n),"binary")):r("Cannot read "+e,null)},this.readFileSync=function(e,t){if(!t)return"";var n=readFile(e,t);if(null===n)throw"File could not be read.";return n},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&print("\n!!!!! ALERT !!!!!"),print(t),"alert"===n&&print("!!!!! ALERT !!!!!")},this.assert=Runtime.assert,this.setTimeout=function(e){return e(),0},this.clearTimeout=function(){},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(e){i=e},this.currentDirectory=function(){return i},this.type=function(){return"RhinoRuntime"},this.getDOMImplementation=function(){return e.getDOMImplementation()},this.parseXML=function(t){return t=new o.java.io.StringReader(t),t=new o.org.xml.sax.InputSource(t),e.parse(t)},this.exit=quit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return e(),0},this.cancelAnimationFrame=function(){}}Runtime.byteArrayToString=function(e,t){var n;return"utf8"===t?n=function(e){var t,n,o,r,i,a="",s=e.length,l=[];for(t=3<=s&&239===e[0]&&187===e[1]&&191===e[2]?3:0;t<s;t+=1)128>(n=e[t])?l.push(n):(o=e[t+=1],194<=n&&224>n?l.push((31&n)<<6|63&o):(r=e[t+=1],224<=n&&240>n?l.push((15&n)<<12|(63&o)<<6|63&r):(i=e[t+=1],240<=n&&245>n&&(n=(7&n)<<18|(63&o)<<12|(63&r)<<6|63&i,n-=65536,l.push(55296+(n>>10),56320+(1023&n)))))),1e3<=l.length&&(a+=String.fromCharCode.apply(null,l),l.length=0);return a+String.fromCharCode.apply(null,l)}(e):("binary"!==t&&this.log("Unsupported encoding: "+t),n=function(e){var t,n="",o=e.length;for(t=0;t<o;t+=1)n+=String.fromCharCode(255&e[t]);return n}(e)),n},Runtime.getVariable=function(g){try{return eval(g)}catch(e){}},Runtime.toJson=function(e){return JSON.stringify(e)},Runtime.fromJson=function(e){return JSON.parse(e)},Runtime.getFunctionName=function(e){return void 0===e.name?(e=/function\s+(\w+)/.exec(e))&&e[1]:e.name},Runtime.assert=function(e,t){if(!e)throw this.log("alert","ASSERTION FAILED:\n"+t),Error(t)},Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={},g;function makeBase64(){function e(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)o[t]=255&e.charCodeAt(t);return o}function t(e){var t,n,o="",r=e.length-2;for(n=0;n<r;n+=3)o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<16|e[n+1]<<8|e[n+2])>>>18],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t];return n===r+1?(o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<4)>>>6],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],o+="=="):n===r&&(o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<10|e[n+1]<<2)>>>12],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],o+="="),o}function n(e){var t,n,o=(e=e.replace(/[^A-Za-z0-9+\/]+/g,"")).length,r=new Uint8Array(new ArrayBuffer(3*o)),i=e.length%4,a=0;for(t=0;t<o;t+=4)n=(y[e.charAt(t)]||0)<<18|(y[e.charAt(t+1)]||0)<<12|(y[e.charAt(t+2)]||0)<<6|(y[e.charAt(t+3)]||0),r[a]=n>>16,r[a+1]=n>>8&255,r[a+2]=255&n,a+=3;return o=3*o-[0,0,2,1][i],r.subarray(0,o)}function o(e){var t,n,o=e.length,r=0,i=new Uint8Array(new ArrayBuffer(3*o));for(t=0;t<o;t+=1)128>(n=e[t])?i[r++]=n:(2048>n?i[r++]=192|n>>>6:(i[r++]=224|n>>>12&15,i[r++]=128|n>>>6&63),i[r++]=128|63&n);return i.subarray(0,r)}function r(e){var t,n,o,r,i=e.length,a=new Uint8Array(new ArrayBuffer(i)),s=0;for(t=0;t<i;t+=1)128>(n=e[t])?a[s++]=n:(o=e[t+=1],224>n?a[s++]=(31&n)<<6|63&o:(r=e[t+=1],a[s++]=(15&n)<<12|(63&o)<<6|63&r));return a.subarray(0,s)}function i(n){return t(e(n))}function a(e){return String.fromCharCode.apply(String,n(e))}function s(t){return r(e(t))}function l(e){e=r(e);for(var t="",n=0;n<e.length;)t+=String.fromCharCode.apply(String,e.subarray(n,n+45e3)),n+=45e3;return t}function u(e,t,n){var o,r,i,a="";for(i=t;i<n;i+=1)128>(t=255&e.charCodeAt(i))?a+=String.fromCharCode(t):(i+=1,o=255&e.charCodeAt(i),224>t?a+=String.fromCharCode((31&t)<<6|63&o):(i+=1,r=255&e.charCodeAt(i),a+=String.fromCharCode((15&t)<<12|(63&o)<<6|63&r)));return a}function c(e,t){var n="",o=0;1e5>e.length?t(u(e,0,e.length),!0):("string"!=typeof e&&(e=e.slice()),function r(){var i=o+1e5;i>e.length&&(i=e.length),n+=u(e,o,i),i=(o=i)===e.length,t(n,i)&&!i&&runtime.setTimeout(r,0)}())}function d(t){return o(e(t))}function f(e){return String.fromCharCode.apply(String,o(e))}function p(t){return String.fromCharCode.apply(String,o(e(t)))}var m,h,g,b,y=function(e){var t,n,o={};for(t=0,n=e.length;t<n;t+=1)o[e.charAt(t)]=t;return o}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),v=runtime.getWindow();return v&&v.btoa?(g=v.btoa,m=function(e){return g(p(e))}):(g=i,m=function(e){return t(d(e))}),v&&v.atob?(b=v.atob,h=function(e){return u(e=b(e),0,e.length)}):(b=a,h=function(e){return l(n(e))}),core.Base64=function(){return this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=t,this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=n,this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=o,this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=r,this.convertUTF8StringToBase64=i,this.convertBase64ToUTF8String=a,this.convertUTF8StringToUTF16Array=s,this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=l,this.convertUTF8StringToUTF16String=c,this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=d,this.convertUTF16ArrayToUTF8String=f,this.convertUTF16StringToUTF8String=p,this.convertUTF16StringToBase64=m,this.convertBase64ToUTF16String=h,this.fromBase64=a,this.toBase64=i,this.atob=b,this.btoa=g,this.utob=p,this.btou=c,this.encode=m,this.encodeURI=function(e){return m(e).replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/\\=+$/,"")},this.decode=function(e){return h(e.replace(/[\-_]/g,function(e){return"-"===e?"+":"/"}))},this},core.Base64}function createXPathSingleton(){function e(e,t,n){return-1!==e&&(e<t||-1===t)&&(e<n||-1===n)}function t(t){for(var n,o=[],r=0,i=t.length;r<i;){var a=t,s=i,l=o,c="",d=[],f=a.indexOf("[",r),p=a.indexOf("/",r),m=a.indexOf("=",r);if(e(p,f,m)?(c=a.substring(r,p),r=p+1):e(f,p,m)?(c=a.substring(r,f),r=u(a,f,d)):e(m,p,f)?(c=a.substring(r,m),r=m):(c=a.substring(r,s),r=s),l.push({location:c,predicates:d}),r<i&&"="===t[r]){if(2<(n=t.substring(r+1,i)).length&&("'"===n[0]||'"'===n[0]))n=n.slice(1,n.length-1);else try{n=parseInt(n,10)}catch(e){}r=i}}return{steps:o,value:n}}function n(){var e=null,t=!1;this.setNode=function(t){e=t},this.reset=function(){t=!1},this.next=function(){var n=t?null:e;return t=!0,n}}function o(e,t,n){this.reset=function(){e.reset()},this.next=function(){for(var o=e.next();o&&(o.nodeType===Node.ELEMENT_NODE&&(o=o.getAttributeNodeNS(t,n)),!o);)o=e.next();return o}}function r(e,t){var n=e.next(),o=null;this.reset=function(){e.reset(),n=e.next(),o=null},this.next=function(){for(;n;){if(o)if(t&&o.firstChild)o=o.firstChild;else{for(;!o.nextSibling&&o!==n;)o=o.parentNode;o===n?n=e.next():o=o.nextSibling}else do{(o=n.firstChild)||(n=e.next())}while(n&&!o);if(o&&o.nodeType===Node.ELEMENT_NODE)return o}return null}}function i(e,t){this.reset=function(){e.reset()},this.next=function(){for(var n=e.next();n&&!t(n);)n=e.next();return n}}function a(e,t,n){var o=n((t=t.split(":",2))[0]),r=t[1];return new i(e,function(e){return e.localName===r&&e.namespaceURI===o})}function s(e,t,o){var r=new n,a=l(r,t,o),s=t.value;return new i(e,void 0===s?function(e){return r.setNode(e),a.reset(),null!==a.next()}:function(e){return r.setNode(e),a.reset(),!!(e=a.next())&&e.nodeValue===s})}var l,u;return u=function(e,n,o){for(var r=n,i=e.length,a=0;r<i;)"]"===e[r]?0>=--a&&o.push(t(e.substring(n,r))):"["===e[r]&&(0>=a&&(n=r+1),a+=1),r+=1;return r},l=function(e,t,n){var i,l,u,c;for(i=0;i<t.steps.length;i+=1){if(""===(l=(u=t.steps[i]).location))e=new r(e,!1);else if("@"===l[0]){if(!(c=n((l=l.substr(1).split(":",2))[0])))throw"No namespace associated with the prefix "+l[0];e=new o(e,c,l[1])}else"."!==l&&(e=new r(e,!1),-1!==l.indexOf(":")&&(e=a(e,l,n)));for(l=0;l<u.predicates.length;l+=1)e=s(e,c=u.predicates[l],n)}return e},{getODFElementsWithXPath:function(e,o,r){var i=e.ownerDocument,a=[],s=null;if(i&&"function"==typeof i.evaluate)for(s=(r=i.evaluate(o,e,r,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)).iterateNext();null!==s;)s.nodeType===Node.ELEMENT_NODE&&a.push(s),s=r.iterateNext();else{for((a=new n).setNode(e),e=t(o),a=l(a,e,r),e=[],r=a.next();r;)e.push(r),r=a.next();a=e}return a}}}function RootFilter(e,t,n){var o=core.PositionFilter.FilterResult.FILTER_ACCEPT,r=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(i){var a;return i=i.container(),a="string"==typeof e?t[e].getNode():e,n(i)===n(a)?o:r}}webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source",function(){function g(e,t,n){var o,r,i=e+"/manifest.json";runtime.log("Loading manifest: "+i);try{o=runtime.readFileSync(i,"utf-8")}catch(e){if(!n)throw console.log(String(e)),e;return void runtime.log("No loadable manifest found.")}for(r in n=JSON.parse(o))n.hasOwnProperty(r)&&(t[r]={dir:e,deps:n[r]})}function k(e,t,n){var o=[],r={},i={};return e.forEach(function e(a){if(!i[a]&&!n(a)){if(r[a])throw"Circular dependency detected for "+a+".";if(r[a]=!0,!t[a])throw"Missing dependency information for class "+a+".";var s,l=t[a],u=l.deps,c=u.length;for(s=0;s<c;s+=1)e(u[s]);r[a]=!1,i[a]=!0,o.push(l.dir+"/"+a.replace(".","/")+".js")}}),o}function d(e,t){return t+"\n//# sourceURL="+e}function b(b){var f,e;for(f=0;f<b.length;f+=1)e=runtime.readFileSync(b[f],"utf-8"),e=d(b[f],e),eval(e)}function f(e){e=e.split(".");var t,n=p,o=e.length;for(t=0;t<o;t+=1){if(!n.hasOwnProperty(e[t]))return!1;n=n[e[t]]}return!0}var n,p={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(e,t){if(IS_COMPILED_CODE||0===e.length)return t&&t();var o;if(!(o=n)){o=[];var r,i=runtime.libraryPaths();for(runtime.currentDirectory()&&-1===i.indexOf(runtime.currentDirectory())&&g(runtime.currentDirectory(),o,!0),r=0;r<i.length;r+=1)g(i[r],o)}if(0===(e=k(e,n=o,f)).length)return t&&t();if("BrowserRuntime"===runtime.type()&&t){var a,s;for(o=e,i=document.currentScript||document.documentElement.lastChild,r=document.createDocumentFragment(),s=0;s<o.length;s+=1)(a=document.createElement("script")).type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",o[s]),r.appendChild(a);t&&(a.onload=t),i.parentNode.insertBefore(r,i)}else b(e),t&&t()},runtime.loadClass=function(e,t){runtime.loadClasses([e],t)}}(),g=function(e){return e},runtime.getTranslator=function(){return g},runtime.setTranslator=function(e){g=e},runtime.tr=function(e){var t=g(e);return t&&"string"===String(typeof t)?t:e},function(g){function k(d){if(d.length){var b=d[0];runtime.readFile(b,"utf8",function(f,n){function g(){var b;(b=eval(k))&&runtime.exit(b)}var r="",r=b.lastIndexOf("/"),k=n,r=-1!==r?b.substring(0,r):".";runtime.setCurrentDirectory(r),f?(runtime.log(f),runtime.exit(1)):null===k?(runtime.log("No code found for "+b),runtime.exit(1)):g.apply(null,d)})}}g=g?Array.prototype.slice.call(g):[],"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(g):k(g.slice(1))}("undefined"!==String(typeof arguments)&&arguments),core.Async={forEach:function(e,t,n){function o(e){a!==i&&(e?(a=i,n(e)):(a+=1)===i&&n(null))}var r,i=e.length,a=0;for(r=0;r<i;r+=1)t(e[r],o)},destroyAll:function(e,t){!function n(o,r){r?t(r):o<e.length?e[o](function(e){n(o+1,e)}):t()}(0,void 0)}},core.Base64=makeBase64(),core.CSSUnits=function(){var e=this,t={in:1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,n,o){return e*t[o]/t[n]},this.convertMeasure=function(t,n){var o,r;return t&&n&&(o=parseFloat(t),r=t.replace(o.toString(),""),o=e.convert(o,r,n)),o},this.getUnits=function(e){return e.substr(e.length-2,e.length)}},function(){function e(){var e,t,o,r,i,a,s,l,u;return void 0===n&&(a=(t=(e=runtime.getWindow())&&e.document).documentElement,s=t.body,n={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},t&&((r=t.createElement("div")).style.position="absolute",r.style.left="-99999px",r.style.transform="scale(2)",r.style["-webkit-transform"]="scale(2)",i=t.createElement("div"),r.appendChild(i),s.appendChild(r),(e=t.createRange()).selectNode(i),n.rangeBCRIgnoresElementBCR=0===e.getClientRects().length,i.appendChild(t.createTextNode("Rect transform test")),t=i.getBoundingClientRect(),o=e.getBoundingClientRect(),n.unscaledRangeClientRects=2<Math.abs(t.height-o.height),r.style.transform="",r.style["-webkit-transform"]="",t=a.style.overflow,o=s.style.overflow,l=s.style.height,u=s.scrollTop,a.style.overflow="visible",s.style.overflow="visible",s.style.height="200%",s.scrollTop=s.scrollHeight,n.elementBCRIgnoresBodyScroll=e.getBoundingClientRect().top!==i.getBoundingClientRect().top,s.scrollTop=u,s.style.height=l,s.style.overflow=o,a.style.overflow=t,e.detach(),s.removeChild(r),e=Object.keys(n).map(function(e){return e+":"+String(n[e])}).join(", "),runtime.log("Detected browser quirks - "+e))),n}function t(e,t,n){for(e=e?e.firstElementChild:null;e;){if(e.localName===n&&e.namespaceURI===t)return e;e=e.nextElementSibling}return null}var n;core.DomUtilsImpl=function(){function n(e,t){for(var n,o=0;e.parentNode!==t;)runtime.assert(null!==e.parentNode,"parent is null"),e=e.parentNode;for(n=t.firstChild;n!==e;)o+=1,n=n.nextSibling;return o}function o(e,t){return 0>=e.compareBoundaryPoints(Range.START_TO_START,t)&&0<=e.compareBoundaryPoints(Range.END_TO_END,t)}function r(e,t){return 0>=e.compareBoundaryPoints(Range.END_TO_START,t)&&0<=e.compareBoundaryPoints(Range.START_TO_END,t)}function i(e,t){var n=null;return e.nodeType===Node.TEXT_NODE&&(0===e.length?(e.parentNode.removeChild(e),t.nodeType===Node.TEXT_NODE&&(n=t)):(t.nodeType===Node.TEXT_NODE&&(e.appendData(t.data),t.parentNode.removeChild(t)),n=e)),n}function a(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}function s(e,t){return e===t||Boolean(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function l(t,n){return e().unscaledRangeClientRects?t:t/n}var u=null;this.splitBoundaries=function(e){var t,o,r,i,a=[];if(e.startContainer.nodeType===Node.TEXT_NODE||e.endContainer.nodeType===Node.TEXT_NODE){if(o=e.endContainer,r=e.endContainer.nodeType!==Node.TEXT_NODE&&e.endOffset===e.endContainer.childNodes.length,(i=e.endOffset)<(t=e.endContainer).childNodes.length)for(t=t.childNodes.item(i),i=0;t.firstChild;)t=t.firstChild;else for(;t.lastChild;)i=(t=t.lastChild).nodeType===Node.TEXT_NODE?t.textContent.length:t.childNodes.length;if(t===o&&(o=null),e.setEnd(t,i),i=e.endContainer,0!==e.endOffset&&i.nodeType===Node.TEXT_NODE&&(t=i,e.endOffset!==t.length&&(a.push(t.splitText(e.endOffset)),a.push(t))),i=e.startContainer,0!==e.startOffset&&i.nodeType===Node.TEXT_NODE&&(t=i,e.startOffset!==t.length&&(i=t.splitText(e.startOffset),a.push(t),a.push(i),e.setStart(i,0))),null!==o){for(i=e.endContainer;i.parentNode&&i.parentNode!==o;)i=i.parentNode;r=r?o.childNodes.length:n(i,o),e.setEnd(o,r)}}return a},this.containsRange=o,this.rangesIntersect=r,this.rangeIntersection=function(e,t){var n;return r(e,t)&&(n=e.cloneRange(),-1===e.compareBoundaryPoints(Range.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===e.compareBoundaryPoints(Range.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset)),n},this.getNodesInRange=function(e,t,n){var o,r,i=[],a=(a=e.commonAncestorContainer).nodeType===Node.TEXT_NODE?a.parentNode:a;if(n=e.startContainer.ownerDocument.createTreeWalker(a,n,t,!1),e.endContainer.childNodes[e.endOffset-1]?(o=e.endContainer.childNodes[e.endOffset-1],r=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(o=e.endContainer,r=Node.DOCUMENT_POSITION_PRECEDING),e.startContainer.childNodes[e.startOffset])e=e.startContainer.childNodes[e.startOffset],n.currentNode=e;else{var s=e.startContainer;e.startOffset===(s.nodeType===Node.TEXT_NODE?s.length:s.childNodes.length)?(e=e.startContainer,n.currentNode=e,n.lastChild(),e=n.nextNode()):(e=e.startContainer,n.currentNode=e)}if(e){if((e=n.currentNode)!==a)for(e=e.parentNode;e&&e!==a;)t(e)===NodeFilter.FILTER_REJECT&&(n.currentNode=e),e=e.parentNode;switch(t(e=n.currentNode)){case NodeFilter.FILTER_REJECT:for(e=n.nextSibling();!e&&n.parentNode();)e=n.nextSibling();break;case NodeFilter.FILTER_SKIP:e=n.nextNode()}for(;e&&(0===(t=o.compareDocumentPosition(e))||0!=(t&r));)i.push(e),e=n.nextNode()}return i},this.normalizeTextNodes=function(e){e&&e.nextSibling&&(e=i(e,e.nextSibling)),e&&e.previousSibling&&i(e.previousSibling,e)},this.rangeContainsNode=function(e,t){var n,r=t.ownerDocument.createRange(),i=t.ownerDocument.createRange();return r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),i.selectNodeContents(t),n=o(r,i),r.detach(),i.detach(),n},this.mergeIntoParent=a,this.removeUnwantedNodes=function e(t,n){var o,r=t.parentNode,i=t.firstChild,s=n(t);if(s===NodeFilter.FILTER_SKIP)return r;for(;i;)o=i.nextSibling,e(i,n),i=o;return r&&s===NodeFilter.FILTER_REJECT&&a(t),r},this.removeAllChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},this.getElementsByTagNameNS=function(e,t,n){var o=[];for(e=e.getElementsByTagNameNS(t,n),o.length=n=e.length,t=0;t<n;t+=1)o[t]=e.item(t);return o},this.getElementsByTagName=function(e,t){var n,o,r,i=[];for(n=e.getElementsByTagName(t),i.length=r=n.length,o=0;o<r;o+=1)i[o]=n.item(o);return i},this.containsNode=function(e,t){return e===t||e.contains(t)},this.comparePoints=function(e,t,o,r){if(e===o)return r-t;var i=e.compareDocumentPosition(o);return 2===i?i=-1:4===i?i=1:10===i?i=(t=n(e,o))<r?1:-1:i=(r=n(o,e))<t?-1:1,i},this.adaptRangeDifferenceToZoomLevel=l,this.translateRect=function(e,t,n){return{top:l(e.top-t.top,n),left:l(e.left-t.left,n),bottom:l(e.bottom-t.top,n),right:l(e.right-t.left,n),width:l(e.width,n),height:l(e.height,n)}},this.getBoundingClientRect=function(t){var n,o=t.ownerDocument,r=e(),i=o.body;return!1!==r.unscaledRangeClientRects&&!r.rangeBCRIgnoresElementBCR||t.nodeType!==Node.ELEMENT_NODE?(u?n=u:u=n=o.createRange(),(r=n).selectNode(t),r.getBoundingClientRect()):(t=t.getBoundingClientRect(),r.elementBCRIgnoresBodyScroll?{left:t.left+i.scrollLeft,right:t.right+i.scrollLeft,top:t.top+i.scrollTop,bottom:t.bottom+i.scrollTop,width:t.width,height:t.height}:t)},this.mapKeyValObjOntoNode=function(e,t,n){Object.keys(t).forEach(function(o){var r=(i=o.split(":"))[1],i=n(i[0]),a=t[o];i?((r=e.getElementsByTagNameNS(i,r)[0])||(r=e.ownerDocument.createElementNS(i,o),e.appendChild(r)),r.textContent=a):runtime.log("Key ignored: "+o)})},this.removeKeyElementsFromNode=function(e,t,n){t.forEach(function(t){var o=t.split(":"),r=o[1];(o=n(o[0]))?(r=e.getElementsByTagNameNS(o,r)[0])?r.parentNode.removeChild(r):runtime.log("Element for "+t+" not found."):runtime.log("Property Name ignored: "+t)})},this.getKeyValRepresentationOfNode=function(e,t){for(var n,o={},r=e.firstElementChild;r;)(n=t(r.namespaceURI))&&(o[n+":"+r.localName]=r.textContent),r=r.nextElementSibling;return o},this.mapObjOntoNode=function e(t,n,o){Object.keys(n).forEach(function(r){var i,a=(i=r.split(":"))[1],s=o(i[0]),l=typeof(i=n[r]);"object"===l?Object.keys(i).length&&(r=s?t.getElementsByTagNameNS(s,a)[0]||t.ownerDocument.createElementNS(s,r):t.getElementsByTagName(a)[0]||t.ownerDocument.createElement(r),t.appendChild(r),e(r,i,o)):s&&(runtime.assert("number"===l||"string"===l,"attempting to map unsupported type '"+l+"' (key: "+r+")"),t.setAttributeNS(s,r,String(i)))})},this.cloneEvent=function(e){var t=Object.create(null);return Object.keys(e.constructor.prototype).forEach(function(n){t[n]=e[n]}),t.prototype=e.constructor.prototype,t},this.getDirectChild=t,function(e){var t,n;null!==(n=runtime.getWindow())&&(n=-1===(t=n.navigator.appVersion.toLowerCase()).indexOf("chrome")&&(-1!==t.indexOf("applewebkit")||-1!==t.indexOf("safari")),t=-1!==t.indexOf("msie")||-1!==t.indexOf("trident"),n||t)&&(e.containsNode=s)}(this)},core.DomUtils=new core.DomUtilsImpl}(),core.Cursor=function(e,t){function n(e){e.parentNode&&(l.push(e.previousSibling),l.push(e.nextSibling),e.parentNode.removeChild(e))}function o(e,t,n){if(t.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(t),"putCursorIntoTextNode: invalid container");var o=t.parentNode;runtime.assert(Boolean(o),"putCursorIntoTextNode: container without parent"),runtime.assert(0<=n&&n<=t.length,"putCursorIntoTextNode: offset is out of bounds"),0===n?o.insertBefore(e,t):(n!==t.length&&t.splitText(n),o.insertBefore(e,t.nextSibling))}else t.nodeType===Node.ELEMENT_NODE&&t.insertBefore(e,t.childNodes.item(n));l.push(e.previousSibling),l.push(e.nextSibling)}var r,i,a=e.createElementNS("urn:webodf:names:cursor","cursor"),s=e.createElementNS("urn:webodf:names:cursor","anchor"),l=[],u=e.createRange(),c=core.DomUtils;this.getNode=function(){return a},this.getAnchorNode=function(){return s.parentNode?s:a},this.getSelectedRange=function(){return i?(u.setStartBefore(a),u.collapse(!0)):(u.setStartAfter(r?s:a),u.setEndBefore(r?a:s)),u},this.setSelectedRange=function(e,t){u&&u!==e&&u.detach(),u=e,r=!1!==t,(i=e.collapsed)?(n(s),n(a),o(a,e.startContainer,e.startOffset)):(n(s),n(a),o(r?a:s,e.endContainer,e.endOffset),o(r?s:a,e.startContainer,e.startOffset)),l.forEach(c.normalizeTextNodes),l.length=0},this.hasForwardSelection=function(){return r},this.remove=function(){n(a),l.forEach(c.normalizeTextNodes),l.length=0},a.setAttributeNS("urn:webodf:names:cursor","memberId",t),s.setAttributeNS("urn:webodf:names:cursor","memberId",t)},core.Destroyable=function(){},core.Destroyable.prototype.destroy=function(e){},core.EventSource=function(){},core.EventSource.prototype.subscribe=function(e,t){},core.EventSource.prototype.unsubscribe=function(e,t){},core.EventNotifier=function(e){function t(e){runtime.assert(!n.hasOwnProperty(e),'Duplicated event ids: "'+e+'" registered more than once.'),n[e]=[]}var n={};this.emit=function(e,t){var o,r;for(runtime.assert(n.hasOwnProperty(e),'unknown event fired "'+e+'"'),r=n[e],o=0;o<r.length;o+=1)r[o](t)},this.subscribe=function(e,t){runtime.assert(n.hasOwnProperty(e),'tried to subscribe to unknown event "'+e+'"'),n[e].push(t)},this.unsubscribe=function(e,t){var o;runtime.assert(n.hasOwnProperty(e),'tried to unsubscribe from unknown event "'+e+'"'),o=n[e].indexOf(t),runtime.assert(-1!==o,'tried to unsubscribe unknown callback from event "'+e+'"'),-1!==o&&n[e].splice(o,1)},this.register=t,e&&e.forEach(t)},core.ScheduledTask=function(e,t,n){function o(){a&&(n(i),a=!1)}function r(){o(),e.apply(void 0,s),s=null}var i,a=!1,s=[],l=!1;this.trigger=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),a||(a=!0,i=t(r))},this.triggerImmediate=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),r()},this.processRequests=function(){a&&r()},this.cancel=o,this.restart=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),o(),a=!0,i=t(r)},this.destroy=function(e){o(),l=!0,e()}},function(){var e;core.Task={},core.Task.SUPPRESS_MANUAL_PROCESSING=!1,core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||e.performRedraw()},core.Task.createRedrawTask=function(t){return new core.ScheduledTask(t,e.requestRedrawTask,e.cancelRedrawTask)},core.Task.createTimeoutTask=function(e,t){return new core.ScheduledTask(e,function(e){return runtime.setTimeout(e,t)},runtime.clearTimeout)},e=new function(){var e={};this.requestRedrawTask=function(t){var n=runtime.requestAnimationFrame(function(){t(),delete e[n]});return e[n]=t,n},this.performRedraw=function(){Object.keys(e).forEach(function(t){e[t](),runtime.cancelAnimationFrame(parseInt(t,10))}),e={}},this.cancelRedrawTask=function(t){runtime.cancelAnimationFrame(t),delete e[t]}}}(),core.EventSubscriptions=function(){function e(e,t,o){e.subscribe(t,o),n.push({eventSource:e,eventid:t,callback:o})}function t(){var e=[];n.forEach(function(e){e.eventSource.unsubscribe(e.eventid,e.callback)}),n.length=0,Object.keys(r).forEach(function(t){r[t].forEach(function(t){e.push(t.task.destroy)}),delete r[t]}),core.Async.destroyAll(e,function(){}),o=new core.EventNotifier}var n=[],o=new core.EventNotifier,r={},i=0;this.addSubscription=e,this.addFrameSubscription=function(t,n,a){var s,l,u,c;for(r.hasOwnProperty(n)||(r[n]=[]),u=r[n],c=0;c<u.length;c+=1)if(u[c].eventSource===t){s=u[c];break}s||(l="s"+i,i+=1,o.register(l),s={frameEventId:l,eventSource:t,task:core.Task.createRedrawTask(function(){o.emit(l,void 0)})},u.push(s),e(t,n,s.task.trigger)),o.subscribe(s.frameEventId,a)},this.unsubscribeAll=t,this.destroy=function(e){t(),e()}},core.LazyProperty=function(e){var t,n=!1;this.value=function(){return n||(t=e(),n=!0),t},this.reset=function(){n=!1}},core.LoopWatchDog=function(e,t){var n=Date.now(),o=0;this.check=function(){if(e&&Date.now()-n>e)throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<t&&(o+=1)>t)throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}},core.NodeFilterChain=function(e){var t=NodeFilter.FILTER_REJECT,n=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(o){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptNode(o)===t)return t;return n}},core.PositionIterator=function(e,t,n,o){function r(){var e=s.currentNode,t=e.nodeType;l=t===d?e.length-1:t===f?1:0}function i(){if(null===s.previousSibling()){if(!s.parentNode()||s.currentNode===e)return s.firstChild(),!1;l=0}else r();return!0}function a(){var t,n=s.currentNode;if(t=u(n),n!==e)for(n=n.parentNode;n&&n!==e;)u(n)===m&&(s.currentNode=n,t=m),n=n.parentNode;return t===m?(l=s.currentNode.nodeType===d?n.length:1,n=c.nextPosition()):n=t===p||c.nextPosition(),n&&runtime.assert(u(s.currentNode)===p,"moveToAcceptedNode did not result in walker being on an accepted node"),n}var s,l,u,c=this,d=Node.TEXT_NODE,f=Node.ELEMENT_NODE,p=NodeFilter.FILTER_ACCEPT,m=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var t=s.currentNode,n=t.nodeType;if(t===e)return!1;if(0===l&&n===f)null===s.firstChild()&&(l=1);else if(n===d&&l+1<t.length)l+=1;else if(null!==s.nextSibling())l=0;else{if(!s.parentNode())return!1;l=1}return!0},this.previousPosition=function(){var t=!0,n=s.currentNode;return 0===l?t=i():n.nodeType===d?--l:null!==s.lastChild()?r():n===e?t=!1:l=0,t},this.previousNode=i,this.container=function(){var e=s.currentNode,t=e.nodeType;return 0===l&&t!==d&&(e=e.parentNode),e},this.rightNode=function(){var e=s.currentNode,t=e.nodeType;if(t===d&&l===e.length)for(e=e.nextSibling;e&&u(e)!==p;)e=e.nextSibling;else t===f&&1===l&&(e=null);return e},this.leftNode=function(){var e=s.currentNode;if(0===l)for(e=e.previousSibling;e&&u(e)!==p;)e=e.previousSibling;else if(e.nodeType===f)for(e=e.lastChild;e&&u(e)!==p;)e=e.previousSibling;return e},this.getCurrentNode=function(){return s.currentNode},this.unfilteredDomOffset=function(){if(s.currentNode.nodeType===d)return l;var e=0,t=s.currentNode;for(t=1===l?t.lastChild:t.previousSibling;t;)e+=1,t=t.previousSibling;return e},this.getPreviousSibling=function(){var e=s.currentNode,t=s.previousSibling();return s.currentNode=e,t},this.getNextSibling=function(){var e=s.currentNode,t=s.nextSibling();return s.currentNode=e,t},this.setPositionBeforeElement=function(e){return runtime.assert(Boolean(e),"setPositionBeforeElement called without element"),s.currentNode=e,l=0,a()},this.setUnfilteredPosition=function(e,t){return runtime.assert(Boolean(e),"PositionIterator.setUnfilteredPosition called without container"),s.currentNode=e,e.nodeType===d?(l=t,runtime.assert(t<=e.length,"Error in setPosition: "+t+" > "+e.length),runtime.assert(0<=t,"Error in setPosition: "+t+" < 0"),t===e.length&&(s.nextSibling()?l=0:s.parentNode()?l=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):t<e.childNodes.length?(s.currentNode=e.childNodes.item(t),l=0):l=1,a()},this.moveToEnd=function(){s.currentNode=e,l=1},this.moveToEndOfNode=function(e){e.nodeType===d?c.setUnfilteredPosition(e,e.length):(s.currentNode=e,l=1)},this.isBeforeNode=function(){return 0===l},this.getNodeFilter=function(){return u},(u=(n?new function(e){this.acceptNode=function(t){return!t||t.nodeType===d&&0===t.length?m:e.acceptNode(t)}}(n):new function(){this.acceptNode=function(e){return!e||e.nodeType===d&&0===e.length?m:p}}).acceptNode).acceptNode=u,t=t||NodeFilter.SHOW_ALL,runtime.assert(e.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes"),s=e.ownerDocument.createTreeWalker(e,t,u,o),l=0,null===s.firstChild()&&(l=1)},core.PositionFilter=function(){},core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3},core.PositionFilter.prototype.acceptPosition=function(e){},core.PositionFilterChain=function(){var e=[],t=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(o){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptPosition(o)===n)return n;return t},this.addFilter=function(t){e.push(t)}},core.StepDirection={PREVIOUS:1,NEXT:2},core.StepIterator=function(e,t){function n(){u=null,d=c=void 0}function o(){return void 0===d&&(d=e.acceptPosition(t)===f),d}function r(e,o){return n(),t.setUnfilteredPosition(e,o)}function i(){return u||(u=t.container()),u}function a(){return void 0===c&&(c=t.unfilteredDomOffset()),c}function s(){for(n();t.nextPosition();)if(n(),o())return!0;return!1}function l(){for(n();t.previousPosition();)if(n(),o())return!0;return!1}var u,c,d,f=core.PositionFilter.FilterResult.FILTER_ACCEPT,p=core.StepDirection.NEXT;this.isStep=o,this.setPosition=r,this.container=i,this.offset=a,this.nextStep=s,this.previousStep=l,this.advanceStep=function(e){return e===p?s():l()},this.roundToClosestStep=function(){var e,t,n=o();return n||(e=i(),t=a(),(n=l())||(r(e,t),n=s())),n},this.roundToPreviousStep=function(){var e=o();return e||(e=l()),e},this.roundToNextStep=function(){var e=o();return e||(e=s()),e},this.leftNode=function(){return t.leftNode()},this.snapshot=function(){return new core.StepIterator.StepSnapshot(i(),a())},this.restore=function(e){r(e.container,e.offset)}},core.StepIterator.StepSnapshot=function(e,t){this.container=e,this.offset=t},core.Utils=function(){this.hashString=function(e){var t,n,o=0;for(t=0,n=e.length;t<n;t+=1)o=(o<<5)-o+e.charCodeAt(t),o|=0;return o},this.mergeObjects=function(e,t){return Object.keys(t).forEach(function(n){e[n]=function e(t,n){if(n&&Array.isArray(n)){if(t=t||[],!Array.isArray(t))throw"Destination is not an array.";t=t.concat(n.map(function(t){return e(null,t)}))}else if(n&&"object"==typeof n){if("object"!=typeof(t=t||{}))throw"Destination is not an object.";Object.keys(n).forEach(function(o){t[o]=e(t[o],n[o])})}else t=n;return t}(e[n],t[n])}),e}},core.Zip=function(e,t){function n(e,t){var n=a.file(e);n?t(null,n.asUint8Array()):t(e+" not found.",null)}function o(e,t){n(e,function(e,n){if(e||null===n)return t(e,null);var o=runtime.byteArrayToString(n,"utf8");t(null,o)})}function r(e,t){try{e(a.generate({type:"uint8array",compression:"STORE"}))}catch(e){t(e.message)}}function i(e,t){r(function(n){runtime.writeFile(e,n,t)},t)}var a,s=this,l=new core.Base64;this.load=n,this.save=function(e,t,n,o){a.file(e,t,{date:o,compression:n?"DEFLATE":"STORE"})},this.remove=function(e){var t=null!==a.file(e);return a.remove(e),t},this.write=function(t){i(e,t)},this.writeAs=i,this.createByteArray=r,this.loadContentXmlAsFragments=function(e,t){o(e,function(e,n){if(e)return t.rootElementReady(e);t.rootElementReady(null,n,!0)})},this.loadAsString=o,this.loadAsDOM=function(e,t){o(e,function(e,n){if(e||null===n)t(e,null);else{var o=(new DOMParser).parseFromString(n,"text/xml");t(null,o)}})},this.loadAsDataURL=function(e,t,o){n(e,function(e,n){if(e||!n)return o(e,null);var r,i=0;for(t||(t=80===n[1]&&78===n[2]&&71===n[3]?"image/png":255===n[0]&&216===n[1]&&255===n[2]?"image/jpeg":71===n[0]&&73===n[1]&&70===n[2]?"image/gif":""),r="data:"+t+";base64,";i<n.length;)r+=l.convertUTF8ArrayToBase64(n.subarray(i,Math.min(i+45e3,n.length))),i+=45e3;o(null,r)})},this.getEntries=function(){return Object.keys(a.files).map(function(e){return{filename:e,date:a.files[e].date}})},a=new externs.JSZip,null!==t&&runtime.readFile(e,"binary",function(n,o){if("string"==typeof o&&(n="file was read as a string. Should be Uint8Array."),n||!o||0===o.length)t("File '"+e+"' cannot be read. Err: "+(n||"[none]"),s);else try{a.load(o,{checkCRC32:!1}),t(null,s)}catch(e){t(e.message,s)}})},core.SimpleClientRect=null,gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}},gui.SessionConstraints=function(){function e(e){t.hasOwnProperty(e)||(t[e]=!1,n.register(e))}var t={},n=new core.EventNotifier;this.registerConstraint=e,this.subscribe=function(t,o){e(t),n.subscribe(t,o)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.setState=function(e,o){runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]!==o&&(t[e]=o,n.emit(e,o))},this.getState=function(e){return runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]}},gui.BlacklistNamespaceNodeFilter=function(e){var t={},n=NodeFilter.FILTER_REJECT,o=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(e){return!e||t.hasOwnProperty(e.namespaceURI)?n:o},e.forEach(function(e){t[e]=!0})},odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"},function(){var e,t=odf.Namespaces.namespaceMap,n=odf.Namespaces.prefixMap;for(e in t)t.hasOwnProperty(e)&&(n[t[e]]=e)}(),odf.Namespaces.forEachPrefix=function(e){var t,n=odf.Namespaces.namespaceMap;for(t in n)n.hasOwnProperty(t)&&e(t,n[t])},odf.Namespaces.lookupNamespaceURI=function(e){var t=null;return odf.Namespaces.namespaceMap.hasOwnProperty(e)&&(t=odf.Namespaces.namespaceMap[e]),t},odf.Namespaces.lookupPrefix=function(e){var t=odf.Namespaces.prefixMap;return t.hasOwnProperty(e)?t[e]:null},odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI,odf.OdfSchemaImpl=function(){var e=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],t={};this.isTextContainer=function(e,n){return"text"===t[e+":"+n]},this.isField=function(e,n){return"field"===t[e+":"+n]},this.getFields=function(){return e.filter(function(e){return"field"===e[1]}).map(function(e){return e[0]})},e.forEach(function(e){var n=e[1];e=(o=e[0].split(":"))[0];var o=o[1],r=odf.Namespaces.lookupNamespaceURI(e);r?t[r+":"+o]=n:runtime.log("DEBUG: OdfSchema - unknown prefix '"+e+"'")})},odf.OdfSchema=new odf.OdfSchemaImpl,odf.OdfUtilsImpl=function(){function e(e){return"image"===(e&&e.localName)&&e.namespaceURI===D}function t(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&"frame"===e.localName&&e.namespaceURI===D&&"as-char"===e.getAttributeNS(P,"anchor-type")}function n(e){var t;return(t="annotation"===(e&&e.localName)&&e.namespaceURI===odf.Namespaces.officens)||(t="div"===(e&&e.localName)&&"annotationWrapper"===e.className),t}function o(e){return"a"===(e&&e.localName)&&e.namespaceURI===P}function r(e){var t=e&&e.localName;return("p"===t||"h"===t)&&e.namespaceURI===P}function i(e,t){for(e&&void 0!==t&&!r(e)&&e.childNodes.item(t)&&(e=e.childNodes.item(t));e&&!r(e);)e=e.parentNode;return e}function a(e,t){for(;e&&e!==t;){if(e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName)return e;e=e.parentNode}return null}function s(e){return/^[ \t\r\n]+$/.test(e)}function l(e){if(null===e||e.nodeType!==Node.ELEMENT_NODE)return!1;var t=e.localName;return F.isTextContainer(e.namespaceURI,t)||"span"===t&&"webodf-annotationHighlight"===e.className}function u(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&F.isField(e.namespaceURI,e.localName)}function c(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===P&&(n="s"===t||"tab"===t||"line-break"===t)),n}function d(e){return c(e)||u(e)||t(e)||n(e)}function f(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===P&&(n="s"===t)),n}function p(e){return-1!==I.indexOf(e.namespaceURI)}function m(e){for(;null!==e.firstChild&&l(e);)e=e.firstChild;return e}function h(e){for(;null!==e.lastChild&&l(e);)e=e.lastChild;return e}function g(e){for(;!r(e)&&null===e.previousSibling;)e=e.parentNode;return r(e)?null:h(e.previousSibling)}function b(e){for(;!r(e)&&null===e.nextSibling;)e=e.parentNode;return r(e)?null:m(e.nextSibling)}function y(e){for(var t=!1;e;)if(e.nodeType===Node.TEXT_NODE){if(0!==e.length)return!s(e.data.substr(e.length-1,1));e=g(e)}else d(e)?(t=!1===f(e),e=null):e=g(e);return t}function v(e){var t=!1;for(e=e&&m(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!s(e.data)){t=!0;break}if(d(e)){t=!0;break}e=b(e)}return t}function S(e,t){return!!s(e.data.substr(t))&&!v(b(e))}function N(e,t){var n,o=e.data;return!(!s(o[t])||d(e.parentNode))&&(0<t?s(o[t-1])||(n=!0):y(g(e))&&(n=!0),!0===n&&!S(e,t))}function C(e){return(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null}function w(e){return(e=C(e))&&(0>e.value||"%"===e.unit)?null:e}function x(e){return(e=C(e))&&"%"!==e.unit?null:e}function E(e){switch(e.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(e.localName){case"note-body":case"ruby-text":return!1}break;case odf.Namespaces.officens:switch(e.localName){case"annotation":case"binary-data":case"event-listeners":return!1}break;default:switch(e.localName){case"cursor":case"editinfo":return!1}}return!0}function T(e){return Boolean(i(e)&&(!s(e.textContent)||N(e,0)))}function O(e,t){for(;0<t.length&&!k.rangeContainsNode(e,t[0]);)t.shift();for(;0<t.length&&!k.rangeContainsNode(e,t[t.length-1]);)t.pop()}function A(e,t,o){var r;return r=k.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return c(e.parentNode)||u(e.parentNode)||n(e)?t=NodeFilter.FILTER_REJECT:e.nodeType===Node.TEXT_NODE?(o||T(e))&&(t=NodeFilter.FILTER_ACCEPT):d(e)?t=NodeFilter.FILTER_ACCEPT:(E(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||O(e,r),r}function R(e,t,o){for(;e;){if(o(e)){t[0]!==e&&t.unshift(e);break}if(n(e))break;e=e.parentNode}}var P=odf.Namespaces.textns,D=odf.Namespaces.drawns,_=odf.Namespaces.xlinkns,k=core.DomUtils,I=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],F=odf.OdfSchema;this.isImage=e,this.isCharacterFrame=t,this.isInlineRoot=n,this.isTextSpan=function(e){return"span"===(e&&e.localName)&&e.namespaceURI===P},this.isHyperlink=o,this.getHyperlinkTarget=function(e){return e.getAttributeNS(_,"href")||""},this.isParagraph=r,this.getParagraphElement=i,this.getParentAnnotation=a,this.isWithinAnnotation=function(e,t){return Boolean(a(e,t))},this.getAnnotationCreator=function(e){return e.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent},this.isListItem=function(e){return"list-item"===(e&&e.localName)&&e.namespaceURI===P},this.isLineBreak=function(e){return"line-break"===(e&&e.localName)&&e.namespaceURI===P},this.isODFWhitespace=s,this.isGroupingElement=l,this.isFieldElement=u,this.isCharacterElement=c,this.isAnchoredAsCharacterElement=d,this.isSpaceElement=f,this.isODFNode=p,this.hasNoODFContent=function e(t){if(c(t)||u(t))return!1;if(l(t.parentNode)&&t.nodeType===Node.TEXT_NODE)return 0===t.textContent.length;for(t=t.firstChild;t;){if(p(t)||!e(t))return!1;t=t.nextSibling}return!0},this.firstChild=m,this.lastChild=h,this.previousNode=g,this.nextNode=b,this.scanLeftForNonSpace=y,this.lookLeftForCharacter=function(e){var t,n=t=0;return e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=s((t=e.data).substr(n-1,1))?1===n?y(g(e))?2:0:s(t.substr(n-2,1))?0:2:1:d(e)&&(t=1),t},this.lookRightForCharacter=function(e){var t=!1,n=0;return e&&e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=!s(e.data.substr(0,1)):d(e)&&(t=!0),t},this.scanLeftForAnyCharacter=function(e){var t=!1;for(e=e&&h(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!s(e.data)){t=!0;break}if(d(e)){t=!0;break}e=g(e)}return t},this.scanRightForAnyCharacter=v,this.isTrailingWhitespace=S,this.isSignificantWhitespace=N,this.isDowngradableSpaceElement=function(e){return!!f(e)&&(y(g(e))&&v(b(e)))},this.parseLength=C,this.parseNonNegativeLength=w,this.parseFoFontSize=function(e){var t;return(t=(t=C(e))&&(0>=t.value||"%"===t.unit)?null:t)||x(e)},this.parseFoLineHeight=function(e){return w(e)||x(e)},this.isTextContentContainingNode=E,this.getTextNodes=function(e,t){var n;return n=k.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return e.nodeType===Node.TEXT_NODE?T(e)&&(t=NodeFilter.FILTER_ACCEPT):E(e)&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||O(e,n),n},this.getTextElements=A,this.getParagraphElements=function(e){var t;return t=k.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return r(e)?t=NodeFilter.FILTER_ACCEPT:(E(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT),R(e.startContainer,t,r),t},this.getImageElements=function(t){var n;return n=k.getNodesInRange(t,function(t){var n=NodeFilter.FILTER_SKIP;return e(t)&&(n=NodeFilter.FILTER_ACCEPT),n},NodeFilter.SHOW_ELEMENT),R(t.startContainer,n,e),n},this.getHyperlinkElements=function(e){var t=[],n=e.cloneRange();return e.collapsed&&e.endContainer.nodeType===Node.ELEMENT_NODE&&((e=function(e,t){var n=e;if(t<n.childNodes.length-1)n=n.childNodes[t+1];else{for(;!n.nextSibling;)n=n.parentNode;n=n.nextSibling}for(;n.firstChild;)n=n.firstChild;return n}(e.endContainer,e.endOffset)).nodeType===Node.TEXT_NODE&&n.setEnd(e,1)),A(n,!0,!1).forEach(function(e){for(e=e.parentNode;!r(e);){if(o(e)&&-1===t.indexOf(e)){t.push(e);break}e=e.parentNode}}),n.detach(),t},this.getNormalizedFontFamilyName=function(e){return/^(["'])(?:.|[\n\r])*?\1$/.test(e)||(e=e.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(e)&&(e="'"+e.replace(/[ \t\r\n\f]+/g," ")+"'")),e}},odf.OdfUtils=new odf.OdfUtilsImpl,gui.OdfTextBodyNodeFilter=function(){var e=odf.OdfUtils,t=Node.TEXT_NODE,n=NodeFilter.FILTER_REJECT,o=NodeFilter.FILTER_ACCEPT,r=odf.Namespaces.textns;this.acceptNode=function(i){if(i.nodeType===t){if(!e.isGroupingElement(i.parentNode))return n}else if(i.namespaceURI===r&&"tracked-changes"===i.localName)return n;return o}},xmldom.LSSerializerFilter=function(){},xmldom.LSSerializerFilter.prototype.acceptNode=function(e){},odf.OdfNodeFilter=function(){this.acceptNode=function(e){return"http://www.w3.org/1999/xhtml"===e.namespaceURI?NodeFilter.FILTER_SKIP:e.namespaceURI&&e.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},xmldom.XPathIterator=function(){},xmldom.XPathIterator.prototype.next=function(){},xmldom.XPathIterator.prototype.reset=function(){},xmldom.XPath=createXPathSingleton(),odf.StyleInfo=function(){function e(t,n){var o,r,i,s,l,u=0;for((o=a[t.localName])&&(i=o[t.namespaceURI])&&(u=i.length),o=0;o<u;o+=1)s=(r=i[o]).ns,l=r.localname,(r=t.getAttributeNS(s,l))&&t.setAttributeNS(s,y[s]+l,n+r);for(i=t.firstElementChild;i;)e(i,n),i=i.nextElementSibling}function t(e,n){var o,r,i,s,l,u=0;for((o=a[e.localName])&&(i=o[e.namespaceURI])&&(u=i.length),o=0;o<u;o+=1)s=(r=i[o]).ns,l=r.localname,(r=e.getAttributeNS(s,l))&&(r=r.replace(n,""),e.setAttributeNS(s,y[s]+l,r));for(i=e.firstElementChild;i;)t(i,n),i=i.nextElementSibling}function n(e,t){var n,o,r,i,s,l=0;for((n=a[e.localName])&&(r=n[e.namespaceURI])&&(l=r.length),n=0;n<l;n+=1)o=(i=r[n]).ns,s=i.localname,(o=e.getAttributeNS(o,s))&&(t=t||{},i=i.keyname,t.hasOwnProperty(i)?t[i][o]=1:((s={})[o]=1,t[i]=s));return t}function o(e,t){var r;for(n(e,t),r=e.firstChild;r;)r.nodeType===Node.ELEMENT_NODE&&o(r,t),r=r.nextSibling}function r(e,t,n){var o=e+'"'+t,r=n[o];return r||(r=n[o]=new function(e,t,n){this.key=e,this.name=t,this.family=n,this.requires={}}(o,e,t)),r}function i(e,t){var n=function e(t,n,o){var i,s,l,u,c,d=0;if(i=t.getAttributeNS(h,"name"),u=t.getAttributeNS(h,"family"),i&&u&&(n=r(i,u,o)),n)for((i=a[t.localName])&&(l=i[t.namespaceURI])&&(d=l.length),i=0;i<d;i+=1)s=(u=l[i]).ns,c=u.localname,(s=t.getAttributeNS(s,c))&&(u=r(s,u=u.keyname,o),n.requires[u.key]=u);for(t=t.firstElementChild;t;)e(t,n,o),t=t.nextElementSibling;return o}(e,null,{});Object.keys(n).forEach(function(e){e=n[e];var o=t[e.family];o&&o.hasOwnProperty(e.name)&&function e(t,n){var o=n[t.family];o||(o=n[t.family]={}),o[t.name]=1,Object.keys(t.requires).forEach(function(o){e(t.requires[o],n)})}(e,t)})}var a,s=odf.Namespaces.chartns,l=odf.Namespaces.dbns,u=odf.Namespaces.dr3dns,c=odf.Namespaces.drawns,d=odf.Namespaces.formns,f=odf.Namespaces.numberns,p=odf.Namespaces.officens,m=odf.Namespaces.presentationns,h=odf.Namespaces.stylens,g=odf.Namespaces.tablens,b=odf.Namespaces.textns,y={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},v={text:[{ens:h,en:"tab-stop",ans:h,a:"leader-text-style"},{ens:h,en:"drop-cap",ans:h,a:"style-name"},{ens:b,en:"notes-configuration",ans:b,a:"citation-body-style-name"},{ens:b,en:"notes-configuration",ans:b,a:"citation-style-name"},{ens:b,en:"a",ans:b,a:"style-name"},{ens:b,en:"alphabetical-index",ans:b,a:"style-name"},{ens:b,en:"linenumbering-configuration",ans:b,a:"style-name"},{ens:b,en:"list-level-style-number",ans:b,a:"style-name"},{ens:b,en:"ruby-text",ans:b,a:"style-name"},{ens:b,en:"span",ans:b,a:"style-name"},{ens:b,en:"a",ans:b,a:"visited-style-name"},{ens:h,en:"text-properties",ans:h,a:"text-line-through-text-style"},{ens:b,en:"alphabetical-index-source",ans:b,a:"main-entry-style-name"},{ens:b,en:"index-entry-bibliography",ans:b,a:"style-name"},{ens:b,en:"index-entry-chapter",ans:b,a:"style-name"},{ens:b,en:"index-entry-link-end",ans:b,a:"style-name"},{ens:b,en:"index-entry-link-start",ans:b,a:"style-name"},{ens:b,en:"index-entry-page-number",ans:b,a:"style-name"},{ens:b,en:"index-entry-span",ans:b,a:"style-name"},{ens:b,en:"index-entry-tab-stop",ans:b,a:"style-name"},{ens:b,en:"index-entry-text",ans:b,a:"style-name"},{ens:b,en:"index-title-template",ans:b,a:"style-name"},{ens:b,en:"list-level-style-bullet",ans:b,a:"style-name"},{ens:b,en:"outline-level-style",ans:b,a:"style-name"}],paragraph:[{ens:c,en:"caption",ans:c,a:"text-style-name"},{ens:c,en:"circle",ans:c,a:"text-style-name"},{ens:c,en:"connector",ans:c,a:"text-style-name"},{ens:c,en:"control",ans:c,a:"text-style-name"},{ens:c,en:"custom-shape",ans:c,a:"text-style-name"},{ens:c,en:"ellipse",ans:c,a:"text-style-name"},{ens:c,en:"frame",ans:c,a:"text-style-name"},{ens:c,en:"line",ans:c,a:"text-style-name"},{ens:c,en:"measure",ans:c,a:"text-style-name"},{ens:c,en:"path",ans:c,a:"text-style-name"},{ens:c,en:"polygon",ans:c,a:"text-style-name"},{ens:c,en:"polyline",ans:c,a:"text-style-name"},{ens:c,en:"rect",ans:c,a:"text-style-name"},{ens:c,en:"regular-polygon",ans:c,a:"text-style-name"},{ens:p,en:"annotation",ans:c,a:"text-style-name"},{ens:d,en:"column",ans:d,a:"text-style-name"},{ens:h,en:"style",ans:h,a:"next-style-name"},{ens:g,en:"body",ans:g,a:"paragraph-style-name"},{ens:g,en:"even-columns",ans:g,a:"paragraph-style-name"},{ens:g,en:"even-rows",ans:g,a:"paragraph-style-name"},{ens:g,en:"first-column",ans:g,a:"paragraph-style-name"},{ens:g,en:"first-row",ans:g,a:"paragraph-style-name"},{ens:g,en:"last-column",ans:g,a:"paragraph-style-name"},{ens:g,en:"last-row",ans:g,a:"paragraph-style-name"},{ens:g,en:"odd-columns",ans:g,a:"paragraph-style-name"},{ens:g,en:"odd-rows",ans:g,a:"paragraph-style-name"},{ens:b,en:"notes-configuration",ans:b,a:"default-style-name"},{ens:b,en:"alphabetical-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"bibliography-entry-template",ans:b,a:"style-name"},{ens:b,en:"h",ans:b,a:"style-name"},{ens:b,en:"illustration-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"index-source-style",ans:b,a:"style-name"},{ens:b,en:"object-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"p",ans:b,a:"style-name"},{ens:b,en:"table-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"table-of-content-entry-template",ans:b,a:"style-name"},{ens:b,en:"table-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"user-index-entry-template",ans:b,a:"style-name"},{ens:h,en:"page-layout-properties",ans:h,a:"register-truth-ref-style-name"}],chart:[{ens:s,en:"axis",ans:s,a:"style-name"},{ens:s,en:"chart",ans:s,a:"style-name"},{ens:s,en:"data-label",ans:s,a:"style-name"},{ens:s,en:"data-point",ans:s,a:"style-name"},{ens:s,en:"equation",ans:s,a:"style-name"},{ens:s,en:"error-indicator",ans:s,a:"style-name"},{ens:s,en:"floor",ans:s,a:"style-name"},{ens:s,en:"footer",ans:s,a:"style-name"},{ens:s,en:"grid",ans:s,a:"style-name"},{ens:s,en:"legend",ans:s,a:"style-name"},{ens:s,en:"mean-value",ans:s,a:"style-name"},{ens:s,en:"plot-area",ans:s,a:"style-name"},{ens:s,en:"regression-curve",ans:s,a:"style-name"},{ens:s,en:"series",ans:s,a:"style-name"},{ens:s,en:"stock-gain-marker",ans:s,a:"style-name"},{ens:s,en:"stock-loss-marker",ans:s,a:"style-name"},{ens:s,en:"stock-range-line",ans:s,a:"style-name"},{ens:s,en:"subtitle",ans:s,a:"style-name"},{ens:s,en:"title",ans:s,a:"style-name"},{ens:s,en:"wall",ans:s,a:"style-name"}],section:[{ens:b,en:"alphabetical-index",ans:b,a:"style-name"},{ens:b,en:"bibliography",ans:b,a:"style-name"},{ens:b,en:"illustration-index",ans:b,a:"style-name"},{ens:b,en:"index-title",ans:b,a:"style-name"},{ens:b,en:"object-index",ans:b,a:"style-name"},{ens:b,en:"section",ans:b,a:"style-name"},{ens:b,en:"table-of-content",ans:b,a:"style-name"},{ens:b,en:"table-index",ans:b,a:"style-name"},{ens:b,en:"user-index",ans:b,a:"style-name"}],ruby:[{ens:b,en:"ruby",ans:b,a:"style-name"}],table:[{ens:l,en:"query",ans:l,a:"style-name"},{ens:l,en:"table-representation",ans:l,a:"style-name"},{ens:g,en:"background",ans:g,a:"style-name"},{ens:g,en:"table",ans:g,a:"style-name"}],"table-column":[{ens:l,en:"column",ans:l,a:"style-name"},{ens:g,en:"table-column",ans:g,a:"style-name"}],"table-row":[{ens:l,en:"query",ans:l,a:"default-row-style-name"},{ens:l,en:"table-representation",ans:l,a:"default-row-style-name"},{ens:g,en:"table-row",ans:g,a:"style-name"}],"table-cell":[{ens:l,en:"column",ans:l,a:"default-cell-style-name"},{ens:g,en:"table-column",ans:g,a:"default-cell-style-name"},{ens:g,en:"table-row",ans:g,a:"default-cell-style-name"},{ens:g,en:"body",ans:g,a:"style-name"},{ens:g,en:"covered-table-cell",ans:g,a:"style-name"},{ens:g,en:"even-columns",ans:g,a:"style-name"},{ens:g,en:"covered-table-cell",ans:g,a:"style-name"},{ens:g,en:"even-columns",ans:g,a:"style-name"},{ens:g,en:"even-rows",ans:g,a:"style-name"},{ens:g,en:"first-column",ans:g,a:"style-name"},{ens:g,en:"first-row",ans:g,a:"style-name"},{ens:g,en:"last-column",ans:g,a:"style-name"},{ens:g,en:"last-row",ans:g,a:"style-name"},{ens:g,en:"odd-columns",ans:g,a:"style-name"},{ens:g,en:"odd-rows",ans:g,a:"style-name"},{ens:g,en:"table-cell",ans:g,a:"style-name"}],graphic:[{ens:u,en:"cube",ans:c,a:"style-name"},{ens:u,en:"extrude",ans:c,a:"style-name"},{ens:u,en:"rotate",ans:c,a:"style-name"},{ens:u,en:"scene",ans:c,a:"style-name"},{ens:u,en:"sphere",ans:c,a:"style-name"},{ens:c,en:"caption",ans:c,a:"style-name"},{ens:c,en:"circle",ans:c,a:"style-name"},{ens:c,en:"connector",ans:c,a:"style-name"},{ens:c,en:"control",ans:c,a:"style-name"},{ens:c,en:"custom-shape",ans:c,a:"style-name"},{ens:c,en:"ellipse",ans:c,a:"style-name"},{ens:c,en:"frame",ans:c,a:"style-name"},{ens:c,en:"g",ans:c,a:"style-name"},{ens:c,en:"line",ans:c,a:"style-name"},{ens:c,en:"measure",ans:c,a:"style-name"},{ens:c,en:"page-thumbnail",ans:c,a:"style-name"},{ens:c,en:"path",ans:c,a:"style-name"},{ens:c,en:"polygon",ans:c,a:"style-name"},{ens:c,en:"polyline",ans:c,a:"style-name"},{ens:c,en:"rect",ans:c,a:"style-name"},{ens:c,en:"regular-polygon",ans:c,a:"style-name"},{ens:p,en:"annotation",ans:c,a:"style-name"}],presentation:[{ens:u,en:"cube",ans:m,a:"style-name"},{ens:u,en:"extrude",ans:m,a:"style-name"},{ens:u,en:"rotate",ans:m,a:"style-name"},{ens:u,en:"scene",ans:m,a:"style-name"},{ens:u,en:"sphere",ans:m,a:"style-name"},{ens:c,en:"caption",ans:m,a:"style-name"},{ens:c,en:"circle",ans:m,a:"style-name"},{ens:c,en:"connector",ans:m,a:"style-name"},{ens:c,en:"control",ans:m,a:"style-name"},{ens:c,en:"custom-shape",ans:m,a:"style-name"},{ens:c,en:"ellipse",ans:m,a:"style-name"},{ens:c,en:"frame",ans:m,a:"style-name"},{ens:c,en:"g",ans:m,a:"style-name"},{ens:c,en:"line",ans:m,a:"style-name"},{ens:c,en:"measure",ans:m,a:"style-name"},{ens:c,en:"page-thumbnail",ans:m,a:"style-name"},{ens:c,en:"path",ans:m,a:"style-name"},{ens:c,en:"polygon",ans:m,a:"style-name"},{ens:c,en:"polyline",ans:m,a:"style-name"},{ens:c,en:"rect",ans:m,a:"style-name"},{ens:c,en:"regular-polygon",ans:m,a:"style-name"},{ens:p,en:"annotation",ans:m,a:"style-name"}],"drawing-page":[{ens:c,en:"page",ans:c,a:"style-name"},{ens:m,en:"notes",ans:c,a:"style-name"},{ens:h,en:"handout-master",ans:c,a:"style-name"},{ens:h,en:"master-page",ans:c,a:"style-name"}],"list-style":[{ens:b,en:"list",ans:b,a:"style-name"},{ens:b,en:"numbered-paragraph",ans:b,a:"style-name"},{ens:b,en:"list-item",ans:b,a:"style-override"},{ens:h,en:"style",ans:h,a:"list-style-name"}],data:[{ens:h,en:"style",ans:h,a:"data-style-name"},{ens:h,en:"style",ans:h,a:"percentage-data-style-name"},{ens:m,en:"date-time-decl",ans:h,a:"data-style-name"},{ens:b,en:"creation-date",ans:h,a:"data-style-name"},{ens:b,en:"creation-time",ans:h,a:"data-style-name"},{ens:b,en:"database-display",ans:h,a:"data-style-name"},{ens:b,en:"date",ans:h,a:"data-style-name"},{ens:b,en:"editing-duration",ans:h,a:"data-style-name"},{ens:b,en:"expression",ans:h,a:"data-style-name"},{ens:b,en:"meta-field",ans:h,a:"data-style-name"},{ens:b,en:"modification-date",ans:h,a:"data-style-name"},{ens:b,en:"modification-time",ans:h,a:"data-style-name"},{ens:b,en:"print-date",ans:h,a:"data-style-name"},{ens:b,en:"print-time",ans:h,a:"data-style-name"},{ens:b,en:"table-formula",ans:h,a:"data-style-name"},{ens:b,en:"time",ans:h,a:"data-style-name"},{ens:b,en:"user-defined",ans:h,a:"data-style-name"},{ens:b,en:"user-field-get",ans:h,a:"data-style-name"},{ens:b,en:"user-field-input",ans:h,a:"data-style-name"},{ens:b,en:"variable-get",ans:h,a:"data-style-name"},{ens:b,en:"variable-input",ans:h,a:"data-style-name"},{ens:b,en:"variable-set",ans:h,a:"data-style-name"}],"page-layout":[{ens:m,en:"notes",ans:h,a:"page-layout-name"},{ens:h,en:"handout-master",ans:h,a:"page-layout-name"},{ens:h,en:"master-page",ans:h,a:"page-layout-name"}]},S=xmldom.XPath;this.collectUsedFontFaces=function e(t,n){function o(e){(e=i.getAttributeNS(h,e))&&(t[e]=!0)}var r,i,a=["font-name","font-name-asian","font-name-complex"];for(r=n&&n.firstElementChild;r;)i=r,a.forEach(o),e(t,i),r=r.nextElementSibling},this.changeFontFaceNames=function e(t,n){function o(e){var t=i.getAttributeNS(h,e);t&&n.hasOwnProperty(t)&&i.setAttributeNS(h,"style:"+e,n[t])}var r,i,a=["font-name","font-name-asian","font-name-complex"];for(r=t&&t.firstElementChild;r;)i=r,a.forEach(o),e(i,n),r=r.nextElementSibling},this.UsedStyleList=function(e,t){var n={};this.uses=function(e){var t=e.localName,o=e.getAttributeNS(c,"name")||e.getAttributeNS(h,"name");return e="style"===t?e.getAttributeNS(h,"family"):e.namespaceURI===f?"data":t,!!(e=n[e])&&0<e[o]},o(e,n),t&&i(t,n)},this.getStyleName=function(e,t){var n,o,r=a[t.localName];if(r&&(r=r[t.namespaceURI]))for(o=0;o<r.length;o+=1)if(r[o].keyname===e&&(r=r[o],t.hasAttributeNS(r.ns,r.localname))){n=t.getAttributeNS(r.ns,r.localname);break}return n},this.hasDerivedStyles=function(e,t,n){var o=n.getAttributeNS(h,"name");return n=n.getAttributeNS(h,"family"),!!S.getODFElementsWithXPath(e,'//style:*[@style:parent-style-name="'+o+'"][@style:family="'+n+'"]',t).length},this.prefixStyleNames=function(t,n,o){var r;if(t){for(r=t.firstChild;r;){if(r.nodeType===Node.ELEMENT_NODE){var i=r,a=n,s=i.getAttributeNS(c,"name"),l=void 0;s?l=c:(s=i.getAttributeNS(h,"name"))&&(l=h),l&&i.setAttributeNS(l,y[l]+"name",a+s)}r=r.nextSibling}e(t,n),o&&e(o,n)}},this.removePrefixFromStyleNames=function(e,n,o){var r=new RegExp("^"+n);if(e){for(n=e.firstChild;n;){if(n.nodeType===Node.ELEMENT_NODE){var i=n,a=r,s=i.getAttributeNS(c,"name"),l=void 0;s?l=c:(s=i.getAttributeNS(h,"name"))&&(l=h),l&&(s=s.replace(a,""),i.setAttributeNS(l,y[l]+"name",s))}n=n.nextSibling}t(e,r),o&&t(o,r)}},this.determineStylesForNode=n,a=function(){var e,t,n,o,r,i,a,s,l,u={};for(n in v)if(v.hasOwnProperty(n))for(t=(o=v[n]).length,e=0;e<t;e+=1)s=(r=o[e]).en,l=r.ens,u.hasOwnProperty(s)?i=u[s]:u[s]=i={},i.hasOwnProperty(l)?a=i[l]:i[l]=a=[],a.push({ns:r.ans,localname:r.a,keyname:n});return u}()},"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),xmldom.LSSerializer=function(){function e(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function t(o,r){var i,a="",s=n.filter?n.filter.acceptNode(r):NodeFilter.FILTER_ACCEPT;if(s===NodeFilter.FILTER_ACCEPT&&r.nodeType===Node.ELEMENT_NODE){o.push(),i=o.getQName(r);var l,u,c,d,f=r.attributes,p="";for(l="<"+i,u=f.length,c=0;c<u;c+=1)"http://www.w3.org/2000/xmlns/"!==(d=f.item(c)).namespaceURI&&((n.filter?n.filter.acceptNode(d):NodeFilter.FILTER_ACCEPT)===NodeFilter.FILTER_ACCEPT&&(p+=" "+o.getQName(d)+'="'+(d="string"==typeof d.value?e(d.value):d.value)+'"'));for(c in u=o.getLocalNamespaceDefinitions())u.hasOwnProperty(c)&&((f=u[c])?"xmlns"!==f&&(l+=" xmlns:"+u[c]+'="'+c+'"'):l+=' xmlns="'+c+'"');a+=l+(p+">")}if(s===NodeFilter.FILTER_ACCEPT||s===NodeFilter.FILTER_SKIP){for(s=r.firstChild;s;)a+=t(o,s),s=s.nextSibling;r.nodeValue&&(a+=e(r.nodeValue))}return i&&(a+="</"+i+">",o.pop()),a}var n=this;this.filter=null,this.writeToString=function(e,n){if(!e)return"";var o=new function(e){var t=e||{},n=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}(e),o=[t],r=[n],i=0;this.push=function(){t=o[i+=1]=Object.create(t),n=r[i]=Object.create(n)},this.pop=function(){o.pop(),r.pop(),t=o[--i],n=r[i]},this.getLocalNamespaceDefinitions=function(){return n},this.getQName=function(e){var o,r=e.namespaceURI,i=0;if(!r)return e.localName;if(o=n[r])return o+":"+e.localName;do{if(o||!e.prefix?(o="ns"+i,i+=1):o=e.prefix,t[o]===r)break;if(!t[o]){t[o]=r,n[r]=o;break}o=null}while(null===o);return o+":"+e.localName}}(n);return t(o,e)}},function(){function e(e){var t,n=a.length;for(t=0;t<n;t+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&e.localName===a[t])return t;return-1}function t(e,t){var n=new o.UsedStyleList(e,t),r=new odf.OdfNodeFilter;this.acceptNode=function(e){var o=r.acceptNode(e);return o===NodeFilter.FILTER_ACCEPT&&e.parentNode===t&&e.nodeType===Node.ELEMENT_NODE&&(o=n.uses(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),o}}function n(t,n){if(n){var o,r=e(n),i=t.firstChild;if(-1!==r){for(;i&&!(-1!==(o=e(i))&&o>r);)i=i.nextSibling;t.insertBefore(n,i)}}}var o=new odf.StyleInfo,r=core.DomUtils,i=odf.Namespaces.stylens,a="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),s=Date.now()+"_webodf_",l=new core.Base64;odf.ODFElement=function(){},odf.ODFDocumentElement=function(){},odf.ODFDocumentElement.prototype=new odf.ODFElement,odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement,odf.ODFDocumentElement.prototype.fontFaceDecls=null,odf.ODFDocumentElement.prototype.manifest=null,odf.ODFDocumentElement.prototype.settings=null,odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0",odf.ODFDocumentElement.localName="document",odf.AnnotationElement=function(){},odf.OdfPart=function(e,t,n,o){var r=this;this.size=0,this.type=null,this.name=e,this.container=n,this.url=null,this.mimetype=t,this.onstatereadychange=this.document=null,this.EMPTY=0,this.LOADING=1,this.DONE=2,this.state=this.EMPTY,this.data="",this.load=function(){null!==o&&(this.mimetype=t,o.loadAsDataURL(e,t,function(e,t){e&&runtime.log(e),r.url=t,r.onchange&&r.onchange(r),r.onstatereadychange&&r.onstatereadychange(r)}))}},odf.OdfPart.prototype.load=function(){},odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+l.toBase64(this.data):null},odf.OdfContainer=function e(a,u){function c(e){var t,n,o={},r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,null,!1);for(e=r.nextNode();e;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&("annotation"===e.localName?(t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(o.hasOwnProperty(t)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+t+"'"):o[t]=e):"annotation-end"===e.localName&&((t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?o.hasOwnProperty(t)?(n=o[t]).annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+t+"'"):n.annotationEndElement=e:runtime.log("Warning: annotation end without an annotation start, name: '"+t+"'"):runtime.log("Warning: annotation end without a name found"))),e=r.nextNode()}function d(e,t){for(var n=e&&e.firstChild;n;)n.nodeType===Node.ELEMENT_NODE&&n.setAttributeNS("urn:webodf:names:scope","scope",t),n=n.nextSibling}function f(e,t){for(var n=(n=M.rootElement.meta)&&n.firstChild;n&&(n.namespaceURI!==e||n.localName!==t);)n=n.nextSibling;for(n=n&&n.firstChild;n&&n.nodeType!==Node.TEXT_NODE;)n=n.nextSibling;return n?n.data:null}function p(e){var t={};for(e=e.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&e.namespaceURI===i&&"font-face"===e.localName&&(t[e.getAttributeNS(i,"name")]=e),e=e.nextSibling;return t}function m(e,t){var n,o,r,i=null;if(e)for(n=(i=e.cloneNode(!0)).firstElementChild;n;)o=n.nextElementSibling,(r=n.getAttributeNS("urn:webodf:names:scope","scope"))&&r!==t&&i.removeChild(n),n=o;return i}function h(e,t){var n,r,a,s=null,l={};if(e)for(t.forEach(function(e){o.collectUsedFontFaces(l,e)}),n=(s=e.cloneNode(!0)).firstElementChild;n;)r=n.nextElementSibling,a=n.getAttributeNS(i,"name"),l[a]||s.removeChild(n),n=r;return s}function g(e){var t,n=M.rootElement.ownerDocument;if(e){!function e(t){for(var n,o=t.firstChild;o;)n=o.nextSibling,o.nodeType===Node.ELEMENT_NODE?e(o):o.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&t.removeChild(o),o=n}(e.documentElement);try{t=n.importNode(e.documentElement,!0)}catch(e){}}return t}function b(e){M.state=e,M.onchange&&M.onchange(M),M.onstatereadychange&&M.onstatereadychange(M)}function y(e){F=null,M.rootElement=e,e.fontFaceDecls=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),e.styles=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),e.automaticStyles=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),e.masterStyles=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),e.body=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body"),e.meta=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),e.settings=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),e.scripts=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts"),c(e)}function v(t){var i,a=g(t),l=M.rootElement;a&&"document-styles"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI?(l.fontFaceDecls=r.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),n(l,l.fontFaceDecls),i=r.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),l.styles=i||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),n(l,l.styles),i=r.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),l.automaticStyles=i||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),d(l.automaticStyles,"document-styles"),n(l,l.automaticStyles),a=r.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),l.masterStyles=a||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),n(l,l.masterStyles),o.prefixStyleNames(l.automaticStyles,s,l.masterStyles)):b(e.INVALID)}function S(t){var a,s,l,u;if((t=g(t))&&"document-content"===t.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===t.namespaceURI){if(a=M.rootElement,l=r.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),a.fontFaceDecls&&l){var c,f,m,h,y={};for(s=p(u=a.fontFaceDecls),h=p(l),l=l.firstElementChild;l;){if(c=l.nextElementSibling,l.namespaceURI===i&&"font-face"===l.localName)if(f=l.getAttributeNS(i,"name"),s.hasOwnProperty(f)){if(!l.isEqualNode(s[f])){var v=s,S=h,N=0,C=void 0;for(C=m=(m=f).replace(/\d+$/,"");v.hasOwnProperty(C)||S.hasOwnProperty(C);)C=m+(N+=1);m=C,l.setAttributeNS(i,"style:name",m),u.appendChild(l),s[m]=l,delete h[f],y[f]=m}}else u.appendChild(l),s[f]=l,delete h[f];l=c}u=y}else l&&(a.fontFaceDecls=l,n(a,l));if(d(s=r.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),"document-content"),u&&o.changeFontFaceNames(s,u),a.automaticStyles&&s)for(u=s.firstChild;u;)a.automaticStyles.appendChild(u),u=s.firstChild;else s&&(a.automaticStyles=s,n(a,s));if(null===(t=r.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body")))throw"<office:body/> tag is mising.";a.body=t,n(a,a.body)}else b(e.INVALID)}function N(e){var t;(e=g(e))&&"document-meta"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=M.rootElement).meta=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),n(t,t.meta))}function C(e){var t;(e=g(e))&&"document-settings"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=M.rootElement).settings=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),n(t,t.settings))}function w(e){var t;if((e=g(e))&&"manifest"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI)for((t=M.rootElement).manifest=e,e=t.manifest.firstElementChild;e;)"file-entry"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI&&(B[e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),e=e.nextElementSibling}function x(e,t,n){var o;for(e=r.getElementsByTagName(e,t),o=0;o<e.length;o+=1)t=e[o],n.hasOwnProperty(t.namespaceURI)||t.parentNode.removeChild(t)}function E(e){x(e,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0}),x(e,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function T(e){var t,n,o,r=e.firstElementChild,i=[],a=e.attributes,s=a.length;for(t=0;t<s;t+=1)n=(o=a.item(t)).localName.substr(0,2).toLowerCase(),null===o.namespaceURI&&"on"===n&&i.push(o);for(s=i.length,t=0;t<s;t+=1)e.removeAttributeNode(i[t]);for(;r;)T(r),r=r.nextElementSibling}function O(e){var t="";return odf.Namespaces.forEachPrefix(function(e,n){t+=" xmlns:"+e+'="'+n+'"'}),'<?xml version="1.0" encoding="UTF-8"?><office:'+e+" "+t+' office:version="1.2">'}function A(e,t){var n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");return n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",e),n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",t),n}function R(){var e,n,o=odf.Namespaces.namespaceMap,r=new xmldom.LSSerializer,i=O("document-content");return n=m(M.rootElement.automaticStyles,"document-content"),e=h(M.rootElement.fontFaceDecls,[n]),r.filter=new function(e,n){var o=new t(e,n);this.acceptNode=function(e){var t=o.acceptNode(e);return t!==NodeFilter.FILTER_ACCEPT||!e.parentNode||e.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==e.parentNode.localName&&"tab"!==e.parentNode.localName||(t=NodeFilter.FILTER_REJECT),t}}(M.rootElement.body,n),i+=r.writeToString(e,o),i+=r.writeToString(n,o),(i+=r.writeToString(M.rootElement.body,o))+"</office:document-content>"}function P(e,t){var o,i=(o=M.rootElement).meta;i||(o.meta=i=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),n(o,i)),o=i,e&&r.mapKeyValObjOntoNode(o,e,odf.Namespaces.lookupNamespaceURI),t&&r.removeKeyElementsFromNode(o,t,odf.Namespaces.lookupNamespaceURI)}function D(t,n){function o(e,t){var n;t||(t=e),n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t),s[e]=n,s.appendChild(n)}var r=new core.Zip("",null),i="application/vnd.oasis.opendocument."+t+(!0===n?"-template":""),a=runtime.byteArrayFromString(i,"utf8"),s=M.rootElement,l=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t);return r.save("mimetype",a,!1,new Date),o("meta"),o("settings"),o("scripts"),o("fontFaceDecls","font-face-decls"),o("styles"),o("automaticStyles","automatic-styles"),o("masterStyles","master-styles"),o("body"),s.body.appendChild(l),B["/"]=i,B["settings.xml"]="text/xml",B["meta.xml"]="text/xml",B["styles.xml"]="text/xml",B["content.xml"]="text/xml",b(e.DONE),r}function _(){var e,n=new Date,r="";M.rootElement.settings&&M.rootElement.settings.firstElementChild&&(e=new xmldom.LSSerializer,r=O("document-settings"),e.filter=new odf.OdfNodeFilter,r+=e.writeToString(M.rootElement.settings,odf.Namespaces.namespaceMap),r+="</office:document-settings>"),(e=r)?(e=runtime.byteArrayFromString(e,"utf8"),I.save("settings.xml",e,!0,n)):I.remove("settings.xml"),r=runtime.getWindow(),e="WebODF/"+webodf.Version,r&&(e=e+" "+r.navigator.userAgent),P({"meta:generator":e},null),e=runtime.byteArrayFromString(function(){var e=new xmldom.LSSerializer,t=O("document-meta");return e.filter=new odf.OdfNodeFilter,(t+=e.writeToString(M.rootElement.meta,odf.Namespaces.namespaceMap))+"</office:document-meta>"}(),"utf8"),I.save("meta.xml",e,!0,n),e=runtime.byteArrayFromString(function(){var e,n,r,i=odf.Namespaces.namespaceMap,a=new xmldom.LSSerializer,l=O("document-styles");return n=m(M.rootElement.automaticStyles,"document-styles"),r=M.rootElement.masterStyles.cloneNode(!0),e=h(M.rootElement.fontFaceDecls,[r,M.rootElement.styles,n]),o.removePrefixFromStyleNames(n,s,r),a.filter=new t(r,n),l+=a.writeToString(e,i),l+=a.writeToString(M.rootElement.styles,i),l+=a.writeToString(n,i),(l+=a.writeToString(r,i))+"</office:document-styles>"}(),"utf8"),I.save("styles.xml",e,!0,n),e=runtime.byteArrayFromString(R(),"utf8"),I.save("content.xml",e,!0,n),e=runtime.byteArrayFromString(function(){var e,t=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),n=t.documentElement,o=new xmldom.LSSerializer;for(e in B)B.hasOwnProperty(e)&&n.appendChild(A(e,B[e]));return o.filter=new odf.OdfNodeFilter,'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+o.writeToString(t,odf.Namespaces.namespaceMap)}(),"utf8"),I.save("META-INF/manifest.xml",e,!0,n)}function k(e,t){_(),I.writeAs(e,function(e){t(e)})}var I,F,M=this,B={},U="";this.onstatereadychange=u,this.state=this.onchange=null,this.getMetadata=f,this.setRootElement=y,this.getContentElement=function(){var e;if(F||(e=M.rootElement.body,F=r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||r.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet")),!F)throw"Could not find content element in <office:body/>.";return F},this.getDocumentType=function(){var e=M.getContentElement();return e&&e.localName},this.isTemplate=function(){return"-template"===B["/"].substr(-9)},this.setIsTemplate=function(e){var t=B["/"];e!==("-template"===t.substr(-9))&&(t=e?t+"-template":t.substr(0,t.length-9),B["/"]=t,e=runtime.byteArrayFromString(t,"utf8"),I.save("mimetype",e,!1,new Date))},this.getPart=function(e){return new odf.OdfPart(e,B[e],M,I)},this.getPartData=function(e,t){I.load(e,t)},this.setMetadata=P,this.incrementEditingCycles=function(){var e=(e=f(odf.Namespaces.metans,"editing-cycles"))?parseInt(e,10):0;return isNaN(e)&&(e=0),P({"meta:editing-cycles":e+1},null),e+1},this.createByteArray=function(e,t){_(),I.createByteArray(e,t)},this.saveAs=k,this.save=function(e){k(U,e)},this.getUrl=function(){return U},this.setBlob=function(e,t,n){n=l.convertBase64ToByteArray(n),I.save(e,n,!1,new Date),B.hasOwnProperty(e)&&runtime.log(e+" has been overwritten."),B[e]=t},this.removeBlob=function(e){var t=I.remove(e);runtime.assert(t,"file is not found: "+e),delete B[e]},this.state=e.LOADING,this.rootElement=function(e){var t,n=document.createElementNS(e.namespaceURI,e.localName);for(t in e=new e.Type)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName}),a===odf.OdfContainer.DocumentType.TEXT?I=D("text"):a===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?I=D("text",!0):a===odf.OdfContainer.DocumentType.PRESENTATION?I=D("presentation"):a===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?I=D("presentation",!0):a===odf.OdfContainer.DocumentType.SPREADSHEET?I=D("spreadsheet"):a===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?I=D("spreadsheet",!0):(U=a,I=new core.Zip(U,function(t,n){I=n,t?function(t,n){runtime.loadXML(t,function(t,o){if(t)n(t);else if(o){E(o),T(o.documentElement);var r=g(o);r&&"document"===r.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===r.namespaceURI?(y(r),b(e.DONE)):b(e.INVALID)}else n("No DOM was loaded.")})}(U,function(n){t&&(I.error=t+"\n"+n,b(e.INVALID))}):function t(n){var o=n.shift();o?I.loadAsDOM(o.path,function(r,i){i&&(E(i),T(i.documentElement)),o.handler(i),M.state===e.INVALID?r?runtime.log("ERROR: Unable to load "+o.path+" - "+r):runtime.log("ERROR: Unable to load "+o.path):(r&&runtime.log("DEBUG: Unable to load "+o.path+" - "+r),t(n))}):(c(M.rootElement),b(e.DONE))}([{path:"styles.xml",handler:v},{path:"content.xml",handler:S},{path:"meta.xml",handler:N},{path:"settings.xml",handler:C},{path:"META-INF/manifest.xml",handler:w}])}))},odf.OdfContainer.EMPTY=0,odf.OdfContainer.LOADING=1,odf.OdfContainer.DONE=2,odf.OdfContainer.INVALID=3,odf.OdfContainer.SAVING=4,odf.OdfContainer.MODIFIED=5,odf.OdfContainer.getContainer=function(e){return new odf.OdfContainer(e,null)}}(),odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6},gui.AnnotatableCanvas=function(){},gui.AnnotatableCanvas.prototype.refreshSize=function(){},gui.AnnotatableCanvas.prototype.getZoomLevel=function(){},gui.AnnotatableCanvas.prototype.getSizer=function(){},gui.AnnotationViewManager=function(e,t,n,o){function r(e){var t=e.annotationEndElement,n=u.createRange(),o=e.getAttributeNS(odf.Namespaces.officens,"name");t&&(n.setStart(e,e.childNodes.length),n.setEnd(t,0),(e=c.getTextNodes(n,!1)).forEach(function(e){var t;e:{for(t=e.parentNode;t.namespaceURI!==odf.Namespaces.officens||"body"!==t.localName;){if("http://www.w3.org/1999/xhtml"===t.namespaceURI&&"webodf-annotationHighlight"===t.className&&t.getAttribute("annotation")===o){t=!0;break e}t=t.parentNode}t=!1}t||((t=u.createElement("span")).className="webodf-annotationHighlight",t.setAttribute("annotation",o),e.parentNode.replaceChild(t,e),t.appendChild(e))})),n.detach()}function i(t){var o=e.getSizer();t?(n.style.display="inline-block",o.style.paddingRight=d.getComputedStyle(n).width):(n.style.display="none",o.style.paddingRight=0),e.refreshSize()}function a(){var t;for(t=0;t<l.length;t+=1){var o=(u=l[t]).parentNode,r=(c=o.nextElementSibling).nextElementSibling,i=o.parentNode,a=0,s=(a=l[l.indexOf(u)-1],void 0),u=e.getZoomLevel();o.style.left=(n.getBoundingClientRect().left-i.getBoundingClientRect().left)/u+"px",o.style.width=n.getBoundingClientRect().width/u+"px",c.style.width=parseFloat(o.style.left)-30+"px",a?(s=a.parentNode.getBoundingClientRect(),20>=(i.getBoundingClientRect().top-s.bottom)/u?o.style.top=Math.abs(i.getBoundingClientRect().top-s.bottom)/u+20+"px":o.style.top="0px"):o.style.top="0px",r.style.left=c.getBoundingClientRect().width/u+"px";var c=r.style,d=(i=r.getBoundingClientRect().left/u,a=r.getBoundingClientRect().top/u,s=o.getBoundingClientRect().left/u,o.getBoundingClientRect().top/u),f=0,p=0;f=(f=s-i)*f,p=(p=d-a)*p,i=Math.sqrt(f+p);c.width=i+"px",a=Math.asin((o.getBoundingClientRect().top-r.getBoundingClientRect().top)/(u*parseFloat(r.style.width))),r.style.transform="rotate("+a+"rad)",r.style.MozTransform="rotate("+a+"rad)",r.style.WebkitTransform="rotate("+a+"rad)",r.style.msTransform="rotate("+a+"rad)"}}function s(e){var t=l.indexOf(e);"div"===(o=e.parentNode.parentNode).localName&&(o.parentNode.insertBefore(e,o),o.parentNode.removeChild(o)),e=e.getAttributeNS(odf.Namespaces.officens,"name"),e=u.querySelectorAll('span.webodf-annotationHighlight[annotation="'+e+'"]');for(var n,o=0;o<e.length;o+=1){for(n=e.item(o);n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}-1!==t&&l.splice(t,1),0===l.length&&i(!1)}var l=[],u=t.ownerDocument,c=odf.OdfUtils,d=runtime.getWindow();runtime.assert(Boolean(d),"Expected to be run in an environment which has a global window, like a browser."),this.rerenderAnnotations=a,this.rehighlightAnnotations=function(){l.forEach(function(e){r(e)})},this.getMinimumHeightForAnnotationPane=function(){return"none"!==n.style.display&&0<l.length?(l[l.length-1].parentNode.getBoundingClientRect().bottom-n.getBoundingClientRect().top)/e.getZoomLevel()+"px":null},this.addAnnotations=function(e){0!==e.length&&(i(!0),e.forEach(function(e){l.push(e);var t,n=u.createElement("div"),i=u.createElement("div"),a=u.createElement("div"),s=u.createElement("div");n.className="annotationWrapper",n.setAttribute("creator",c.getAnnotationCreator(e)),e.parentNode.insertBefore(n,e),i.className="annotationNote",i.appendChild(e),o&&((t=u.createElement("div")).className="annotationRemoveButton",i.appendChild(t)),a.className="annotationConnector horizontal",s.className="annotationConnector angular",n.appendChild(i),n.appendChild(a),n.appendChild(s),e.annotationEndElement&&r(e)}),l.sort(function(e,t){return 0!=(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1}),a())},this.forgetAnnotation=s,this.forgetAnnotations=function(){for(;l.length;)s(l[0])}},gui.Viewport=function(){},gui.Viewport.prototype.scrollIntoView=function(e,t){},gui.SingleScrollViewport=function(e){this.scrollIntoView=function(t,n){var o,r,i,a;a=e.offsetHeight-e.clientHeight,i=e.offsetWidth-e.clientWidth;var s=e.getBoundingClientRect();t&&s&&(o=s.left+5,r=s.top+5,i=s.right-(i+5),a=s.bottom-(a+5),n||t.top<r?e.scrollTop-=r-t.top:(t.top>a||t.bottom>a)&&(e.scrollTop=t.bottom-t.top<=a-r?e.scrollTop+(t.bottom-a):e.scrollTop+(t.top-r)),t.left<o?e.scrollLeft-=o-t.left:t.right>i&&(e.scrollLeft=t.right-t.left<=i-o?e.scrollLeft+(t.right-i):e.scrollLeft-(o-t.left)))}},function(){function e(t,n,r,i,a){var s,l,u=0;for(l in t)if(t.hasOwnProperty(l)){if(u===r){s=l;break}u+=1}s?n.getPartData(t[s].href,function(l,u){if(l)runtime.log(l);else if(u){var c="@font-face { font-family: "+(t[s].family||s)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+o.convertUTF8ArrayToBase64(u)+') format("truetype"); }';try{i.insertRule(c,i.cssRules.length)}catch(e){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(e)+"\nRule: "+c)}}else runtime.log("missing font data for "+t[s].href);e(t,n,r+1,i,a)}):a&&a()}var t=xmldom.XPath,n=odf.OdfUtils,o=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(o,r){for(var i=o.rootElement.fontFaceDecls;r.cssRules.length;)r.deleteRule(r.cssRules.length-1);if(i){var a,s,l,u,c={};if(i)for(i=t.getODFElementsWithXPath(i,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),a=0;a<i.length;a+=1)l=(s=i[a]).getAttributeNS(odf.Namespaces.stylens,"name"),u=n.getNormalizedFontFamilyName(s.getAttributeNS(odf.Namespaces.svgns,"font-family")),0<(s=t.getODFElementsWithXPath(s,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI)).length&&(s=s[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),c[l]={href:s,family:u});e(c,o,0,r)}}}}(),odf.Formatting=function(){function e(e){return(e=C[e])?S.mergeObjects({},e):{}}function t(){for(var e,t,n={},o=(o=d.rootElement.fontFaceDecls)&&o.firstElementChild;o;)(e=o.getAttributeNS(m,"name"))&&((t=o.getAttributeNS(p,"font-family"))||0<o.getElementsByTagNameNS(p,"font-face-uri").length)&&(n[e]=t),o=o.nextElementSibling;return n}function n(e){for(var t=d.rootElement.styles.firstElementChild;t;){if(t.namespaceURI===m&&"default-style"===t.localName&&t.getAttributeNS(m,"family")===e)return t;t=t.nextElementSibling}return null}function o(e,t,n){var o,r,i;for(n=n||[d.rootElement.automaticStyles,d.rootElement.styles],i=0;i<n.length;i+=1)for(o=(o=n[i]).firstElementChild;o;){if(r=o.getAttributeNS(m,"name"),o.namespaceURI===m&&"style"===o.localName&&o.getAttributeNS(m,"family")===t&&r===e||"list-style"===t&&o.namespaceURI===h&&"list-style"===o.localName&&r===e||"data"===t&&o.namespaceURI===g&&r===e)return o;o=o.nextElementSibling}return null}function r(e){for(var t,n,o,r,i={},a=e.firstElementChild;a;){if(a.namespaceURI===m)for(o=i[a.nodeName]={},n=a.attributes,t=0;t<n.length;t+=1)o[(r=n.item(t)).name]=r.value;a=a.nextElementSibling}for(n=e.attributes,t=0;t<n.length;t+=1)i[(r=n.item(t)).name]=r.value;return i}function i(t,i){for(var a,s=d.rootElement.styles,l={},u=t.getAttributeNS(m,"family"),c=t;c;)a=r(c),l=S.mergeObjects(a,l),c=(a=c.getAttributeNS(m,"parent-style-name"))?o(a,u,[s]):null;return(c=n(u))&&(a=r(c),l=S.mergeObjects(a,l)),!1!==i&&(a=e(u),l=S.mergeObjects(a,l)),l}function a(e,t){for(var n,o=e.nodeType===Node.TEXT_NODE?e.parentNode:e,r=[],i="",a=!1;o&&!y.isInlineRoot(o)&&o.parentNode!==d.rootElement;)!a&&y.isGroupingElement(o)&&(a=!0),(n=f.determineStylesForNode(o))&&r.push(n),o=o.parentNode;return a&&(r.forEach(function(e){Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(e){i+="|"+t+":"+e+"|"})})}),t&&(t[i]=r)),a?r:void 0}function s(e){var t={orderedStyles:[],styleProperties:{}};return e.forEach(function(e){Object.keys(e).forEach(function(n){var r,a=Object.keys(e[n])[0],s={name:a,family:n,displayName:void 0,isCommonStyle:!1};(r=o(a,n))?(n=i(r),t.styleProperties=S.mergeObjects(n,t.styleProperties),s.displayName=r.getAttributeNS(m,"display-name")||void 0,s.isCommonStyle=r.parentNode===d.rootElement.styles):runtime.log("No style element found for '"+a+"' of family '"+n+"'"),t.orderedStyles.push(s)})}),t}function l(e,t){var n={},o=[];return t||(t={}),e.forEach(function(e){a(e,n)}),Object.keys(n).forEach(function(e){t[e]||(t[e]=s(n[e])),o.push(t[e])}),o}function u(e){for(var t=d.rootElement.masterStyles.firstElementChild;t&&(t.namespaceURI!==m||"master-page"!==t.localName||t.getAttributeNS(m,"name")!==e);)t=t.nextElementSibling;return t}function c(e,t){var n;return e&&(n=N.convertMeasure(e,"px")),void 0===n&&t&&(n=N.convertMeasure(t,"px")),n}var d,f=new odf.StyleInfo,p=odf.Namespaces.svgns,m=odf.Namespaces.stylens,h=odf.Namespaces.textns,g=odf.Namespaces.numberns,b=odf.Namespaces.fons,y=odf.OdfUtils,v=core.DomUtils,S=new core.Utils,N=new core.CSSUnits,C={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=e,this.setOdfContainer=function(e){d=e},this.getFontMap=t,this.getAvailableParagraphStyles=function(){for(var e,t,n=[],o=(o=d.rootElement.styles)&&o.firstElementChild;o;)"style"===o.localName&&o.namespaceURI===m&&("paragraph"===(e=o.getAttributeNS(m,"family"))&&(e=o.getAttributeNS(m,"name"),t=o.getAttributeNS(m,"display-name")||e,e&&t&&n.push({name:e,displayName:t}))),o=o.nextElementSibling;return n},this.isStyleUsed=function(e){var t,n=d.rootElement;return t=f.hasDerivedStyles(n,odf.Namespaces.lookupNamespaceURI,e),e=new f.UsedStyleList(n.styles).uses(e)||new f.UsedStyleList(n.automaticStyles).uses(e)||new f.UsedStyleList(n.body).uses(e),t||e},this.getDefaultStyleElement=n,this.getStyleElement=o,this.getStyleAttributes=r,this.getInheritedStyleAttributes=i,this.getFirstCommonParentStyleNameOrSelf=function(e){var t,n=d.rootElement.styles;return(t=o(e,"paragraph",[d.rootElement.automaticStyles]))&&!(e=t.getAttributeNS(m,"parent-style-name"))?null:(t=o(e,"paragraph",[n]))?e:null},this.hasParagraphStyle=function(e){return Boolean(o(e,"paragraph"))},this.getAppliedStyles=l,this.getAppliedStylesForElement=function(e,t){return l([e],t)[0]},this.updateStyle=function(e,n){var o,r;v.mapObjOntoNode(e,n,odf.Namespaces.lookupNamespaceURI),(o=(o=n["style:text-properties"])&&o["style:font-name"])&&!t().hasOwnProperty(o)&&((r=e.ownerDocument.createElementNS(m,"style:font-face")).setAttributeNS(m,"style:name",o),r.setAttributeNS(p,"svg:font-family",o),d.rootElement.fontFaceDecls.appendChild(r))},this.createDerivedStyleObject=function(e,t,n){var i=o(e,t);return runtime.assert(Boolean(i),"No style element found for '"+e+"' of family '"+t+"'"),(e=i.parentNode===d.rootElement.styles?{"style:parent-style-name":e}:r(i))["style:family"]=t,S.mergeObjects(e,n),e},this.getDefaultTabStopDistance=function(){for(var e,t=(t=n("paragraph"))&&t.firstElementChild;t;)t.namespaceURI===m&&"paragraph-properties"===t.localName&&(e=t.getAttributeNS(m,"tab-stop-distance")),t=t.nextElementSibling;return e||(e="1.25cm"),y.parseNonNegativeLength(e)},this.getMasterPageElement=u,this.getContentSize=function(e,t){var n,r,i,a,s,l,f,p,h,g;e:{if(r=o(e,t),runtime.assert("paragraph"===t||"table"===t,"styleFamily must be either paragraph or table"),r&&((r=r.getAttributeNS(m,"master-page-name"))&&((n=u(r))||runtime.log("WARN: No master page definition found for "+r)),n||(n=u("Standard")),n||(n=d.rootElement.masterStyles.getElementsByTagNameNS(m,"master-page")[0])||runtime.log("WARN: Document has no master pages defined"),n))for(r=n.getAttributeNS(m,"page-layout-name"),i=d.rootElement.automaticStyles.getElementsByTagNameNS(m,"page-layout"),a=0;a<i.length;a+=1)if((n=i.item(a)).getAttributeNS(m,"name")===r)break e;n=null}return n||(n=v.getDirectChild(d.rootElement.styles,m,"default-page-layout")),(n=v.getDirectChild(n,m,"page-layout-properties"))?("landscape"===n.getAttributeNS(m,"print-orientation")?(r="29.7cm",i="21.001cm"):(r="21.001cm",i="29.7cm"),r=c(n.getAttributeNS(b,"page-width"),r),i=c(n.getAttributeNS(b,"page-height"),i),void 0===(a=c(n.getAttributeNS(b,"margin")))?(a=c(n.getAttributeNS(b,"margin-left"),"2cm"),s=c(n.getAttributeNS(b,"margin-right"),"2cm"),l=c(n.getAttributeNS(b,"margin-top"),"2cm"),f=c(n.getAttributeNS(b,"margin-bottom"),"2cm")):a=s=l=f=a,void 0===(p=c(n.getAttributeNS(b,"padding")))?(p=c(n.getAttributeNS(b,"padding-left"),"0cm"),h=c(n.getAttributeNS(b,"padding-right"),"0cm"),g=c(n.getAttributeNS(b,"padding-top"),"0cm"),n=c(n.getAttributeNS(b,"padding-bottom"),"0cm")):p=h=g=n=p):(r=c("21.001cm"),i=c("29.7cm"),a=s=l=f=a=c("2cm"),p=h=g=n=p=c("0cm")),{width:r-a-s-p-h,height:i-l-f-g-n}}},function(){var e=odf.Namespaces.stylens,t=odf.Namespaces.textns,n={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(e){this.derivedStyles={},this.element=e},odf.StyleTree=function(o,r){function i(n){var o,r,i,a={};if(!n)return a;for(n=n.firstElementChild;n;)(r=n.namespaceURI!==e||"style"!==n.localName&&"default-style"!==n.localName?n.namespaceURI===t&&"list-style"===n.localName?"list":n.namespaceURI!==e||"page-layout"!==n.localName&&"default-page-layout"!==n.localName?void 0:"page":n.getAttributeNS(e,"family"))&&((o=n.getAttributeNS(e,"name"))||(o=""),a.hasOwnProperty(r)?i=a[r]:a[r]=i={},i[o]=n),n=n.nextElementSibling;return a}function a(t,n,o){var r,i,s;return n.hasOwnProperty(t)?(s=null,(i=(r=new odf.StyleTreeNode(n[t])).element.getAttributeNS(e,"parent-style-name"))&&(s=function e(t,n){if(t.hasOwnProperty(n))return t[n];var o,r=null,i=Object.keys(t);for(o=0;o<i.length&&!(r=e(t[i[o]].derivedStyles,n));o+=1);return r}(o,i)||a(i,n,o)),s?s.derivedStyles[t]=r:o[t]=r,delete n[t],r):null}function s(e,t){e&&Object.keys(e).forEach(function(n){a(n,e,t)})}var l,u,c,d={};this.getStyleTree=function(){return d},u=i(o),c=i(r),Object.keys(n).forEach(function(e){l=d[e]={},s(u[e],l),s(c[e],l)})}}(),function(){function e(e,t){try{e.insertRule(t,e.cssRules.length)}catch(e){runtime.log("cannot load rule: "+t+" - "+e)}}function t(t){function n(o,i,s,l){var u=i.namespaceURI===r&&"list"===i.localName,c=i.namespaceURI===r&&"list-item"===i.localName;if(u||c){if(u){var d,f,p;u=s+=1;for(l.listCounterCount+=1,c=o+"-level"+u+"-"+l.listCounterCount,i.setAttributeNS("urn:webodf:names:helper","counter-id",c),(d=l.continuedCounterIdStack.shift())||(a+=c+" 1 ",f='text|list[webodfhelper|counter-id="'+c+'"] > text|list-item:first-child > :not(text|list):first-child:before',f+="{",f+="counter-increment: "+(d=c)+" 0;",e(t,f+="}"));l.counterIdStack.length>=u;)l.counterIdStack.pop();for(l.counterIdStack.push(d),p=l.contentRules[u.toString()]||"",f=1;f<=u;f+=1)p=p.replace(f+"webodf-listLevel",l.counterIdStack[f-1]);f='text|list[webodfhelper|counter-id="'+c+'"] > text|list-item > :not(text|list):first-child:before',f+="{",f+=p,f+="counter-increment: "+d+";",e(t,f+="}")}for(i=i.firstElementChild;i;)n(o,i,s,l),i=i.nextElementSibling}else l.continuedCounterIdStack=[]}var o=0,a="",s={};this.createCounterRules=function(e,t,r){var a=t.getAttributeNS(i,"id"),l=[];r&&(r=r.getAttributeNS("urn:webodf:names:helper","counter-id"),l=s[r].slice(0)),e=new function(e,t){this.listCounterCount=0,this.contentRules=e,this.counterIdStack=[],this.continuedCounterIdStack=t}(e,l),a?a="Y"+a:a="X"+(o+=1),n(a,t,0,e),s[a+"-level1-1"]=e.counterIdStack},this.initialiseCreatedCounters=function(){var n;n="office|document{counter-reset: "+a+";",e(t,n+="}")}}var n=odf.Namespaces.fons,o=odf.Namespaces.stylens,r=odf.Namespaces.textns,i=odf.Namespaces.xmlns,a={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function s(e){var t=f.parseLength(e);return t?d.convert(t.value,t.unit,"px"):(runtime.log("Could not parse value '"+e+"'."),0)}function l(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function u(e,t){var n;return e&&(n=e.getAttributeNS(r,"style-name")),n===t}function c(e,n,s){n=n.getElementsByTagNameNS(r,"list"),e=new t(e);var c,d,f,p,m,h,g,b={};for(g=0;g<n.length;g+=1)if(h=(c=n.item(g)).getAttributeNS(r,"style-name")){f=c.getAttributeNS(r,"continue-numbering"),p=c.getAttributeNS(r,"continue-list"),(m=c.getAttributeNS(i,"id"))&&(b[m]=c),m=s[h].element.firstElementChild;for(var y=void 0,v={};m;){y=(y=m.getAttributeNS(r,"level"))&&parseInt(y,10);var S=m,N="",C=void 0,w=void 0,x=C=void 0;if("list-level-style-number"===S.localName){N=(O=S).getAttributeNS(o,"num-format"),C=O.getAttributeNS(o,"num-suffix")||"",w=O.getAttributeNS(o,"num-prefix")||"";var E="",T=O.getAttributeNS(r,"level"),O=O.getAttributeNS(r,"display-levels");if(w&&(E+='"'+l(w)+'"\n'),a.hasOwnProperty(N))for(T=T?parseInt(T,10):1,O=O?parseInt(O,10):1;0<O;)E+=" counter("+(T-O+1)+"webodf-listLevel,"+a[N]+")",1<O&&(E+='"."'),--O;else E=N?E+' "'+N+'"':E+' ""';N="content:"+E+' "'+l(C)+'"'}else"list-level-style-image"===S.localName?N="content: none":"list-level-style-bullet"===S.localName&&(N='content: "'+l(N=S.getAttributeNS(r,"bullet-char"))+'"');(C=S.getElementsByTagNameNS(o,"list-level-properties")[0])&&("label-alignment"===(w=C.getAttributeNS(r,"list-level-position-and-space-mode"))&&((C=C.getElementsByTagNameNS(o,"list-level-label-alignment")[0])&&(x=C.getAttributeNS(r,"label-followed-by")),"space"===x&&(N+=' "\\a0"'))),v[y]="\n"+N+";\n",m=m.nextElementSibling}m=v,f&&!p&&u(d,h)?e.createCounterRules(m,c,d):p&&u(b[p],h)?e.createCounterRules(m,c,b[p]):e.createCounterRules(m,c),d=c}e.initialiseCreatedCounters()}var d=new core.CSSUnits,f=odf.OdfUtils;this.applyListStyles=function(t,i,a){var l;(l=i.list)&&Object.keys(l).forEach(function(i){for(var a=l[i].element.firstElementChild;a;){if(a.namespaceURI===r){var u=t,c=a,d='text|list[text|style-name="'+i+'"]',f=c.getAttributeNS(r,"level"),p=void 0,m=void 0,h=m=void 0,g=void 0,b=void 0,y=p=void 0,v=void 0,S=void 0,N=void 0;for(g=void 0,h=(m=c.getElementsByTagNameNS(o,"list-level-properties")[0])&&m.getAttributeNS(r,"list-level-position-and-space-mode"),g=m&&m.getElementsByTagNameNS(o,"list-level-label-alignment")[0],p=f=f&&parseInt(f,10);1<p;)d+=" > text|list-item > text|list",--p;switch(p=m&&m.getAttributeNS(n,"text-align")||"left"){case"end":p="right";break;case"start":p="left"}"label-alignment"===h?(b=g&&g.getAttributeNS(n,"margin-left")||"0px",S=g&&g.getAttributeNS(n,"text-indent")||"0px",N=g&&g.getAttributeNS(r,"label-followed-by"),g=s(b)):(b=m&&m.getAttributeNS(r,"space-before")||"0px",y=m&&m.getAttributeNS(r,"min-label-width")||"0px",v=m&&m.getAttributeNS(r,"min-label-distance")||"0px",g=s(b)+s(y)),m=d+" > text|list-item",m+="{",m+="margin-left: "+g+"px;",e(u,m+="}"),m=d+" > text|list-item > text|list",m+="{",m+="margin-left: "+-g+"px;",e(u,m+="}"),m=d+" > text|list-item > :not(text|list):first-child:before",m+="{",m+="text-align: "+p+";",m+="display: inline-block;","label-alignment"===h?(m+="margin-left: "+S+";","listtab"===N&&(m+="padding-right: 0.2cm;")):(m+="min-width: "+y+";",m+="margin-left: "+(0===parseFloat(y)?"":"-")+y+";",m+="padding-right: "+v+";"),e(u,m+="}")}a=a.nextElementSibling}}),c(t,a,l)}}}(),odf.LazyStyleProperties=function(e,t){var n={};this.value=function(o){var r;return n.hasOwnProperty(o)?r=n[o]:(void 0===(r=t[o]())&&e&&(r=e.value(o)),n[o]=r),r},this.reset=function(t){e=t,n={}}},odf.StyleParseUtils=function(){function e(e){var t,n;return"px"===(n=(e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null)&&e.unit)?t=e.value:"cm"===n?t=e.value/2.54*96:"mm"===n?t=e.value/25.4*96:"in"===n?t=96*e.value:"pt"===n?t=e.value/.75:"pc"===n&&(t=16*e.value),t}var t=odf.Namespaces.stylens;this.parseLength=e,this.parsePositiveLengthOrPercent=function(t,n,o){var r,i;return t&&(r=parseFloat(t.substr(0,t.indexOf("%"))),isNaN(r)&&(r=void 0)),void 0!==r?(o&&(i=o.value(n)),r=void 0===i?void 0:i/100*r):r=e(t),r},this.getPropertiesElement=function(e,n,o){for(n=o?o.nextElementSibling:n.firstElementChild;null!==n&&(n.localName!==e||n.namespaceURI!==t);)n=n.nextElementSibling;return n},this.parseAttributeList=function(e){return e&&(e=e.replace(/^\s*(.*?)\s*$/g,"$1")),e&&0<e.length?e.split(/\s+/):[]}},odf.Style2CSS=function(){function e(t,n,o){var r,i=[];o=o.derivedStyles;var a,s=v[t];for(r in void 0===s?n=null:(a=n?"["+s+'|style-name="'+n+'"]':"","presentation"===s&&(s="draw",a=n?'[presentation|style-name="'+n+'"]':""),n=s+"|"+S[t].join(a+","+s+"|")+a),null!==n&&i.push(n),o)o.hasOwnProperty(r)&&(n=e(t,r,o[r]),i=i.concat(n));return i}function t(e){var t,n="";n=null;return"default-style"===e.localName?null:(n=e.getAttributeNS(f,"parent-style-name"),t=e.getAttributeNS(f,"family"),F.getODFElementsWithXPath(s,n?"//style:*[@style:name='"+n+"'][@style:family='"+t+"']":"//style:default-style[@style:family='"+t+"']",odf.Namespaces.lookupNamespaceURI)[0])}function n(e,n){var o,r,i,a="";for(o=0;o<n.length;o+=1)if(r=n[o],i=e.getAttributeNS(r[0],r[1])){if(i=i.trim(),D.hasOwnProperty(r[1])){var s=i,l=void 0;i=void 0,-1!==(u=s.indexOf(" "))?(l=s.substring(0,u),i=s.substring(u)):(l=s,i=""),(l=I.parseLength(l))&&"pt"===l.unit&&.75>l.value&&(s="0.75pt"+i),i=s}else if(_.hasOwnProperty(r[1])){s=e;var u=r[0],c=(l=r[1],I.parseLength(i)),d=void 0,p=void 0,m=void 0,h=void 0;m=void 0;if(c&&"%"===c.unit){for(d=c.value/100,p=t(s.parentNode),h="0";p;){if((m=b.getDirectChild(p,f,"paragraph-properties"))&&(m=I.parseLength(m.getAttributeNS(u,l)))){if("%"!==m.unit){h=m.value*d+m.unit;break}d*=m.value/100}p=t(p)}i=h}}r[2]&&(a+=r[2]+":"+i+";")}return a}function o(e,t,n,o){return t+t+n+n+o+o}function r(e,t,n,o){function r(t,n){var o,r=[];t.forEach(function(e){i.forEach(function(t){r.push('draw|page[webodfhelper|page-style-name="'+t+'"] draw|frame[presentation|class="'+e+'"]')})}),0<r.length&&(o=r.join(",")+"{visibility:"+n+";}",e.insertRule(o,e.cssRules.length))}var i=function e(t,n){var o=[t],r=n.derivedStyles;return Object.keys(r).forEach(function(t){t=e(t,r[t]),o=o.concat(t)}),o}(t,o),a=[],s=[];["page-number","date-time","header","footer"].forEach(function(e){var t;"true"===(t=n.getAttributeNS(g,"display-"+e))?a.push(e):"false"===t&&s.push(e)}),r(a,"visible"),r(s,"hidden")}function i(s,p,v,S){var D,_;if("page"===p){var F,B,U,L=S.element,z="";if(B=F="",v=b.getDirectChild(L,f,"page-layout-properties"))if(U=L.getAttributeNS(f,"name"),z+=n(v,R),(F=b.getDirectChild(v,f,"background-image"))&&(B=F.getAttributeNS(h,"href"))&&(z=z+"background-image: url('odfkit:"+B+"');"+n(F,C)),"presentation"===a)for(L=(L=b.getDirectChild(L.parentNode.parentNode,d,"master-styles"))&&L.firstElementChild;L;)L.namespaceURI===f&&"master-page"===L.localName&&L.getAttributeNS(f,"page-layout-name")===U&&(F='draw|page[draw|master-page-name="'+(B=L.getAttributeNS(f,"name"))+'"] {'+z+"}",B='office|body, draw|page[draw|master-page-name="'+B+'"] {'+n(v,P)+" }",s.insertRule(F,s.cssRules.length),s.insertRule(B,s.cssRules.length)),L=L.nextElementSibling;else"text"===a&&(F="office|text {"+z+"}",B="office|body {width: "+v.getAttributeNS(c,"page-width")+";}",s.insertRule(F,s.cssRules.length),s.insertRule(B,s.cssRules.length))}else{if(z=e(p,v,S).join(","),U="",L=b.getDirectChild(S.element,f,"text-properties")){var H=L,W=_="";switch(F="",B=1,L=""+n(H,N),"solid"===(D=H.getAttributeNS(f,"text-underline-style"))&&(_+=" underline"),"solid"===(D=H.getAttributeNS(f,"text-line-through-style"))&&(_+=" line-through"),_.length&&(L=L+"text-decoration:"+_+";\ntext-decoration-line:"+_+";\n",L+="-moz-text-decoration-line:"+_+";\n"),D=H.getAttributeNS(f,"text-line-through-type")){case"double":W+=" double";break;case"single":W+=" single"}if(W&&(L+="text-decoration-style:"+W+";\n",L+="-moz-text-decoration-style:"+W+";\n"),(_=H.getAttributeNS(f,"font-name")||H.getAttributeNS(c,"font-family"))&&(L+="font-family: "+((D=k[_])||_)+";"),(D=H.getAttributeNS(f,"text-position"))&&(L+="vertical-align: "+(D=(_=y.parseAttributeList(D))[0])+"\n; ",(_=_[1])&&(B=parseFloat(_)/100)),H.hasAttributeNS(c,"font-size")||1!==B){for(H=H.parentNode;H;){if(D=(D=b.getDirectChild(H,f,"text-properties"))?I.parseFoFontSize(D.getAttributeNS(c,"font-size")):null){if("%"!==D.unit){F="font-size: "+D.value*B+D.unit+";";break}B*=D.value/100}H=t(H)}F||(F="font-size: "+parseFloat(l)*B+M.getUnits(l)+";")}U+=L+=F}(L=b.getDirectChild(S.element,f,"paragraph-properties"))&&(L=""+n(F=L,w),(B=b.getDirectChild(F,f,"background-image"))&&(H=B.getAttributeNS(h,"href"))&&(L=L+"background-image: url('odfkit:"+H+"');"+n(B,C)),(F=F.getAttributeNS(c,"line-height"))&&"normal"!==F&&(L="%"!==(F=I.parseFoLineHeight(F)).unit?L+"line-height: "+F.value+F.unit+";":L+"line-height: "+F.value/100+";"),U+=L),(L=b.getDirectChild(S.element,f,"graphic-properties"))&&(L=""+n(H=L,x),F=H.getAttributeNS(u,"opacity"),B=H.getAttributeNS(u,"fill"),H=H.getAttributeNS(u,"fill-color"),"solid"===B||"hatch"===B?H&&"none"!==H?(F=isNaN(parseFloat(F))?1:parseFloat(F)/100,B=H.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,o),(H=(B=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(B))?{r:parseInt(B[1],16),g:parseInt(B[2],16),b:parseInt(B[3],16)}:null)&&(L+="background-color: rgba("+H.r+","+H.g+","+H.b+","+F+");")):L+="background: none;":"none"===B&&(L+="background: none;"),U+=L),(L=b.getDirectChild(S.element,f,"drawing-page-properties"))&&(B=""+n(F=L,x),"true"===F.getAttributeNS(g,"background-visible")&&(B+="background: none;"),U+=B,r(s,v,L,S)),(L=b.getDirectChild(S.element,f,"table-cell-properties"))&&(U=(v=U)+(U=""+n(L,E))),(L=b.getDirectChild(S.element,f,"table-row-properties"))&&(U=(v=U)+(U=""+n(L,O))),(L=b.getDirectChild(S.element,f,"table-column-properties"))&&(U=(v=U)+(U=""+n(L,T))),(L=b.getDirectChild(S.element,f,"table-properties"))&&(v=U,U=""+n(L,A),"collapsing"===(L=L.getAttributeNS(m,"border-model"))?U+="border-collapse:collapse;":"separating"===L&&(U+="border-collapse:separate;"),U=v+U),0!==U.length&&s.insertRule(z+"{"+U+"}",s.cssRules.length)}for(var j in S.derivedStyles)S.derivedStyles.hasOwnProperty(j)&&i(s,p,j,S.derivedStyles[j])}var a,s,l,u=odf.Namespaces.drawns,c=odf.Namespaces.fons,d=odf.Namespaces.officens,f=odf.Namespaces.stylens,p=odf.Namespaces.svgns,m=odf.Namespaces.tablens,h=odf.Namespaces.xlinkns,g=odf.Namespaces.presentationns,b=core.DomUtils,y=new odf.StyleParseUtils,v={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},S={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},N=[[c,"color","color"],[c,"background-color","background-color"],[c,"font-weight","font-weight"],[c,"font-style","font-style"]],C=[[f,"repeat","background-repeat"]],w=[[c,"background-color","background-color"],[c,"text-align","text-align"],[c,"text-indent","text-indent"],[c,"padding","padding"],[c,"padding-left","padding-left"],[c,"padding-right","padding-right"],[c,"padding-top","padding-top"],[c,"padding-bottom","padding-bottom"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"margin","margin"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"],[c,"border","border"]],x=[[c,"background-color","background-color"],[c,"min-height","min-height"],[u,"stroke","border"],[p,"stroke-color","border-color"],[p,"stroke-width","border-width"],[c,"border","border"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"]],E=[[c,"background-color","background-color"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"border","border"]],T=[[f,"column-width","width"]],O=[[f,"row-height","height"],[c,"keep-together",null]],A=[[f,"width","width"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"]],R=[[c,"background-color","background-color"],[c,"padding","padding"],[c,"padding-left","padding-left"],[c,"padding-right","padding-right"],[c,"padding-top","padding-top"],[c,"padding-bottom","padding-bottom"],[c,"border","border"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"margin","margin"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"]],P=[[c,"page-width","width"],[c,"page-height","height"]],D={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},_={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},k={},I=odf.OdfUtils,F=xmldom.XPath,M=new core.CSSUnits;this.style2css=function(e,t,n,o,r){function u(e,t){c="@namespace "+e+" url("+t+");";try{n.insertRule(c,n.cssRules.length)}catch(e){}}var c,d,f;for(s=t;n.cssRules.length;)n.deleteRule(n.cssRules.length-1);for(f in odf.Namespaces.forEachPrefix(u),u("webodfhelper","urn:webodf:names:helper"),k=o,a=e,l=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt",v)if(v.hasOwnProperty(f))for(d in e=r[f])e.hasOwnProperty(d)&&i(n,f,d,e[d])}},function(){function e(t,n){var o=this;this.getDistance=function(e){var t=o.x-e.x;return e=o.y-e.y,Math.sqrt(t*t+e*e)},this.getCenter=function(t){return new e((o.x+t.x)/2,(o.y+t.y)/2)},o.x=t,o.y=n}gui.ZoomHelper=function(){function t(e,t,n,o){e=o?"translate3d("+e+"px, "+t+"px, 0) scale3d("+n+", "+n+", 1)":"translate("+e+"px, "+t+"px) scale("+n+")",f.style.WebkitTransform=e,f.style.MozTransform=e,f.style.msTransform=e,f.style.OTransform=e,f.style.transform=e}function n(e){e?t(-p.x,-p.y,g,!0):(t(0,0,g,!0),t(0,0,g,!1))}function o(e){if(y&&w){var t=y.style.overflow,n=y.classList.contains("webodf-customScrollbars");e&&n||!e&&!n||(e?(y.classList.add("webodf-customScrollbars"),y.style.overflow="hidden",runtime.requestAnimationFrame(function(){y.style.overflow=t})):y.classList.remove("webodf-customScrollbars"))}}function r(){t(-p.x,-p.y,g,!0),y.scrollLeft=0,y.scrollTop=0,x=v.style.overflow,v.style.overflow="visible",o(!1)}function i(){t(0,0,g,!0),y.scrollLeft=p.x,y.scrollTop=p.y,v.style.overflow=x||"",o(!0)}function a(t){return new e(t.pageX-f.offsetLeft,t.pageY-f.offsetTop)}function s(t){if(m){p.x-=t.x-m.x,p.y-=t.y-m.y;var n=p;p=new e(Math.min(Math.max(n.x,f.offsetLeft),(f.offsetLeft+f.offsetWidth)*g-y.clientWidth),Math.min(Math.max(n.y,f.offsetTop),(f.offsetTop+f.offsetHeight)*g-y.clientHeight))}m=t}function l(e){var t=e.touches.length,n=0<t?a(e.touches[0]):null;e=1<t?a(e.touches[1]):null,n&&e?(h=n.getDistance(e),b=g,m=n.getCenter(e),r(),C=N.PINCH):n&&(m=n,C=N.SCROLL)}function u(e){var t=0<(o=e.touches.length)?a(e.touches[0]):null,o=1<o?a(e.touches[1]):null;if(t&&o)if(e.preventDefault(),C===N.SCROLL)C=N.PINCH,r(),h=t.getDistance(o);else{e=t.getCenter(o),t=t.getDistance(o)/h,s(e);o=g;var l=Math.min(4,f.offsetParent.clientWidth/f.offsetWidth);g=b*t,t=(g=Math.min(Math.max(g,l),4))/o,p.x+=(t-1)*(e.x+p.x),p.y+=(t-1)*(e.y+p.y),n(!0)}else t&&(C===N.PINCH?(C=N.SCROLL,i()):s(t))}function c(){C===N.PINCH&&(S.emit(gui.ZoomHelper.signalZoomChanged,g),i(),n(!1)),C=N.NONE}function d(){y&&(y.removeEventListener("touchstart",l,!1),y.removeEventListener("touchmove",u,!1),y.removeEventListener("touchend",c,!1))}var f,p,m,h,g,b,y,v,S=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),N={NONE:0,SCROLL:1,PINCH:2},C=N.NONE,w=runtime.getWindow().hasOwnProperty("ontouchstart"),x="";this.subscribe=function(e,t){S.subscribe(e,t)},this.unsubscribe=function(e,t){S.unsubscribe(e,t)},this.getZoomLevel=function(){return g},this.setZoomLevel=function(e){f&&(g=e,n(!1),S.emit(gui.ZoomHelper.signalZoomChanged,g))},this.destroy=function(e){d(),o(!1),e()},this.setZoomableElement=function(e){d(),y=(f=e).offsetParent,v=f.parentNode,n(!1),y&&(y.addEventListener("touchstart",l,!1),y.addEventListener("touchmove",u,!1),y.addEventListener("touchend",c,!1)),o(!0)},b=g=1,p=new e(0,0)},gui.ZoomHelper.signalZoomChanged="zoomChanged"}(),ops.Canvas=function(){},ops.Canvas.prototype.getZoomLevel=function(){},ops.Canvas.prototype.getElement=function(){},ops.Canvas.prototype.getSizer=function(){},ops.Canvas.prototype.getZoomHelper=function(){},function(){function e(){var e=[],t=!1;this.clearQueue=function(){e.length=0},this.addToQueue=function(n){if(0===e.length&&!t)return function n(o){t=!0,runtime.setTimeout(function(){try{o()}catch(e){runtime.log(String(e)+"\n"+e.stack)}t=!1,0<e.length&&n(e.pop())},10)}(n);e.push(n)}}function t(e){for(var t=(e=e.sheet).cssRules;t.length;)e.deleteRule(t.length-1)}function n(e,t,n){var o=new odf.Style2CSS,r=new odf.ListStyleToCss;n=n.sheet;var i=new odf.StyleTree(e.rootElement.styles,e.rootElement.automaticStyles).getStyleTree();o.style2css(e.getDocumentType(),e.rootElement,n,t.getFontMap(),i),r.applyListStyles(n,i,e.rootElement.body)}function o(e,t,n){var o,r=null;if(e=e.rootElement.body.getElementsByTagNameNS(y,n+"-decl"),(n=t.getAttributeNS(y,"use-"+n+"-name"))&&0<e.length)for(t=0;t<e.length;t+=1)if((o=e[t]).getAttributeNS(y,"name")===n){r=o.textContent;break}return r}function r(e,t,n,o){var r=e.ownerDocument;for(t=S.getElementsByTagNameNS(e,t,n),e=0;e<t.length;e+=1)S.removeAllChildNodes(t[e]),o&&(n=t[e]).appendChild(r.createTextNode(o))}function i(e,t,n){t.setAttributeNS("urn:webodf:names:helper","styleid",e);var o,r=t.getAttributeNS(g,"anchor-type"),i=t.getAttributeNS(m,"x"),a=t.getAttributeNS(m,"y"),s=t.getAttributeNS(m,"width"),l=t.getAttributeNS(m,"height"),u=t.getAttributeNS(d,"min-height"),c=t.getAttributeNS(d,"min-width");"as-char"===r?o="display: inline-block;":r||i||a?o="position: absolute;":(s||l||u||c)&&(o="display: block;"),i&&(o+="left: "+i+";"),a&&(o+="top: "+a+";"),s&&(o+="width: "+s+";"),l&&(o+="height: "+l+";"),u&&(o+="min-height: "+u+";"),c&&(o+="min-width: "+c+";"),o&&(o="draw|"+t.localName+'[webodfhelper|styleid="'+e+'"] {'+o+"}",n.insertRule(o,n.cssRules.length))}function a(e){for(e=e.firstChild;e;){if(e.namespaceURI===f&&"binary-data"===e.localName)return"data:image/png;base64,"+e.textContent.replace(/[\r\n\s]/g,"");e=e.nextSibling}return""}function s(e,t,n,o){function r(t){t&&(t='draw|image[webodfhelper|styleid="'+e+'"] {background-image: url('+t+");}",o.insertRule(t,o.cssRules.length))}n.setAttributeNS("urn:webodf:names:helper","styleid",e);var i,s=n.getAttributeNS(b,"href");if(s)try{(i=t.getPart(s)).onchange=function(e){r(e.url)},i.load()}catch(e){runtime.log("slight problem: "+String(e))}else r(s=a(n))}function l(e,t){function n(e,n){var i=l.documentElement.namespaceURI;"video/"===n.substr(0,6)?((o=l.createElementNS(i,"video")).setAttribute("controls","controls"),r=l.createElementNS(i,"source"),e&&r.setAttribute("src",e),r.setAttribute("type",n),o.appendChild(r),t.parentNode.appendChild(o)):t.innerHtml="Unrecognised Plugin"}var o,r,i,s,l=t.ownerDocument;if(i=t.getAttributeNS(b,"href"))try{(s=e.getPart(i)).onchange=function(e){n(e.url,e.mimetype)},s.load()}catch(e){runtime.log("slight problem: "+String(e))}else runtime.log("using MP4 data fallback"),n(i=a(t),"video/mp4")}function u(e){var t=e.getElementsByTagName("head")[0],n=e.createElementNS(t.namespaceURI,"style"),o="";return n.setAttribute("type","text/css"),n.setAttribute("media","screen, print, handheld, projection"),odf.Namespaces.forEachPrefix(function(e,t){o+="@namespace "+e+" url("+t+");\n"}),o+="@namespace webodfhelper url(urn:webodf:names:helper);\n",n.appendChild(e.createTextNode(o)),t.appendChild(n),n}var c=odf.Namespaces.drawns,d=odf.Namespaces.fons,f=odf.Namespaces.officens,p=odf.Namespaces.stylens,m=odf.Namespaces.svgns,h=odf.Namespaces.tablens,g=odf.Namespaces.textns,b=odf.Namespaces.xlinkns,y=odf.Namespaces.presentationns,v=xmldom.XPath,S=core.DomUtils;odf.OdfCanvas=function(a,d){function m(e,t,n){function o(e,t,n,o){V.addToQueue(function(){s(e,t,n,o)})}var r,i;for(r=t.getElementsByTagNameNS(c,"image"),t=0;t<r.length;t+=1)i=r.item(t),o("image"+String(t),e,i,n)}function b(e,t){function n(e,t){V.addToQueue(function(){l(e,t)})}var o,r;for(r=t.getElementsByTagNameNS(c,"plugin"),o=0;o<r.length;o+=1)n(e,r.item(o))}function N(){var e;e=B.firstChild;var t=Z.getZoomLevel();e&&(B.style.WebkitTransformOrigin="0% 0%",B.style.MozTransformOrigin="0% 0%",B.style.msTransformOrigin="0% 0%",B.style.OTransformOrigin="0% 0%",B.style.transformOrigin="0% 0%",H&&((e=H.getMinimumHeightForAnnotationPane())?B.style.minHeight=e:B.style.removeProperty("min-height")),a.style.width=Math.round(t*B.offsetWidth)+"px",a.style.height=Math.round(t*B.offsetHeight)+"px",a.style.display="inline-block")}function C(e,t){var n=P.sheet;S.removeAllChildNodes(a),(B=F.createElementNS(a.namespaceURI,"div")).style.display="inline-block",B.style.background="white",B.style.setProperty("float","left","important"),B.appendChild(t),a.appendChild(B),(U=F.createElementNS(a.namespaceURI,"div")).id="annotationsPane",(D=F.createElementNS(a.namespaceURI,"div")).id="shadowContent",D.style.position="absolute",D.style.top=0,D.style.left=0,e.getContentElement().appendChild(D);var s,l,u=t.body,d=[];for(s=u.firstElementChild;s&&s!==u;)if(s.namespaceURI===c&&(d[d.length]=s),s.firstElementChild)s=s.firstElementChild;else{for(;s&&s!==u&&!s.nextElementSibling;)s=s.parentNode;s&&s.nextElementSibling&&(s=s.nextElementSibling)}for(l=0;l<d.length;l+=1)s=d[l],i("frame"+String(l),s,n);for(d=v.getODFElementsWithXPath(u,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI),s=0;s<d.length;s+=1)(u=d[s]).setAttributeNS&&u.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);u=M,s=D;var N,C,w,x,E,T=0;if(l=e.rootElement.ownerDocument,(d=t.body.firstElementChild)&&d.namespaceURI===f&&("presentation"===d.localName||"drawing"===d.localName))for(d=d.firstElementChild;d;){if(N=(N=d.getAttributeNS(c,"master-page-name"))?u.getMasterPageElement(N):null){for(C=d.getAttributeNS("urn:webodf:names:helper","styleid"),w=l.createElementNS(c,"draw:page"),E=N.firstElementChild,T=0;E;)"true"!==E.getAttributeNS(y,"placeholder")&&(x=E.cloneNode(!0),w.appendChild(x)),E=E.nextElementSibling,T+=1;E=x=T=void 0;var O=S.getElementsByTagNameNS(w,c,"frame");for(T=0;T<O.length;T+=1)(E=(x=O[T]).getAttributeNS(y,"class"))&&!/^(date-time|footer|header|page-number)$/.test(E)&&x.parentNode.removeChild(x);for(x=S.getElementsByTagNameNS(w,c,"*"),T=0;T<x.length;T+=1)i(C+"_"+T,x[T],n);s.appendChild(w),T=String(s.getElementsByTagNameNS(c,"page").length),r(w,g,"page-number",T),r(w,y,"header",o(e,d,"header")),r(w,y,"footer",o(e,d,"footer")),i(C,w,n),w.setAttributeNS("urn:webodf:names:helper","page-style-name",d.getAttributeNS(c,"style-name")),w.setAttributeNS(c,"draw:master-page-name",N.getAttributeNS(p,"name"))}d=d.nextElementSibling}for(u=a.namespaceURI,d=S.getElementsByTagNameNS(t.body,h,"table-cell"),s=0;s<d.length;s+=1)(l=d[s]).hasAttributeNS(h,"number-columns-spanned")&&l.setAttributeNS(u,"colspan",l.getAttributeNS(h,"number-columns-spanned")),l.hasAttributeNS(h,"number-rows-spanned")&&l.setAttributeNS(u,"rowspan",l.getAttributeNS(h,"number-rows-spanned"));!function(e){var t=e.ownerDocument;S.getElementsByTagNameNS(e,g,"line-break").forEach(function(e){e.hasChildNodes()||e.appendChild(t.createElement("br"))})}(t.body),function(e){var t=e.ownerDocument;S.getElementsByTagNameNS(e,g,"s").forEach(function(e){var n,o;if(S.removeAllChildNodes(e),e.appendChild(t.createTextNode(" ")),1<(o=parseInt(e.getAttributeNS(g,"c"),10)))for(e.removeAttributeNS(g,"c"),n=1;n<o;n+=1)e.parentNode.insertBefore(e.cloneNode(!0),e)})}(t.body),function(e){S.getElementsByTagNameNS(e,g,"tab").forEach(function(e){e.textContent="\t"})}(t.body),m(e,t.body,n),b(e,t.body),B.insertBefore(D,B.firstChild),Z.setZoomableElement(B)}function w(e){L?(U.parentNode||B.appendChild(U),H&&H.forgetAnnotations(),H=new gui.AnnotationViewManager(I,e.body,U,z),e=S.getElementsByTagNameNS(e.body,f,"annotation"),H.addAnnotations(e),N()):U.parentNode&&(B.removeChild(U),H.forgetAnnotations(),N())}function x(e){function o(){t(A),t(R),t(P),S.removeAllChildNodes(a),a.style.display="inline-block";var o=E.rootElement;a.ownerDocument.importNode(o,!0),M.setOdfContainer(E),function(e,t){(new odf.FontLoader).loadFonts(e,t.sheet)}(E,A),n(E,M,R),C(E,o),w(o),e||V.addToQueue(function(){var e=[E];if(W.hasOwnProperty("statereadychange")){var t,n=W.statereadychange;for(t=0;t<n.length;t+=1)n[t].apply(null,e)}})}E.state===odf.OdfContainer.DONE?o():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),_=runtime.setTimeout(function e(){E.state===odf.OdfContainer.DONE?o():(runtime.log("will be back later..."),_=runtime.setTimeout(e,500))},100))}runtime.assert(null!==a&&void 0!==a,"odf.OdfCanvas constructor needs DOM element"),runtime.assert(null!==a.ownerDocument&&void 0!==a.ownerDocument,"odf.OdfCanvas constructor needs DOM");var E,T,O,A,R,P,D,_,k,I=this,F=a.ownerDocument,M=new odf.Formatting,B=null,U=null,L=!1,z=!1,H=null,W={},j=!1,X=!1,V=new e,Z=new gui.ZoomHelper,K=d||new gui.SingleScrollViewport(a.parentNode);this.refreshCSS=function(){j=!0,k.trigger()},this.refreshSize=function(){k.trigger()},this.odfContainer=function(){return E},this.setOdfContainer=function(e,t){E=e,x(!0===t)},this.load=this.load=function(e){V.clearQueue(),S.removeAllChildNodes(a),a.appendChild(a.ownerDocument.createTextNode(runtime.tr("Loading")+e+"...")),a.removeAttribute("style"),E=new odf.OdfContainer(e,function(e){E=e,x(!1)})},this.save=function(e){E.save(e)},this.addListener=function(e,t){switch(e){case"click":var n=e;a.addEventListener?a.addEventListener(n,t,!1):a.attachEvent?a.attachEvent("on"+n,t):a["on"+n]=t;break;default:n=W.hasOwnProperty(e)?W[e]:W[e]=[],t&&-1===n.indexOf(t)&&n.push(t)}},this.getFormatting=function(){return M},this.getAnnotationViewManager=function(){return H},this.refreshAnnotations=function(){w(E.rootElement)},this.rerenderAnnotations=function(){H&&(X=!0,k.trigger())},this.getSizer=function(){return B},this.enableAnnotations=function(e,t){e!==L&&(L=e,z=t,E&&w(E.rootElement))},this.addAnnotation=function(e){H&&(H.addAnnotations([e]),N())},this.forgetAnnotation=function(e){H&&(H.forgetAnnotation(e),N())},this.getZoomHelper=function(){return Z},this.setZoomLevel=function(e){Z.setZoomLevel(e)},this.getZoomLevel=function(){return Z.getZoomLevel()},this.fitToContainingElement=function(e,t){var n=Z.getZoomLevel(),o=a.offsetHeight/n;t/o<(n=e/(a.offsetWidth/n))&&(n=t/o),Z.setZoomLevel(n)},this.fitToWidth=function(e){var t=a.offsetWidth/Z.getZoomLevel();Z.setZoomLevel(e/t)},this.fitSmart=function(e,t){var n,o;o=Z.getZoomLevel(),n=a.offsetWidth/o,o=a.offsetHeight/o,n=e/n,void 0!==t&&t/o<n&&(n=t/o),Z.setZoomLevel(Math.min(1,n))},this.fitToHeight=function(e){var t=a.offsetHeight/Z.getZoomLevel();Z.setZoomLevel(e/t)},this.showFirstPage=function(){T.showFirstPage()},this.showNextPage=function(){T.showNextPage()},this.showPreviousPage=function(){T.showPreviousPage()},this.showPage=function(e){T.showPage(e),N()},this.getElement=function(){return a},this.getViewport=function(){return K},this.addCssForFrameWithImage=function(e){var t=e.getAttributeNS(c,"name"),n=e.firstElementChild;i(t,e,P.sheet),n&&s(t+"img",E,n,P.sheet)},this.destroy=function(e){var t=F.getElementsByTagName("head")[0],n=[T.destroy,k.destroy];runtime.clearTimeout(_),U&&U.parentNode&&U.parentNode.removeChild(U),Z.destroy(function(){B&&(a.removeChild(B),B=null)}),function(e){var t=parseInt(e.getAttribute("webodfcss"),10);1===t?e.parentNode.removeChild(e):e.setAttribute("count",t-1)}(O),t.removeChild(A),t.removeChild(R),t.removeChild(P),core.Async.destroyAll(n,e)},O=function(e){var t,n,o=e.getElementsByTagName("head")[0];for(t=e.styleSheets.length,n=o.firstElementChild;n&&("style"!==n.localName||!n.hasAttribute("webodfcss"));)n=n.nextElementSibling;return n?(t=parseInt(n.getAttribute("webodfcss"),10),n.setAttribute("webodfcss",t+1),n):("string"===String(typeof webodf_css)?t=webodf_css:(n="webodf.css",runtime.currentDirectory&&(0<(n=runtime.currentDirectory()).length&&"/"!==n.substr(-1)&&(n+="/"),n+="../webodf.css"),t=runtime.readFileSync(n,"utf-8")),(n=e.createElementNS(o.namespaceURI,"style")).setAttribute("media","screen, print, handheld, projection"),n.setAttribute("type","text/css"),n.setAttribute("webodfcss","1"),n.appendChild(e.createTextNode(t)),o.appendChild(n),n)}(F),T=new function(e){function t(){for(;0<n.cssRules.length;)n.deleteRule(0);n.insertRule("#shadowContent draw|page {display:none;}",0),n.insertRule("office|presentation draw|page {display:none;}",1),n.insertRule("#shadowContent draw|page:nth-of-type("+o+") {display:block;}",2),n.insertRule("office|presentation draw|page:nth-of-type("+o+") {display:block;}",3)}var n=e.sheet,o=1;this.showFirstPage=function(){o=1,t()},this.showNextPage=function(){o+=1,t()},this.showPreviousPage=function(){1<o&&(--o,t())},this.showPage=function(e){0<e&&(o=e,t())},this.css=e,this.destroy=function(t){e.parentNode.removeChild(e),t()}}(u(F)),A=u(F),R=u(F),P=u(F),k=core.Task.createRedrawTask(function(){j&&(n(E,M,R),j=!1),X&&(H&&H.rerenderAnnotations(),X=!1),N()}),Z.subscribe(gui.ZoomHelper.signalZoomChanged,N)}}(),odf.StepUtils=function(){this.getContentBounds=function(e){var t,n,o=e.container();return runtime.assert(e.isStep(),"Step iterator must be on a step"),o.nodeType===Node.TEXT_NODE&&0<e.offset()?t=e.offset():(o=e.leftNode())&&o.nodeType===Node.TEXT_NODE&&(t=o.length),o&&(o.nodeType===Node.TEXT_NODE?(runtime.assert(0<t,"Empty text node found"),n={container:o,startOffset:t-1,endOffset:t}):n={container:o,startOffset:0,endOffset:o.childNodes.length}),n}},ops.MemberProperties=function(){},ops.Member=function(e,t){var n=new ops.MemberProperties;this.getMemberId=function(){return e},this.getProperties=function(){return n},this.setProperties=function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},this.removeProperties=function(e){Object.keys(e).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&n.hasOwnProperty(e)&&delete n[e]})},runtime.assert(Boolean(e),"No memberId was supplied!"),t.fullName||(t.fullName=runtime.tr("Unknown Author")),t.color||(t.color="black"),t.imageUrl||(t.imageUrl="avatar-joe.png"),n=t},ops.Document=function(){},ops.Document.prototype.getMemberIds=function(){},ops.Document.prototype.removeCursor=function(e){},ops.Document.prototype.getDocumentElement=function(){},ops.Document.prototype.getRootNode=function(){},ops.Document.prototype.getDOMDocument=function(){},ops.Document.prototype.cloneDocumentElement=function(){},ops.Document.prototype.setDocumentElement=function(e){},ops.Document.prototype.subscribe=function(e,t){},ops.Document.prototype.unsubscribe=function(e,t){},ops.Document.prototype.getCanvas=function(){},ops.Document.prototype.createRootFilter=function(e){},ops.Document.prototype.createPositionIterator=function(e){},ops.Document.prototype.hasCursor=function(e){},ops.Document.signalCursorAdded="cursor/added",ops.Document.signalCursorRemoved="cursor/removed",ops.Document.signalCursorMoved="cursor/moved",ops.Document.signalMemberAdded="member/added",ops.Document.signalMemberUpdated="member/updated",ops.Document.signalMemberRemoved="member/removed",ops.OdtCursor=function(e,t){var n,o,r=this,i={},a=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){o.remove()},this.subscribe=function(e,t){a.subscribe(e,t)},this.unsubscribe=function(e,t){a.unsubscribe(e,t)},this.getMemberId=function(){return e},this.getNode=function(){return o.getNode()},this.getAnchorNode=function(){return o.getAnchorNode()},this.getSelectedRange=function(){return o.getSelectedRange()},this.setSelectedRange=function(e,t){o.setSelectedRange(e,t),a.emit(ops.OdtCursor.signalCursorUpdated,r)},this.hasForwardSelection=function(){return o.hasForwardSelection()},this.getDocument=function(){return t},this.getSelectionType=function(){return n},this.setSelectionType=function(e){i.hasOwnProperty(e)?n=e:runtime.log("Invalid selection type: "+e)},this.resetSelectionType=function(){r.setSelectionType(ops.OdtCursor.RangeSelection)},o=new core.Cursor(t.getDOMDocument(),e),i[ops.OdtCursor.RangeSelection]=!0,i[ops.OdtCursor.RegionSelection]=!0,r.resetSelectionType()},ops.OdtCursor.RangeSelection="Range",ops.OdtCursor.RegionSelection="Region",ops.OdtCursor.signalCursorUpdated="cursorUpdated",function(){var e=0;ops.StepsCache=function(t,n,o){function r(e,t){var n=this;this.nodeId=e,this.steps=-1,this.node=t,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setPositionBeforeElement(t),o(n.steps,e)}}function i(e,t){var n="["+e.nodeId;return t&&(n+=" => "+t.nodeId),n+"]"}function a(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var e,n,o,r=f,a=new core.LoopWatchDog(0,1e5),s={};r;)a.check(),(e=r.previousBookmark)?runtime.assert(e.nextBookmark===r,"Broken bookmark link to previous @"+i(e,r)):(runtime.assert(r===f,"Broken bookmark link @"+i(r)),runtime.assert(void 0===p||f==f||f.steps<=p,"Base point is damaged @"+i(r))),(n=r.nextBookmark)&&runtime.assert(n.previousBookmark===r,"Broken bookmark link to next @"+i(r,n)),(void 0===p||r===f||r.steps<=p)&&(runtime.assert(g.containsNode(t,r.node),"Disconnected node is being reported as undamaged @"+i(r)),e&&(o=r.node.compareDocumentPosition(e.node),runtime.assert(0===o||0!=(o&y),"Bookmark order with previous does not reflect DOM order @"+i(e,r))),n&&g.containsNode(t,n.node)&&(o=r.node.compareDocumentPosition(n.node),runtime.assert(0===o||0!=(o&b),"Bookmark order with next does not reflect DOM order @"+i(r,n)))),r=r.nextBookmark;Object.keys(m).forEach(function(e){var t=m[e];(void 0===p||e<=p)&&runtime.assert(t.steps<=e,"Bookmark step of "+t.steps+" exceeds cached step lookup for "+e+" @"+i(t)),runtime.assert(!1===s.hasOwnProperty(t.nodeId),"Bookmark "+i(t)+" appears twice in cached step lookup at steps "+s[t.nodeId]+" and "+e),s[t.nodeId]=e})}}function s(e){var t="";return e.nodeType===Node.ELEMENT_NODE&&(t=e.getAttributeNS("urn:webodf:names:steps","nodeId")||""),t}function l(t){var n=e.toString();return t.setAttributeNS("urn:webodf:names:steps","nodeId",n),e+=1,n}function u(e){var t,o,r=new core.LoopWatchDog(0,1e4);for(void 0!==p&&e>p&&(e=p),t=Math.floor(e/n)*n;!o&&0<=t;)o=m[t],t-=n;for(o=o||f;o.nextBookmark&&o.nextBookmark.steps<=e;)r.check(),o=o.nextBookmark;return runtime.assert(-1===e||o.steps<=e,"Bookmark @"+i(o)+" at step "+o.steps+" exceeds requested step of "+e),o}function c(e){e.previousBookmark&&(e.previousBookmark.nextBookmark=e.nextBookmark),e.nextBookmark&&(e.nextBookmark.previousBookmark=e.previousBookmark)}function d(e){for(var n,o=null;!o&&e&&e!==t;)(n=s(e))&&(o=h[n])&&o.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),o=null,e.removeAttributeNS("urn:webodf:names:steps","nodeId")),e=e.parentNode;return o}var f,p,m={},h={},g=core.DomUtils,b=Node.DOCUMENT_POSITION_FOLLOWING,y=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(e,o){var i,d,y,v,S=Math.ceil(e/n)*n;if(void 0!==p&&p<e){for(y=(d=u(p)).nextBookmark;y&&y.steps<=e;)i=y.nextBookmark,v=Math.ceil(y.steps/n)*n,m[v]===y&&delete m[v],g.containsNode(t,y.node)?y.steps=e+1:(c(y),delete h[y.nodeId]),y=i;p=e}else d=u(e);if(y=s(o)||l(o),(i=h[y])?i.node!==o&&(runtime.log("Cloned node detected. Creating new bookmark"),y=l(o),i=h[y]=new r(y,o)):i=h[y]=new r(y,o),(y=i).steps!==e&&((i=Math.ceil(y.steps/n)*n)!==S&&m[i]===y&&delete m[i],y.steps=e),d!==y&&d.nextBookmark!==y){if(d.steps===y.steps)for(;0!=(y.node.compareDocumentPosition(d.node)&b)&&d!==f;)d=d.previousBookmark;d!==y&&d.nextBookmark!==y&&(c(y),i=d.nextBookmark,y.nextBookmark=d.nextBookmark,y.previousBookmark=d,d.nextBookmark=y,i&&(i.previousBookmark=y))}(!(d=m[S])||y.steps>d.steps)&&(m[S]=y),a()},this.setToClosestStep=function(e,t){var n;return a(),(n=u(e)).setIteratorPosition(t),n.steps},this.setToClosestDomPoint=function(e,n,o){var r,i;if(a(),e===t&&0===n)r=f;else if(e===t&&n===t.childNodes.length)for(i in r=f,m)m.hasOwnProperty(i)&&((e=m[i]).steps>r.steps&&(r=e));else if(!(r=d(e.childNodes.item(n)||e)))for(o.setUnfilteredPosition(e,n);!r&&o.previousNode();)r=d(o.getCurrentNode());return r=r||f,void 0!==p&&r.steps>p&&(r=u(p)),r.setIteratorPosition(o),r.steps},this.damageCacheAfterStep=function(e){0>e&&(e=-1),void 0===p?p=e:e<p&&(p=e),a()},function(){var e=s(t)||l(t);f=new function(e,t,n){var r=this;this.nodeId=e,this.steps=t,this.node=n,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setUnfilteredPosition(n,0),o(r.steps,e)}}(e,0,t)}()},ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1,ops.StepsCache.Bookmark=function(){},ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(e){}}(),ops.OdtStepsTranslator=function(e,t,n,o){function r(e,t,n){var o=t.getCurrentNode();t.isBeforeNode()&&s.isParagraph(o)&&(n||(e+=1),a.updateBookmark(e,o))}function i(e,t){if(!t||n.acceptPosition(e)===u)return!0;for(;e.previousPosition();)if(n.acceptPosition(e)===u){if(t(c,e.container(),e.unfilteredDomOffset()))return!0;break}for(;e.nextPosition();)if(n.acceptPosition(e)===u){if(t(d,e.container(),e.unfilteredDomOffset()))return!0;break}return!1}var a,s=odf.OdfUtils,l=core.DomUtils,u=core.PositionFilter.FilterResult.FILTER_ACCEPT,c=core.StepDirection.PREVIOUS,d=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var o,i;if(isNaN(e))throw new TypeError("Requested steps is not numeric ("+e+")");if(0>e)throw new RangeError("Requested steps is negative ("+e+")");for(o=a.setToClosestStep(e,t);o<e&&t.nextPosition();)(i=n.acceptPosition(t)===u)&&(o+=1),r(o,t,i);if(o!==e)throw new RangeError("Requested steps ("+e+") exceeds available steps ("+o+")");return{node:t.container(),offset:t.unfilteredDomOffset()}},this.convertDomPointToSteps=function(o,s,c){var d;if(l.containsNode(e,o)||(s=0>l.comparePoints(e,0,o,s),o=e,s=s?0:e.childNodes.length),t.setUnfilteredPosition(o,s),i(t,c)||t.setUnfilteredPosition(o,s),c=t.container(),s=t.unfilteredDomOffset(),o=a.setToClosestDomPoint(c,s,t),0>l.comparePoints(t.container(),t.unfilteredDomOffset(),c,s))return 0<o?o-1:o;for(;(t.container()!==c||t.unfilteredDomOffset()!==s)&&t.nextPosition();)(d=n.acceptPosition(t)===u)&&(o+=1),r(o,t,d);return o+0},this.prime=function(){var e,o;for(e=a.setToClosestStep(0,t);t.nextPosition();)(o=n.acceptPosition(t)===u)&&(e+=1),r(e,t,o)},this.handleStepsInserted=function(e){a.damageCacheAfterStep(e.position)},this.handleStepsRemoved=function(e){a.damageCacheAfterStep(e.position-1)},a=new ops.StepsCache(e,o,function(e,t){do{if(n.acceptPosition(t)===u){r(e,t,!0);break}r(e-1,t,!1)}while(t.nextPosition())})},ops.Operation=function(){},ops.Operation.prototype.init=function(e){},ops.Operation.prototype.execute=function(e){},ops.Operation.prototype.spec=function(){},ops.TextPositionFilter=function(){function e(e,n,o,a){var s;if(n){if(t.isInlineRoot(n)&&t.isGroupingElement(o))return i;if(1===(a=t.lookLeftForCharacter(n))||2===a&&(t.scanRightForAnyCharacter(o)||t.scanRightForAnyCharacter(t.nextNode(e))))return r}else if(t.isGroupingElement(e)&&t.isInlineRoot(function(e,t){for(;e&&t(e)!==r;)e=e.previousSibling;return e}(e.previousSibling,a)))return r;return a=null===n&&t.isParagraph(e),s=t.lookRightForCharacter(o),a?s?r:t.scanRightForAnyCharacter(o)?i:r:s?(n=n||t.previousNode(e),t.scanLeftForAnyCharacter(n)?i:r):i}var t=odf.OdfUtils,n=Node.ELEMENT_NODE,o=Node.TEXT_NODE,r=core.PositionFilter.FilterResult.FILTER_ACCEPT,i=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(a){var s,l,u,c=a.container(),d=c.nodeType;if(d!==n&&d!==o)return i;if(d===o){if(d=a.unfilteredDomOffset(),s=c.data,runtime.assert(d!==s.length,"Unexpected offset."),0<d){if(a=s[d-1],!t.isODFWhitespace(a))return r;if(1<d)if(a=s[d-2],t.isODFWhitespace(a)){if(!t.isODFWhitespace(s.substr(0,d)))return i}else u=r;else l=t.previousNode(c),t.scanLeftForNonSpace(l)&&(u=r);return u===r?t.isTrailingWhitespace(c,d)?i:r:(a=s[d],t.isODFWhitespace(a)?i:t.scanLeftForAnyCharacter(t.previousNode(c))?i:r)}l=a.leftNode(),u=c,u=e(c=c.parentNode,l,u,a.getNodeFilter())}else t.isGroupingElement(c)?u=e(c,l=a.leftNode(),u=a.rightNode(),a.getNodeFilter()):u=i;return u}},ops.OdtDocument=function(e){function t(e){return new core.PositionIterator(e,C,E,!1)}function n(){var t=e.odfContainer().getContentElement(),n=t&&t.localName;return runtime.assert("text"===n,"Unsupported content element type '"+n+"' for OdtDocument"),t}function o(){return h.getDocumentElement().ownerDocument}function r(e){for(;e&&!(e.namespaceURI===odf.Namespaces.officens&&"text"===e.localName||e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName);)e=e.parentNode;return e}function i(e,n,o,r){var i;return r=t(r),1===o.length?i=o[0]:(i=new core.PositionFilterChain,o.forEach(i.addFilter)),(o=new core.StepIterator(i,r)).setPosition(e,n),o}function a(e){var o=t(n());return e=p.convertStepsToDomPoint(e),o.setUnfilteredPosition(e.node,e.offset),o}function s(e){return e===N}function l(t){var n=(r=t.spec()).memberid,o=new Date(r.timestamp).toISOString(),r=e.odfContainer();t.isEdit&&(n=h.getMember(n).getProperties().fullName,r.setMetadata({"dc:creator":n,"dc:date":o},null),n={setProperties:{"dc:creator":n,"dc:date":o},removedProperties:[]},m||(n.setProperties["meta:editing-cycles"]=r.incrementEditingCycles(),r.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),m=t,h.emit(ops.OdtDocument.signalMetadataUpdated,n))}function u(e){var t,n,o=[],r=2;runtime.assert(e.isStep(),"positionIterator is not at a step");do{if((t=d.getContentBounds(e))&&(t=t.container,g.isDowngradableSpaceElement(t))){for(n=t.lastChild;t.firstChild;)o.push(t.firstChild),t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t),e.setPosition(n,n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length),e.roundToPreviousStep()}--r}while(0<r&&e.nextStep());o.forEach(b.normalizeTextNodes)}function c(e,t,n){return e=e.childNodes.item(t)||e,(e=g.getParagraphElement(e))&&b.containsNode(n,e)?e:n}var d,f,p,m,h=this,g=odf.OdfUtils,b=core.DomUtils,y={},v={},S=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),N=core.StepDirection.NEXT,C=NodeFilter.SHOW_ALL,w=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),x=new gui.OdfTextBodyNodeFilter,E=new core.NodeFilterChain([w,x]);this.createPositionIterator=t,this.getDocumentElement=function(){return e.odfContainer().rootElement},this.cloneDocumentElement=function(){var t=h.getDocumentElement(),n=e.getAnnotationViewManager();return n&&n.forgetAnnotations(),t=t.cloneNode(!0),e.refreshAnnotations(),h.fixCursorPositions(),t},this.setDocumentElement=function(o){var r=e.odfContainer();S.unsubscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.unsubscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved),r.setRootElement(o),e.setOdfContainer(r,!0),e.refreshCSS(),o=n(),p=new ops.OdtStepsTranslator(o,t(o),f,500),S.subscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.subscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved)},this.getDOMDocument=o,this.getRootElement=r,this.createStepIterator=i,this.getIteratorAtPosition=a,this.convertCursorStepToDomPoint=function(e){return p.convertStepsToDomPoint(e)},this.convertDomPointToCursorStep=function(e,t,n){var o;return n===N&&(o=s),p.convertDomPointToSteps(e,t,o)},this.convertDomToCursorRange=function(e){var t;return{position:t=p.convertDomPointToSteps(e.anchorNode,e.anchorOffset),length:(e=e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset?t:p.convertDomPointToSteps(e.focusNode,e.focusOffset))-t}},this.convertCursorToDomRange=function(e,t){var n,r,i=o().createRange();return n=p.convertStepsToDomPoint(e),t?(r=p.convertStepsToDomPoint(e+t),0<t?(i.setStart(n.node,n.offset),i.setEnd(r.node,r.offset)):(i.setStart(r.node,r.offset),i.setEnd(n.node,n.offset))):i.setStart(n.node,n.offset),i},this.upgradeWhitespacesAtPosition=function(e){var t,n=a(e),o=(n=new core.StepIterator(f,n),2);runtime.assert(n.isStep(),"positionIterator is not at a step (requested step: "+e+")");do{if((t=d.getContentBounds(n))&&(e=t.container,t=t.startOffset,e.nodeType===Node.TEXT_NODE&&g.isSignificantWhitespace(e,t))){runtime.assert(" "===e.data[t],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var r=e.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),i=e.parentNode,s=e;r.appendChild(e.ownerDocument.createTextNode(" ")),1===e.length?i.replaceChild(r,e):(e.deleteData(t,1),0<t&&(t<e.length&&e.splitText(t),s=e.nextSibling),i.insertBefore(r,s)),e=r,n.setPosition(e,e.childNodes.length),n.roundToPreviousStep()}--o}while(0<o&&n.nextStep())},this.downgradeWhitespaces=u,this.downgradeWhitespacesAtPosition=function(e){e=a(e),u(e=new core.StepIterator(f,e))},this.getTextNodeAtStep=function(e,t){var n,r=a(e),i=r.container(),s=0,l=null;if(i.nodeType===Node.TEXT_NODE?(n=i,s=r.unfilteredDomOffset(),0<n.length&&(0<s&&(n=n.splitText(s)),n.parentNode.insertBefore(o().createTextNode(""),n),n=n.previousSibling,s=0)):(n=o().createTextNode(""),s=0,i.insertBefore(n,r.rightNode())),t){if(y[t]&&h.getCursorPosition(t)===e){for(l=y[t].getNode();l.nextSibling&&"cursor"===l.nextSibling.localName;)l.parentNode.insertBefore(l.nextSibling,l);0<n.length&&n.nextSibling!==l&&(n=o().createTextNode(""),s=0),l.parentNode.insertBefore(n,l)}}else for(;n.nextSibling&&"cursor"===n.nextSibling.localName;)n.parentNode.insertBefore(n.nextSibling,n);for(;n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE;)(r=n.previousSibling).appendData(n.data),s=r.length,(n=r).parentNode.removeChild(n.nextSibling);for(;n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE;)r=n.nextSibling,n.appendData(r.data),n.parentNode.removeChild(r);return{textNode:n,offset:s}},this.fixCursorPositions=function(){Object.keys(y).forEach(function(e){var t,n,o,a=y[e],s=r(a.getNode()),l=h.createRootFilter(s),u=!1;t=c((o=a.getSelectedRange()).startContainer,o.startOffset,s),n=i(o.startContainer,o.startOffset,[f,l],t),o.collapsed?s=n:(t=c(o.endContainer,o.endOffset,s),s=i(o.endContainer,o.endOffset,[f,l],t)),n.isStep()&&s.isStep()?n.container()!==s.container()||n.offset()!==s.offset()||o.collapsed&&a.getAnchorNode()===a.getNode()||(u=!0,o.setStart(n.container(),n.offset()),o.collapse(!0)):(u=!0,runtime.assert(n.roundToClosestStep(),"No walkable step found for cursor owned by "+e),o.setStart(n.container(),n.offset()),runtime.assert(s.roundToClosestStep(),"No walkable step found for cursor owned by "+e),o.setEnd(s.container(),s.offset())),u&&(a.setSelectedRange(o,a.hasForwardSelection()),h.emit(ops.Document.signalCursorMoved,a))})},this.getCursorPosition=function(e){return(e=y[e])?p.convertDomPointToSteps(e.getNode(),0):0},this.getCursorSelection=function(e){var t=0,n=0;return(e=y[e])&&(t=p.convertDomPointToSteps(e.getNode(),0),n=p.convertDomPointToSteps(e.getAnchorNode(),0)),{position:n,length:t-n}},this.getPositionFilter=function(){return f},this.getOdfCanvas=function(){return e},this.getCanvas=function(){return e},this.getRootNode=n,this.addMember=function(e){runtime.assert(void 0===v[e.getMemberId()],"This member already exists"),v[e.getMemberId()]=e},this.getMember=function(e){return v.hasOwnProperty(e)?v[e]:null},this.removeMember=function(e){delete v[e]},this.getCursor=function(e){return y[e]},this.hasCursor=function(e){return y.hasOwnProperty(e)},this.getMemberIds=function(){return Object.keys(v)},this.addCursor=function(e){runtime.assert(Boolean(e),"OdtDocument::addCursor without cursor");var t=e.getMemberId(),n=h.convertCursorToDomRange(0,0);runtime.assert("string"==typeof t,"OdtDocument::addCursor has cursor without memberid"),runtime.assert(!y[t],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+t),e.setSelectedRange(n,!0),y[t]=e},this.removeCursor=function(e){var t=y[e];return!!t&&(t.removeFromDocument(),delete y[e],h.emit(ops.Document.signalCursorRemoved,e),!0)},this.moveCursor=function(e,t,n,o){e=y[e],t=h.convertCursorToDomRange(t,n),e&&(e.setSelectedRange(t,0<=n),e.setSelectionType(o||ops.OdtCursor.RangeSelection))},this.getFormatting=function(){return e.getFormatting()},this.emit=function(e,t){S.emit(e,t)},this.subscribe=function(e,t){S.subscribe(e,t)},this.unsubscribe=function(e,t){S.unsubscribe(e,t)},this.createRootFilter=function(e){return new RootFilter(e,y,r)},this.close=function(e){e()},this.destroy=function(e){e()},function(){var e=n();f=new ops.TextPositionFilter,d=new odf.StepUtils,p=new ops.OdtStepsTranslator(e,t(e),f,500),S.subscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.subscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved),S.subscribe(ops.OdtDocument.signalOperationEnd,l),S.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)}()},ops.OdtDocument.signalParagraphChanged="paragraph/changed",ops.OdtDocument.signalTableAdded="table/added",ops.OdtDocument.signalCommonStyleCreated="style/created",ops.OdtDocument.signalCommonStyleDeleted="style/deleted",ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified",ops.OdtDocument.signalOperationStart="operation/start",ops.OdtDocument.signalOperationEnd="operation/end",ops.OdtDocument.signalProcessingBatchStart="router/batchstart",ops.OdtDocument.signalProcessingBatchEnd="router/batchend",ops.OdtDocument.signalUndoStackChanged="undo/changed",ops.OdtDocument.signalStepsInserted="steps/inserted",ops.OdtDocument.signalStepsRemoved="steps/removed",ops.OdtDocument.signalMetadataUpdated="metadata/updated",ops.OdtDocument.signalAnnotationAdded="annotation/added",ops.OpAddAnnotation=function(){function e(e,n,o){var r=e.getTextNodeAtStep(o,t);r&&(o=(e=r.textNode).parentNode,r.offset!==e.length&&e.splitText(r.offset),o.insertBefore(n,e.nextSibling),0===e.length&&o.removeChild(e))}var t,n,o,r,i,a;this.init=function(e){t=e.memberid,n=parseInt(e.timestamp,10),o=parseInt(e.position,10),r=void 0!==e.length?parseInt(e.length,10)||0:void 0,i=e.name},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l,u,c=s.getCursor(t);a=s.getDOMDocument();var d,f,p,m=new Date(n);return(d=a.createElementNS(odf.Namespaces.officens,"office:annotation")).setAttributeNS(odf.Namespaces.officens,"office:name",i),(l=a.createElementNS(odf.Namespaces.dcns,"dc:creator")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),l.textContent=s.getMember(t).getProperties().fullName,(u=a.createElementNS(odf.Namespaces.dcns,"dc:date")).appendChild(a.createTextNode(m.toISOString())),m=a.createElementNS(odf.Namespaces.textns,"text:list"),f=a.createElementNS(odf.Namespaces.textns,"text:list-item"),p=a.createElementNS(odf.Namespaces.textns,"text:p"),f.appendChild(p),m.appendChild(f),d.appendChild(l),d.appendChild(u),d.appendChild(m),void 0!==r&&((l=a.createElementNS(odf.Namespaces.officens,"office:annotation-end")).setAttributeNS(odf.Namespaces.officens,"office:name",i),d.annotationEndElement=l,e(s,l,o+r)),e(s,d,o),s.emit(ops.OdtDocument.signalStepsInserted,{position:o}),c&&(l=a.createRange(),u=d.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],l.selectNodeContents(u),c.setSelectedRange(l,!1),c.setSelectionType(ops.OdtCursor.RangeSelection),s.emit(ops.Document.signalCursorMoved,c)),s.getOdfCanvas().addAnnotation(d),s.fixCursorPositions(),s.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:t,annotation:d}),!0},this.spec=function(){return{optype:"AddAnnotation",memberid:t,timestamp:n,position:o,length:r,name:i}}},ops.OpAddCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){var n=t.getCursor(e);return!n&&(n=new ops.OdtCursor(e,t),t.addCursor(n),t.emit(ops.Document.signalCursorAdded,n),!0)},this.spec=function(){return{optype:"AddCursor",memberid:e,timestamp:t}}},ops.OpAddMember=function(){var e,t,n;this.init=function(o){e=o.memberid,t=parseInt(o.timestamp,10),n=o.setProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var o;return!t.getMember(e)&&(o=new ops.Member(e,n),t.addMember(o),t.emit(ops.Document.signalMemberAdded,o),!0)},this.spec=function(){return{optype:"AddMember",memberid:e,timestamp:t,setProperties:n}}},ops.OpAddStyle=function(){var e,t,n,o,r,i,a=odf.Namespaces.stylens;this.init=function(a){e=a.memberid,t=a.timestamp,n=a.styleName,o=a.styleFamily,r="true"===a.isAutomaticStyle||!0===a.isAutomaticStyle,i=a.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),s=e.getFormatting(),l=e.getDOMDocument().createElementNS(a,"style:style");return!!l&&(i&&s.updateStyle(l,i),l.setAttributeNS(a,"style:family",o),l.setAttributeNS(a,"style:name",n),r?t.rootElement.automaticStyles.appendChild(l):t.rootElement.styles.appendChild(l),e.getOdfCanvas().refreshCSS(),r||e.emit(ops.OdtDocument.signalCommonStyleCreated,{name:n,family:o}),!0)},this.spec=function(){return{optype:"AddStyle",memberid:e,timestamp:t,styleName:n,styleFamily:o,isAutomaticStyle:r,setProperties:i}}},odf.ObjectNameGenerator=function(e,t){function n(e,t){var n={};this.generateName=function(){var o,r=t(),i=0;do{o=e+i,i+=1}while(n[o]||r[o]);return n[o]=!0,o}}var o=odf.Namespaces.stylens,r=odf.Namespaces.drawns,i=odf.Namespaces.xlinkns,a=(new core.Utils).hashString(t),s=null,l=null,u=null,c={},d={};this.generateStyleName=function(){return null===s&&(s=new n("auto"+a+"_",function(){return t={},[e.rootElement.automaticStyles,e.rootElement.styles].forEach(function(e){for(e=e.firstElementChild;e;)e.namespaceURI===o&&"style"===e.localName&&(t[e.getAttributeNS(o,"name")]=!0),e=e.nextElementSibling}),t;var t})),s.generateName()},this.generateFrameName=function(){var t,o,i;if(null===l){for(o=e.rootElement.body.getElementsByTagNameNS(r,"frame"),t=0;t<o.length;t+=1)i=o.item(t),c[i.getAttributeNS(r,"name")]=!0;l=new n("fr"+a+"_",function(){return c})}return l.generateName()},this.generateImageName=function(){var t,o,s;if(null===u){for(s=e.rootElement.body.getElementsByTagNameNS(r,"image"),t=0;t<s.length;t+=1)o=(o=(o=s.item(t)).getAttributeNS(i,"href")).substring(9,o.lastIndexOf(".")),d[o]=!0;u=new n("img"+a+"_",function(){return d})}return u.generateName()}},odf.TextStyleApplicator=function(e,t,n){function o(e){var n={};this.isStyleApplied=function(o){return o=t.getAppliedStylesForElement(o,n).styleProperties,function e(t,n){return"object"==typeof t&&"object"==typeof n?Object.keys(t).every(function(o){return e(t[o],n[o])}):t===n}(e,o)}}function r(o){var r={};this.applyStyleToContainer=function(i){var a;a=i.getAttributeNS(s,"style-name");var u=i.ownerDocument;if(a=a||"",!r.hasOwnProperty(a)){var c,d=a;c=a?t.createDerivedStyleObject(a,"text",o):o,u=u.createElementNS(l,"style:style"),t.updateStyle(u,c),u.setAttributeNS(l,"style:name",e.generateStyleName()),u.setAttributeNS(l,"style:family","text"),u.setAttributeNS("urn:webodf:names:scope","scope","document-content"),n.appendChild(u),r[d]=u}a=r[a].getAttributeNS(l,"name"),i.setAttributeNS(s,"text:style-name",a)}}function i(e,t){var n,o,r,i=e.ownerDocument,l=e.parentNode,u=new core.LoopWatchDog(1e4);for((o=[]).push(e),r=e.nextSibling;r&&a.rangeContainsNode(t,r);)u.check(),o.push(r),r=r.nextSibling;if("span"!==l.localName||l.namespaceURI!==s?(n=i.createElementNS(s,"text:span"),l.insertBefore(n,e),i=!1):(e.previousSibling&&!a.rangeContainsNode(t,l.firstChild)?(n=l.cloneNode(!1),l.parentNode.insertBefore(n,l.nextSibling)):n=l,i=!0),o.forEach(function(e){e.parentNode!==n&&n.appendChild(e)}),r&&i)for(o=n.cloneNode(!1),n.parentNode.insertBefore(o,n.nextSibling);r;)u.check(),i=r.nextSibling,o.appendChild(r),r=i;return n}var a=core.DomUtils,s=odf.Namespaces.textns,l=odf.Namespaces.stylens;this.applyStyle=function(e,t,n){var a,s,l,u={};runtime.assert(n&&n.hasOwnProperty("style:text-properties"),"applyStyle without any text properties"),u["style:text-properties"]=n["style:text-properties"],s=new r(u),l=new o(u),e.forEach(function(e){!1===l.isStyleApplied(e)&&(a=i(e,t),s.applyStyleToContainer(a))})}},ops.OpApplyDirectStyling=function(){function e(e,n,o){var r=e.getOdfCanvas().odfContainer(),i=s.splitBoundaries(n),l=a.getTextNodes(n,!1);new odf.TextStyleApplicator(new odf.ObjectNameGenerator(r,t),e.getFormatting(),r.rootElement.automaticStyles).applyStyle(l,n,o),i.forEach(s.normalizeTextNodes)}var t,n,o,r,i,a=odf.OdfUtils,s=core.DomUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=parseInt(e.position,10),r=parseInt(e.length,10),i=e.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l=s.convertCursorToDomRange(o,r),u=a.getParagraphElements(l);return e(s,l,i),l.detach(),s.getOdfCanvas().refreshCSS(),s.fixCursorPositions(),u.forEach(function(e){s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:t,timeStamp:n})}),s.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"ApplyDirectStyling",memberid:t,timestamp:n,position:o,length:r,setProperties:i}}},ops.OpApplyHyperlink=function(){var e,t,n,o,r,i=core.DomUtils,a=odf.OdfUtils;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,o=i.length,r=i.hyperlink},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l=s.getDOMDocument(),u=s.convertCursorToDomRange(n,o),c=i.splitBoundaries(u),d=[],f=a.getTextNodes(u,!1);return 0!==f.length&&(f.forEach(function(e){var t=a.getParagraphElement(e);runtime.assert(!1===function(e){for(;e;){if(a.isHyperlink(e))return!0;e=e.parentNode}return!1}(e),"The given range should not contain any link.");var n=r,o=l.createElementNS(odf.Namespaces.textns,"text:a");o.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple"),o.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",n),e.parentNode.insertBefore(o,e),o.appendChild(e),-1===d.indexOf(t)&&d.push(t)}),c.forEach(i.normalizeTextNodes),u.detach(),s.fixCursorPositions(),s.getOdfCanvas().refreshSize(),s.getOdfCanvas().rerenderAnnotations(),d.forEach(function(n){s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:e,timeStamp:t})}),!0)},this.spec=function(){return{optype:"ApplyHyperlink",memberid:e,timestamp:t,position:n,length:o,hyperlink:r}}},ops.OpInsertImage=function(){var e,t,n,o,r,i,a,s,l=odf.Namespaces.drawns,u=odf.Namespaces.svgns,c=odf.Namespaces.textns,d=odf.Namespaces.xlinkns,f=odf.OdfUtils;this.init=function(l){e=l.memberid,t=l.timestamp,n=l.position,o=l.filename,r=l.frameWidth,i=l.frameHeight,a=l.frameStyleName,s=l.frameName},this.isEdit=!0,this.group=void 0,this.execute=function(p){var m,h,g=p.getOdfCanvas();if(!(b=p.getTextNodeAtStep(n,e)))return!1;m=b.textNode,h=f.getParagraphElement(m);var b=b.offset!==m.length?m.splitText(b.offset):m.nextSibling,y=(v=p.getDOMDocument()).createElementNS(l,"draw:image"),v=v.createElementNS(l,"draw:frame");return y.setAttributeNS(d,"xlink:href",o),y.setAttributeNS(d,"xlink:type","simple"),y.setAttributeNS(d,"xlink:show","embed"),y.setAttributeNS(d,"xlink:actuate","onLoad"),v.setAttributeNS(l,"draw:style-name",a),v.setAttributeNS(l,"draw:name",s),v.setAttributeNS(c,"text:anchor-type","as-char"),v.setAttributeNS(u,"svg:width",r),v.setAttributeNS(u,"svg:height",i),v.appendChild(y),m.parentNode.insertBefore(v,b),p.emit(ops.OdtDocument.signalStepsInserted,{position:n}),0===m.length&&m.parentNode.removeChild(m),g.addCssForFrameWithImage(v),g.refreshCSS(),p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:e,timeStamp:t}),g.rerenderAnnotations(),!0},this.spec=function(){return{optype:"InsertImage",memberid:e,timestamp:t,filename:o,position:n,frameWidth:r,frameHeight:i,frameStyleName:a,frameName:s}}},ops.OpInsertTable=function(){function e(e,t){var n;if(1===u.length)n=u[0];else if(3===u.length)switch(e){case 0:n=u[0];break;case o-1:n=u[2];break;default:n=u[1]}else n=u[e];if(1===n.length)return n[0];if(3===n.length)switch(t){case 0:return n[0];case r-1:return n[2];default:return n[1]}return n[t]}var t,n,o,r,i,a,s,l,u,c=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,i=e.position,o=e.initialRows,r=e.initialColumns,a=e.tableName,s=e.tableStyleName,l=e.tableColumnStyleName,u=e.tableCellStyleMatrix},this.isEdit=!0,this.group=void 0,this.execute=function(u){var d=u.getTextNodeAtStep(i),f=u.getRootNode();if(d){var p,m,h,g,b=u.getDOMDocument(),y=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column");for(s&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",s),a&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",a),v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",r),l&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",l),y.appendChild(v),h=0;h<o;h+=1){for(v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row"),g=0;g<r;g+=1)p=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(m=e(h,g))&&p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",m),m=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),p.appendChild(m),v.appendChild(p);y.appendChild(v)}return d=c.getParagraphElement(d.textNode),f.insertBefore(y,d.nextSibling),u.emit(ops.OdtDocument.signalStepsInserted,{position:i}),u.getOdfCanvas().refreshSize(),u.emit(ops.OdtDocument.signalTableAdded,{tableElement:y,memberId:t,timeStamp:n}),u.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertTable",memberid:t,timestamp:n,position:i,initialRows:o,initialColumns:r,tableName:a,tableStyleName:s,tableColumnStyleName:l,tableCellStyleMatrix:u}}},ops.OpInsertText=function(){function e(e){return"\t"!==e&&a.isODFWhitespace(e)}var t,n,o,r,i,a=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.position,i=e.text,r="true"===e.moveCursor||!0===e.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l,u,c,d,f,p,m=null,h=s.getDOMDocument(),g=0,b=s.getCursor(t);if(s.upgradeWhitespacesAtPosition(o),l=s.getTextNodeAtStep(o)){for(m=(u=l.textNode).nextSibling,c=u.parentNode,d=a.getParagraphElement(u),p=0;p<i.length;p+=1){if(!(f="\t"===i[p])){var y=p;f=e((f=i)[y])&&(0===y||y===f.length-1||e(f[y-1]))}f&&(0===g?(l.offset!==u.length&&(m=u.splitText(l.offset)),0<p&&u.appendData(i.substring(0,p))):g<p&&(g=i.substring(g,p),c.insertBefore(h.createTextNode(g),m)),g=p+1,"\t"===i[p]?(f=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab")).appendChild(h.createTextNode("\t")):(" "!==i[p]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+i.charCodeAt(p)+")"),(f=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s")).appendChild(h.createTextNode(" "))),c.insertBefore(f,m))}return 0===g?u.insertData(l.offset,i):g<i.length&&(l=i.substring(g),c.insertBefore(h.createTextNode(l),m)),c=u.parentNode,m=u.nextSibling,c.removeChild(u),c.insertBefore(u,m),0===u.length&&u.parentNode.removeChild(u),s.emit(ops.OdtDocument.signalStepsInserted,{position:o}),b&&r&&(s.moveCursor(t,o+i.length,0),s.emit(ops.Document.signalCursorMoved,b)),s.downgradeWhitespacesAtPosition(o),s.downgradeWhitespacesAtPosition(o+i.length),s.getOdfCanvas().refreshSize(),s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:d,memberId:t,timeStamp:n}),s.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertText",memberid:t,timestamp:n,position:o,text:i,moveCursor:r}}},odf.CollapsingRules=function(e){function t(e){return n.isODFNode(e)||"br"===e.localName&&n.isLineBreak(e.parentNode)||e.nodeType===Node.TEXT_NODE&&n.isODFNode(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}var n=odf.OdfUtils,o=core.DomUtils;this.mergeChildrenIntoParent=function r(i){var a;return i.nodeType===Node.TEXT_NODE?(a=i.parentNode).removeChild(i):a=o.removeUnwantedNodes(i,t),(i=a)&&(i=a,i=!n.isParagraph(i)&&i!==e&&n.hasNoODFContent(i)),i?r(a):a}},ops.OpMergeParagraph=function(){function e(e){return odf.OdfUtils.isInlineRoot(e)?NodeFilter.FILTER_SKIP:c.isGroupingElement(e)&&c.hasNoODFContent(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function t(e){if(e.nodeType===Node.TEXT_NODE){if(0===e.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(c.isODFWhitespace(e.data)&&!1===c.isSignificantWhitespace(e,0))return!0;e="#text"}else e=(e.prefix?e.prefix+":":"")+e.localName;return runtime.log("WARN: Unexpected text element found near paragraph boundary ["+e+"]"),!1}function n(e){e.collapsed||(d.splitBoundaries(e),(e=c.getTextElements(e,!1,!0).filter(t)).forEach(function(e){e.parentNode.removeChild(e)}))}function o(e,t,n){e=e.convertCursorStepToDomPoint(t);var o=c.getParagraphElement(e.node,e.offset);return runtime.assert(Boolean(o),"Paragraph not found at step "+t),n&&n.setPosition(e.node,e.offset),o}var r,i,a,s,l,u,c=odf.OdfUtils,d=core.DomUtils,f=odf.Namespaces.textns;this.init=function(e){r=e.memberid,i=e.timestamp,a=e.moveCursor,s=e.paragraphStyleName,l=parseInt(e.sourceStartPosition,10),u=parseInt(e.destinationStartPosition,10)},this.isEdit=!0,this.group=void 0,this.execute=function(t){var c,p,m=t.getCursor(r);c=t.getRootNode();var h,g=new odf.CollapsingRules(c),b=t.createStepIterator(c,0,[t.getPositionFilter()],c);runtime.assert(u<l,"Destination paragraph ("+u+") must be before source paragraph ("+l+")"),p=o(t,u),c=o(t,l,b),b.previousStep(),runtime.assert(d.containsNode(p,b.container()),"Destination paragraph must be adjacent to the source paragraph"),h=p.ownerDocument.createRange(),b.setPosition(p,p.childNodes.length),b.roundToPreviousStep(),h.setStart(b.container(),b.offset()),h.setEnd(p,p.childNodes.length),n(h),h=p.childNodes.length;var y=c.ownerDocument.createRange();for(b.setPosition(c,0),b.roundToNextStep(),y.setStart(c,0),y.setEnd(b.container(),b.offset()),n(y),y=c.firstChild;y;)"editinfo"===y.localName?c.removeChild(y):(p.appendChild(y),d.removeUnwantedNodes(y,e)),y=c.firstChild;return runtime.assert(0===c.childNodes.length,"Source paragraph should be empty before it is removed"),g.mergeChildrenIntoParent(c),t.emit(ops.OdtDocument.signalStepsRemoved,{position:l-1}),b.setPosition(p,h),b.roundToClosestStep(),b.previousStep()||b.roundToNextStep(),t.downgradeWhitespaces(b),s?p.setAttributeNS(f,"text:style-name",s):p.removeAttributeNS(f,"style-name"),m&&a&&(t.moveCursor(r,l-1,0),t.emit(ops.Document.signalCursorMoved,m)),t.fixCursorPositions(),t.getOdfCanvas().refreshSize(),t.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:r,timeStamp:i}),t.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"MergeParagraph",memberid:r,timestamp:i,moveCursor:a,paragraphStyleName:s,sourceStartPosition:l,destinationStartPosition:u}}},ops.OpMoveCursor=function(){var e,t,n,o,r;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,o=i.length||0,r=i.selectionType||ops.OdtCursor.RangeSelection},this.isEdit=!1,this.group=void 0,this.execute=function(t){var i,a=t.getCursor(e);return!!a&&(i=t.convertCursorToDomRange(n,o),a.setSelectedRange(i,0<=o),a.setSelectionType(r),t.emit(ops.Document.signalCursorMoved,a),!0)},this.spec=function(){return{optype:"MoveCursor",memberid:e,timestamp:t,position:n,length:o,selectionType:r}}},ops.OpRemoveAnnotation=function(){var e,t,n,o,r=core.DomUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),o=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(e){function t(e){o.parentNode.insertBefore(e,o)}for(var o,i=e.getIteratorAtPosition(n).container();i.namespaceURI!==odf.Namespaces.officens||"annotation"!==i.localName;)i=i.parentNode;return null!==i&&(i=(o=i).annotationEndElement,e.getOdfCanvas().forgetAnnotation(o),r.getElementsByTagNameNS(o,"urn:webodf:names:cursor","cursor").forEach(t),r.getElementsByTagNameNS(o,"urn:webodf:names:cursor","anchor").forEach(t),o.parentNode.removeChild(o),i&&i.parentNode.removeChild(i),e.emit(ops.OdtDocument.signalStepsRemoved,{position:0<n?n-1:n}),e.getOdfCanvas().rerenderAnnotations(),e.fixCursorPositions(),!0)},this.spec=function(){return{optype:"RemoveAnnotation",memberid:e,timestamp:t,position:n,length:o}}},ops.OpRemoveBlob=function(){var e,t,n;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.filename},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().removeBlob(n),!0},this.spec=function(){return{optype:"RemoveBlob",memberid:e,timestamp:t,filename:n}}},ops.OpRemoveCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.removeCursor(e)},this.spec=function(){return{optype:"RemoveCursor",memberid:e,timestamp:t}}},ops.OpRemoveHyperlink=function(){var e,t,n,o,r=core.DomUtils,i=odf.OdfUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.position,o=r.length},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s=a.convertCursorToDomRange(n,o),l=i.getHyperlinkElements(s);return runtime.assert(1===l.length,"The given range should only contain a single link."),l=r.mergeIntoParent(l[0]),s.detach(),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.getOdfCanvas().rerenderAnnotations(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:i.getParagraphElement(l),memberId:e,timeStamp:t}),!0},this.spec=function(){return{optype:"RemoveHyperlink",memberid:e,timestamp:t,position:n,length:o}}},ops.OpRemoveMember=function(){var e,t;this.init=function(n){e=n.memberid,t=parseInt(n.timestamp,10)},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.getMember(e)&&(t.removeMember(e),t.emit(ops.Document.signalMemberRemoved,e),!0)},this.spec=function(){return{optype:"RemoveMember",memberid:e,timestamp:t}}},ops.OpRemoveStyle=function(){var e,t,n,o;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.styleName,o=r.styleFamily},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getFormatting().getStyleElement(n,o);return!!t&&(t.parentNode.removeChild(t),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:n,family:o}),!0)},this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:t,styleName:n,styleFamily:o}}},ops.OpRemoveText=function(){var e,t,n,o,r=odf.OdfUtils,i=core.DomUtils;this.init=function(r){runtime.assert(0<=r.length,"OpRemoveText only supports positive lengths"),e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),o=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s,l,u,c=a.getCursor(e),d=new odf.CollapsingRules(a.getRootNode());return a.upgradeWhitespacesAtPosition(n),a.upgradeWhitespacesAtPosition(n+o),s=a.convertCursorToDomRange(n,o),i.splitBoundaries(s),l=r.getTextElements(s,!1,!0),u=r.getParagraphElement(s.startContainer,s.startOffset),runtime.assert(void 0!==u,"Attempting to remove text outside a paragraph element"),s.detach(),l.forEach(function(e){e.parentNode?(runtime.assert(i.containsNode(u,e),"RemoveText only supports removing elements within the same paragraph"),d.mergeChildrenIntoParent(e)):runtime.log("WARN: text element has already been removed from it's container")}),a.emit(ops.OdtDocument.signalStepsRemoved,{position:n}),a.downgradeWhitespacesAtPosition(n),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:u,memberId:e,timeStamp:t}),c&&(c.resetSelectionType(),a.emit(ops.Document.signalCursorMoved,c)),a.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"RemoveText",memberid:e,timestamp:t,position:n,length:o}}},ops.OpSetBlob=function(){var e,t,n,o,r;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.filename,o=i.mimetype,r=i.content},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().setBlob(n,o,r),!0},this.spec=function(){return{optype:"SetBlob",memberid:e,timestamp:t,filename:n,mimetype:o,content:r}}},ops.OpSetParagraphStyle=function(){var e,t,n,o,r=odf.OdfUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.position,o=r.styleName},this.isEdit=!0,this.group=void 0,this.execute=function(i){var a,s;return a=i.getIteratorAtPosition(n),!!(s=r.getParagraphElement(a.container()))&&(runtime.assert(function(e,t,n){var o=[e.getPositionFilter()],r=n.container();return n=n.unfilteredDomOffset(),!1===e.createStepIterator(r,n,o,t).previousStep()}(i,s,a),"SetParagraphStyle position should be the first position in the paragraph"),o?s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",o):s.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),i.getOdfCanvas().refreshSize(),i.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:s,timeStamp:t,memberId:e}),i.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"SetParagraphStyle",memberid:e,timestamp:t,position:n,styleName:o}}},ops.OpSplitParagraph=function(){var e,t,n,o,r,i,a=odf.OdfUtils,s=odf.Namespaces.textns;this.init=function(a){e=a.memberid,t=a.timestamp,o=a.position,n=a.sourceParagraphPosition,i=a.paragraphStyleName,r="true"===a.moveCursor||!0===a.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(n){var l,u,c,d,f,p,m,h=n.getCursor(e);if(n.upgradeWhitespacesAtPosition(o),!(l=n.getTextNodeAtStep(o)))return!1;if(!(u=a.getParagraphElement(l.textNode)))return!1;for(c=a.isListItem(u.parentNode)?u.parentNode:u,0===l.offset?(m=l.textNode.previousSibling,p=null):(m=l.textNode,p=l.offset>=l.textNode.length?null:l.textNode.splitText(l.offset)),d=l.textNode;d!==c;){if(f=(d=d.parentNode).cloneNode(!1),p&&f.appendChild(p),m)for(;m&&m.nextSibling;)f.appendChild(m.nextSibling);else for(;d.firstChild;)f.appendChild(d.firstChild);d.parentNode.insertBefore(f,d.nextSibling),m=d,p=f}return a.isListItem(p)&&(p=p.childNodes.item(0)),i?p.setAttributeNS(s,"text:style-name",i):p.removeAttributeNS(s,"style-name"),0===l.textNode.length&&l.textNode.parentNode.removeChild(l.textNode),n.emit(ops.OdtDocument.signalStepsInserted,{position:o}),h&&r&&(n.moveCursor(e,o+1,0),n.emit(ops.Document.signalCursorMoved,h)),n.fixCursorPositions(),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:u,memberId:e,timeStamp:t}),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:e,timeStamp:t}),n.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"SplitParagraph",memberid:e,timestamp:t,position:o,sourceParagraphPosition:n,paragraphStyleName:i,moveCursor:r}}},ops.OpUpdateMember=function(){var e,t,n,o;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties,o=r.removedProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var r=t.getMember(e);return!!r&&(o&&r.removeProperties(o),n&&(r.setProperties(n),n.fullName&&function(t){var o="//dc:creator[@editinfo:memberid='"+e+"']";for(t=xmldom.XPath.getODFElementsWithXPath(t.getRootNode(),o,function(e){return"editinfo"===e?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(e)}),o=0;o<t.length;o+=1)t[o].textContent=n.fullName}(t)),t.emit(ops.Document.signalMemberUpdated,r),!0)},this.spec=function(){return{optype:"UpdateMember",memberid:e,timestamp:t,setProperties:n,removedProperties:o}}},ops.OpUpdateMetadata=function(){var e,t,n,o;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties,o=r.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),r=null;return o&&(r=o.attributes.split(",")),t.setMetadata(n,r),e.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==n?n:{},removedProperties:null!==r?r:[]}),!0},this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:t,setProperties:n,removedProperties:o}}},ops.OpUpdateParagraphStyle=function(){function e(e,t){var n,o,r=t?t.split(","):[];for(n=0;n<r.length;n+=1)o=r[n].split(":"),e.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(o[0]),o[1])}var t,n,o,r,i,a=odf.Namespaces.stylens;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.styleName,r=e.setProperties,i=e.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(t){var n,s,l,u=t.getFormatting();return!!(n=""!==o?u.getStyleElement(o,"paragraph"):u.getDefaultStyleElement("paragraph"))&&(s=n.getElementsByTagNameNS(a,"paragraph-properties").item(0),l=n.getElementsByTagNameNS(a,"text-properties").item(0),r&&u.updateStyle(n,r),i&&(u=i["style:paragraph-properties"],s&&u&&(e(s,u.attributes),0===s.attributes.length&&n.removeChild(s)),u=i["style:text-properties"],l&&u&&(e(l,u.attributes),0===l.attributes.length&&n.removeChild(l)),e(n,i.attributes)),t.getOdfCanvas().refreshCSS(),t.emit(ops.OdtDocument.signalParagraphStyleModified,o),t.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:t,timestamp:n,styleName:o,setProperties:r,removedProperties:i}}},ops.OperationFactory=function(){function e(e){return function(t){return new e}}var t;this.register=function(e,n){t[e]=n},this.create=function(e){var n=null,o=t[e.optype];return o&&(n=o(e)).init(e),n},t={AddMember:e(ops.OpAddMember),UpdateMember:e(ops.OpUpdateMember),RemoveMember:e(ops.OpRemoveMember),AddCursor:e(ops.OpAddCursor),ApplyDirectStyling:e(ops.OpApplyDirectStyling),SetBlob:e(ops.OpSetBlob),RemoveBlob:e(ops.OpRemoveBlob),InsertImage:e(ops.OpInsertImage),InsertTable:e(ops.OpInsertTable),InsertText:e(ops.OpInsertText),RemoveText:e(ops.OpRemoveText),MergeParagraph:e(ops.OpMergeParagraph),SplitParagraph:e(ops.OpSplitParagraph),SetParagraphStyle:e(ops.OpSetParagraphStyle),UpdateParagraphStyle:e(ops.OpUpdateParagraphStyle),AddStyle:e(ops.OpAddStyle),RemoveStyle:e(ops.OpRemoveStyle),MoveCursor:e(ops.OpMoveCursor),RemoveCursor:e(ops.OpRemoveCursor),AddAnnotation:e(ops.OpAddAnnotation),RemoveAnnotation:e(ops.OpRemoveAnnotation),UpdateMetadata:e(ops.OpUpdateMetadata),ApplyHyperlink:e(ops.OpApplyHyperlink),RemoveHyperlink:e(ops.OpRemoveHyperlink)}},ops.OperationRouter=function(){},ops.OperationRouter.prototype.setOperationFactory=function(e){},ops.OperationRouter.prototype.setPlaybackFunction=function(e){},ops.OperationRouter.prototype.push=function(e){},ops.OperationRouter.prototype.close=function(e){},ops.OperationRouter.prototype.subscribe=function(e,t){},ops.OperationRouter.prototype.unsubscribe=function(e,t){},ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){},ops.OperationRouter.prototype.hasSessionHostConnection=function(){},ops.OperationRouter.signalProcessingBatchStart="router/batchstart",ops.OperationRouter.signalProcessingBatchEnd="router/batchend",ops.TrivialOperationRouter=function(){var e,t,n=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),o=0;this.setOperationFactory=function(t){e=t},this.setPlaybackFunction=function(e){t=e},this.push=function(r){o+=1,n.emit(ops.OperationRouter.signalProcessingBatchStart,{}),r.forEach(function(n){(n=n.spec()).timestamp=Date.now(),(n=e.create(n)).group="g"+o,t(n)}),n.emit(ops.OperationRouter.signalProcessingBatchEnd,{})},this.close=function(e){e()},this.subscribe=function(e,t){n.subscribe(e,t)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.hasLocalUnsyncedOps=function(){return!1},this.hasSessionHostConnection=function(){return!0}},ops.Session=function(e){function t(e){r.emit(ops.OdtDocument.signalProcessingBatchStart,e)}function n(e){r.emit(ops.OdtDocument.signalProcessingBatchEnd,e)}var o=new ops.OperationFactory,r=new ops.OdtDocument(e),i=null;this.setOperationFactory=function(e){o=e,i&&i.setOperationFactory(o)},this.setOperationRouter=function(e){i&&(i.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,t),i.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,n)),(i=e).subscribe(ops.OperationRouter.signalProcessingBatchStart,t),i.subscribe(ops.OperationRouter.signalProcessingBatchEnd,n),e.setPlaybackFunction(function(e){return r.emit(ops.OdtDocument.signalOperationStart,e),!!e.execute(r)&&(r.emit(ops.OdtDocument.signalOperationEnd,e),!0)}),e.setOperationFactory(o)},this.getOperationFactory=function(){return o},this.getOdtDocument=function(){return r},this.enqueue=function(e){i.push(e)},this.close=function(e){i.close(function(t){t?e(t):r.close(e)})},this.destroy=function(e){r.destroy(e)},this.setOperationRouter(new ops.TrivialOperationRouter)},gui.AnnotationController=function(e,t,n){function o(){var e,t=!1;(e=(e=s.getCursor(n))&&e.getNode())&&(t=!c.isWithinAnnotation(e,s.getRootNode())),t!==l&&(l=t,u.emit(gui.AnnotationController.annotatableChanged,l))}function r(e){e.getMemberId()===n&&o()}function i(e){e===n&&o()}function a(e){e.getMemberId()===n&&o()}var s=e.getOdtDocument(),l=!1,u=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),c=odf.OdfUtils,d=core.StepDirection.NEXT;this.isAnnotatable=function(){return l},this.addAnnotation=function(){var t=new ops.OpAddAnnotation,o=(r=s.getCursorSelection(n)).length,r=r.position;l&&(0===o?o=void 0:(r=0<=o?r:r+o,o=Math.abs(o)),t.init({memberid:n,position:r,length:o,name:n+Date.now()}),e.enqueue([t]))},this.removeAnnotation=function(o){var r,i;r=s.getMember(n).getProperties().fullName,!0===t.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&r!==c.getAnnotationCreator(o)||(r=s.convertDomPointToCursorStep(o,0,d),i=s.convertDomPointToCursorStep(o,o.childNodes.length),(o=new ops.OpRemoveAnnotation).init({memberid:n,position:r,length:i-r}),(i=new ops.OpMoveCursor).init({memberid:n,position:0<r?r-1:r,length:0}),e.enqueue([o,i]))},this.subscribe=function(e,t){u.subscribe(e,t)},this.unsubscribe=function(e,t){u.unsubscribe(e,t)},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorAdded,r),s.unsubscribe(ops.Document.signalCursorRemoved,i),s.unsubscribe(ops.Document.signalCursorMoved,a),e()},t.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN),s.subscribe(ops.Document.signalCursorAdded,r),s.subscribe(ops.Document.signalCursorRemoved,i),s.subscribe(ops.Document.signalCursorMoved,a),o()},gui.AnnotationController.annotatableChanged="annotatable/changed",gui.Avatar=function(e,t){var n,o,r,i=this;this.setColor=function(e){o.style.borderColor=e},this.setImageUrl=function(e){i.isVisible()?o.src=e:r=e},this.isVisible=function(){return"block"===n.style.display},this.show=function(){r&&(o.src=r,r=void 0),n.style.display="block"},this.hide=function(){n.style.display="none"},this.markAsFocussed=function(e){e?n.classList.add("active"):n.classList.remove("active")},this.destroy=function(t){e.removeChild(n),t()},function(){var r=e.ownerDocument;n=r.createElement("div"),o=r.createElement("img"),n.appendChild(o),n.style.display=t?"block":"none",n.className="handle",e.appendChild(n)}()},gui.StepInfo=function(){},gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1},gui.StepInfo.prototype.container=function(){},gui.StepInfo.prototype.offset=function(){},gui.VisualStepScanner=function(){},gui.VisualStepScanner.prototype.process=function(e,t,n){},gui.GuiStepUtils=function(){function e(e){var r,i=null;return(e=n.getContentBounds(e))&&(e.container.nodeType===Node.TEXT_NODE?((r=e.container.ownerDocument.createRange()).setStart(e.container,e.startOffset),r.setEnd(e.container,e.endOffset),(i=0<r.getClientRects().length?r.getBoundingClientRect():null)&&" "===e.container.data.substring(e.startOffset,e.endOffset)&&1>=i.width&&(i=null),r.detach()):(t.isCharacterElement(e.container)||t.isCharacterFrame(e.container))&&(i=o.getBoundingClientRect(e.container))),i}var t=odf.OdfUtils,n=new odf.StepUtils,o=core.DomUtils,r=core.StepDirection.NEXT,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,a=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=e,this.moveToFilteredStep=function(t,n,o){function s(e,t){return t.process(p,c,d)&&(e=!0,!f&&t.token&&(f=t.token)),e}var l,u,c,d,f,p,m=n===r,h=t.snapshot();l=!1;do{l=e(t),p={token:t.snapshot(),container:t.container,offset:t.offset,direction:n,visualDirection:n===r?i:a},u=t.nextStep()?e(t):null,t.restore(p.token),m?(c=l,d=u):(c=u,d=l),l=o.reduce(s,!1)}while(!l&&t.advanceStep(n));return l||o.forEach(function(e){!f&&e.token&&(f=e.token)}),t.restore(f||h),Boolean(f)}},gui.Caret=function(e,t,n,o){function r(){c.style.opacity="0"===c.style.opacity?"1":"0",b.trigger()}function i(){return m.selectNodeContents(p),m.getBoundingClientRect()}function a(e){return E[e]!==x[e]}function s(){if(!1===x.isShown||e.getSelectionType()!==ops.OdtCursor.RangeSelection||!o&&!e.getSelectedRange().collapsed?(x.visibility="hidden",c.style.visibility="hidden",b.cancel()):(x.visibility="visible",c.style.visibility="visible",!1===x.isFocused?(c.style.opacity="1",b.cancel()):((N||a("visibility"))&&(c.style.opacity="1",b.cancel()),b.trigger())),w||C){var n;n=e.getNode();var r,s,l=v.getBoundingClientRect(y.getSizer()),p=!1,m=0;if(n.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active"),0<n.getClientRects().length)m=(s=i()).left-v.getBoundingClientRect(n).left,p=!0;else if(h.setPosition(n,0),!(s=S.getContentRect(h))&&h.nextStep()&&(r=S.getContentRect(h))&&(s=r,p=!0),s||(n.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),s=i(),p=!0),!s)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+e.getMemberId());n;){if(0<n.getClientRects().length){s=v.getBoundingClientRect(n),p=!0;break}n=n.parentNode}8>(n={top:(s=v.translateRect(s,l,y.getZoomLevel())).top,height:s.height,right:p?s.left:s.right,width:v.adaptRangeDifferenceToZoomLevel(m,y.getZoomLevel())}).height&&(n={top:n.top-(8-n.height)/2,height:8,right:n.right}),u.style.height=n.height+"px",u.style.top=n.top+"px",u.style.left=n.right-n.width+"px",u.style.width=n.width?n.width+"px":"",f&&((n=runtime.getWindow().getComputedStyle(e.getNode(),null)).font?f.style.font=n.font:(f.style.fontStyle=n.fontStyle,f.style.fontVariant=n.fontVariant,f.style.fontWeight=n.fontWeight,f.style.fontSize=n.fontSize,f.style.lineHeight=n.lineHeight,f.style.fontFamily=n.fontFamily))}x.isShown&&C&&t.scrollIntoView(c.getBoundingClientRect()),a("isFocused")&&d.markAsFocussed(x.isFocused),Object.keys(x).forEach(function(e){E[e]=x[e]}),w=C=N=!1}function l(e){u.parentNode.removeChild(u),p.parentNode.removeChild(p),e()}var u,c,d,f,p,m,h,g,b,y=e.getDocument().getCanvas(),v=core.DomUtils,S=new gui.GuiStepUtils,N=!1,C=!1,w=!1,x={isFocused:!1,isShown:!0,visibility:"hidden"},E={isFocused:!x.isFocused,isShown:!x.isShown,visibility:"hidden"};this.handleUpdate=function(){w=!0,g.trigger()},this.refreshCursorBlinking=function(){N=!0,g.trigger()},this.setFocus=function(){x.isFocused=!0,g.trigger()},this.removeFocus=function(){x.isFocused=!1,g.trigger()},this.show=function(){x.isShown=!0,g.trigger()},this.hide=function(){x.isShown=!1,g.trigger()},this.setAvatarImageUrl=function(e){d.setImageUrl(e)},this.setColor=function(e){c.style.borderColor=e,d.setColor(e)},this.getCursor=function(){return e},this.getFocusElement=function(){return c},this.toggleHandleVisibility=function(){d.isVisible()?d.hide():d.show()},this.showHandle=function(){d.show()},this.hideHandle=function(){d.hide()},this.setOverlayElement=function(e){f=e,u.appendChild(e),w=!0,g.trigger()},this.ensureVisible=function(){C=!0,g.trigger()},this.getBoundingClientRect=function(){return v.getBoundingClientRect(u)},this.destroy=function(e){core.Async.destroyAll([g.destroy,b.destroy,d.destroy,l],e)},function(){var t=e.getDocument(),o=[t.createRootFilter(e.getMemberId()),t.getPositionFilter()],i=t.getDOMDocument();m=i.createRange(),(p=i.createElement("span")).className="webodf-caretSizer",p.textContent="|",e.getNode().appendChild(p),(u=i.createElement("div")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e.getMemberId()),u.className="webodf-caretOverlay",(c=i.createElement("div")).className="caret",u.appendChild(c),d=new gui.Avatar(u,n),y.getSizer().appendChild(u),h=t.createStepIterator(e.getNode(),0,o,t.getRootNode()),g=core.Task.createRedrawTask(s),b=core.Task.createTimeoutTask(r,500),g.triggerImmediate()}()},odf.TextSerializer=function(){var e=this,t=odf.OdfUtils;this.filter=null,this.writeToString=function(n){return n?("\n"===(n=function n(o){var r,i="",a=e.filter?e.filter.acceptNode(o):NodeFilter.FILTER_ACCEPT,s=o.nodeType;if((a===NodeFilter.FILTER_ACCEPT||a===NodeFilter.FILTER_SKIP)&&t.isTextContentContainingNode(o))for(r=o.firstChild;r;)i+=n(r),r=r.nextSibling;return a===NodeFilter.FILTER_ACCEPT&&(s===Node.ELEMENT_NODE&&t.isParagraph(o)?i+="\n":s===Node.TEXT_NODE&&o.textContent&&(i+=o.textContent)),i}(n))[n.length-1]&&(n=n.substr(0,n.length-1)),n):""}},gui.MimeDataExporter=function(){var e;this.exportRangeToDataTransfer=function(t,n){var o;(o=n.startContainer.ownerDocument.createElement("span")).appendChild(n.cloneContents()),o=e.writeToString(o);try{t.setData("text/plain",o)}catch(e){t.setData("Text",o)}},(e=new odf.TextSerializer).filter=new odf.OdfNodeFilter},gui.Clipboard=function(e){this.setDataFromRange=function(t,n){var o,r=t.clipboardData;return o=runtime.getWindow(),!r&&o&&(r=o.clipboardData),r?(o=!0,e.exportRangeToDataTransfer(r,n),t.preventDefault()):o=!1,o}},gui.SessionContext=function(e,t){var n=e.getOdtDocument(),o=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e,r=n.getCursor(t);return!!r&&(e=r&&r.getNode(),r=n.getMember(t).getProperties().fullName,!(!(e=o.getParentAnnotation(e,n.getRootNode()))||o.getAnnotationCreator(e)!==r))}},gui.StyleSummary=function(e){function t(t,n){var o,i=t+"|"+n;return r.hasOwnProperty(i)||(o=[],e.forEach(function(e){e=(e=e.styleProperties[t])&&e[n],-1===o.indexOf(e)&&o.push(e)}),r[i]=o),r[i]}function n(e,n,o){return function(){var r=t(e,n);return o.length>=r.length&&r.every(function(e){return-1!==o.indexOf(e)})}}function o(e,n){var o=t(e,n);return 1===o.length?o[0]:void 0}var r={};this.getPropertyValues=t,this.getCommonValue=o,this.isBold=n("style:text-properties","fo:font-weight",["bold"]),this.isItalic=n("style:text-properties","fo:font-style",["italic"]),this.hasUnderline=n("style:text-properties","style:text-underline-style",["solid"]),this.hasStrikeThrough=n("style:text-properties","style:text-line-through-style",["solid"]),this.fontSize=function(){var e=o("style:text-properties","fo:font-size");return e&&parseFloat(e)},this.fontName=function(){return o("style:text-properties","style:font-name")},this.isAlignedLeft=n("style:paragraph-properties","fo:text-align",["left","start"]),this.isAlignedCenter=n("style:paragraph-properties","fo:text-align",["center"]),this.isAlignedRight=n("style:paragraph-properties","fo:text-align",["right","end"]),this.isAlignedJustified=n("style:paragraph-properties","fo:text-align",["justify"]),this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName},this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}},gui.DirectFormattingController=function(e,t,n,o,r,i,a){function s(){return k.value().styleSummary}function l(){return k.value().enabledFeatures}function u(e){var t;return e.collapsed?((t=e.startContainer).hasChildNodes()&&e.startOffset<t.childNodes.length&&(t=t.childNodes.item(e.startOffset)),e=[t]):e=B.getTextElements(e,!0,!1),e}function c(){var e=F.getCursor(o),r=e&&e.getSelectedRange(),i=[],a=(i=[],!0),s={directTextStyling:!0,directParagraphStyling:!0};return r&&(0===(i=u(r)).length&&(i=[r.startContainer,r.endContainer],a=!1),i=F.getFormatting().getAppliedStyles(i)),void 0!==i[0]&&H&&(i[0].styleProperties=M.mergeObjects(i[0].styleProperties,H)),!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(s.directTextStyling=s.directParagraphStyling=n.isLocalCursorWithinOwnAnnotation()),s.directTextStyling&&(s.directTextStyling=a&&void 0!==e&&e.getSelectionType()===ops.OdtCursor.RangeSelection),{enabledFeatures:s,appliedStyles:i,styleSummary:new gui.StyleSummary(i)}}function d(e,t){var n={};return Object.keys(e).forEach(function(o){var r=e[o](),i=t[o]();r!==i&&(n[o]=i)}),n}function f(){var e,t;t=_.styleSummary;var n=k.value(),o=n.styleSummary,r=_.enabledFeatures,i=n.enabledFeatures;e=d(t.text,o.text),t=d(t.paragraph,o.paragraph),r=!(i.directTextStyling===r.directTextStyling&&i.directParagraphStyling===r.directParagraphStyling),_=n,r&&U.emit(gui.DirectFormattingController.enabledChanged,i),0<Object.keys(e).length&&U.emit(gui.DirectFormattingController.textStylingChanged,e),0<Object.keys(t).length&&U.emit(gui.DirectFormattingController.paragraphStylingChanged,t)}function p(){k.reset(),f()}function m(e){("string"==typeof e?e:e.getMemberId())===o&&k.reset()}function h(){k.reset()}function g(e){var t=F.getCursor(o);e=e.paragraphElement,t&&B.getParagraphElement(t.getNode())===e&&k.reset()}function b(e,t){return t(!e()),!0}function y(t){if(l().directTextStyling){var n=F.getCursorSelection(o),r={"style:text-properties":t};0!==n.length?((t=new ops.OpApplyDirectStyling).init({memberid:o,position:n.position,length:n.length,setProperties:r}),e.enqueue([t])):(H=M.mergeObjects(H||{},r),k.reset())}}function v(e,t){var n={};n[e]=t,y(n)}function S(e){e=e.spec(),H&&e.memberid===o&&"SplitParagraph"!==e.optype&&(H=null,k.reset())}function N(e){v("fo:font-weight",e?"bold":"normal")}function C(e){v("fo:font-style",e?"italic":"normal")}function w(e){v("style:text-underline-style",e?"solid":"none")}function x(e){v("style:text-line-through-style",e?"solid":"none")}function E(t){if(l().directParagraphStyling){var n,i=F.getCursor(o).getSelectedRange(),a=(i=B.getParagraphElements(i),F.getFormatting()),s=[],u={};i.forEach(function(e){var i,l=F.convertDomPointToCursorStep(e,0,z),c=e.getAttributeNS(odf.Namespaces.textns,"style-name");(e=c?u.hasOwnProperty(c)?u[c]:void 0:n)||(e=r.generateStyleName(),c?(u[c]=e,i=a.createDerivedStyleObject(c,"paragraph",{})):(n=e,i={}),i=t(i),(c=new ops.OpAddStyle).init({memberid:o,styleName:e.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:i}),s.push(c)),(c=new ops.OpSetParagraphStyle).init({memberid:o,styleName:e.toString(),position:l}),s.push(c)}),e.enqueue(s)}}function T(e){!function(e){E(function(t){return M.mergeObjects(t,e)})}({"style:paragraph-properties":{"fo:text-align":e}})}function O(e,t){var n,o=F.getFormatting().getDefaultTabStopDistance(),r=t["style:paragraph-properties"];return r&&(r=r["fo:margin-left"],n=B.parseLength(r)),M.mergeObjects(t,{"style:paragraph-properties":{"fo:margin-left":n&&n.unit===o.unit?n.value+e*o.value+n.unit:e*o.value+o.unit}})}function A(e,t){var n=0===(n=u(e)).length?[e.startContainer]:n,o=0<(n=F.getFormatting().getAppliedStyles(n)).length?n[0].styleProperties:void 0,r=F.getFormatting().getAppliedStylesForElement(t).styleProperties;return!(!o||"text"!==o["style:family"]||!o["style:text-properties"])&&(!r||!r["style:text-properties"]||(o=o["style:text-properties"],r=r["style:text-properties"],!Object.keys(o).every(function(e){return o[e]===r[e]})))}function R(){}function P(){return!1}function D(){return!1}var _,k,I=this,F=e.getOdtDocument(),M=new core.Utils,B=odf.OdfUtils,U=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),L=odf.Namespaces.textns,z=core.StepDirection.NEXT,H=null;this.enabledFeatures=l,this.formatTextSelection=y,this.createCursorStyleOp=function(e,t,n){var r=null,i=H;return n&&(i=(n=k.value().appliedStyles[0])&&n.styleProperties),i&&i["style:text-properties"]&&((r=new ops.OpApplyDirectStyling).init({memberid:o,position:e,length:t,setProperties:{"style:text-properties":i["style:text-properties"]}}),H=null,k.reset()),r},this.setBold=N,this.setItalic=C,this.setHasUnderline=w,this.setHasStrikethrough=x,this.setFontSize=function(e){v("fo:font-size",e+"pt")},this.setFontName=function(e){v("style:font-name",e)},this.getAppliedStyles=function(){return k.value().appliedStyles},this.toggleBold=b.bind(I,function(){return s().isBold()},N),this.toggleItalic=b.bind(I,function(){return s().isItalic()},C),this.toggleUnderline=b.bind(I,function(){return s().hasUnderline()},w),this.toggleStrikethrough=b.bind(I,function(){return s().hasStrikeThrough()},x),this.isBold=function(){return s().isBold()},this.isItalic=function(){return s().isItalic()},this.hasUnderline=function(){return s().hasUnderline()},this.hasStrikeThrough=function(){return s().hasStrikeThrough()},this.fontSize=function(){return s().fontSize()},this.fontName=function(){return s().fontName()},this.isAlignedLeft=function(){return s().isAlignedLeft()},this.isAlignedCenter=function(){return s().isAlignedCenter()},this.isAlignedRight=function(){return s().isAlignedRight()},this.isAlignedJustified=function(){return s().isAlignedJustified()},this.alignParagraphLeft=function(){return T("left"),!0},this.alignParagraphCenter=function(){return T("center"),!0},this.alignParagraphRight=function(){return T("right"),!0},this.alignParagraphJustified=function(){return T("justify"),!0},this.indent=function(){return E(O.bind(null,1)),!0},this.outdent=function(){return E(O.bind(null,-1)),!0},this.createParagraphStyleOps=function(e){if(!l().directParagraphStyling)return[];var t,n,i=F.getCursor(o),a=i.getSelectedRange(),s=[];i.hasForwardSelection()?(t=i.getAnchorNode(),n=i.getNode()):(t=i.getNode(),n=i.getAnchorNode()),i=B.getParagraphElement(n),runtime.assert(Boolean(i),"DirectFormattingController: Cursor outside paragraph");var u=i,c=[F.getPositionFilter(),F.createRootFilter(o)];return!1!==F.createStepIterator(a.endContainer,a.endOffset,c,u).nextStep()?s:(n!==t&&(i=B.getParagraphElement(t)),(H||A(a,i))&&(a=(a=k.value().appliedStyles[0])&&a.styleProperties)?((i=i.getAttributeNS(L,"style-name"))&&(a={"style:text-properties":a["style:text-properties"]},a=F.getFormatting().createDerivedStyleObject(i,"paragraph",a)),t=r.generateStyleName(),(i=new ops.OpAddStyle).init({memberid:o,styleName:t,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:a}),s.push(i),(i=new ops.OpSetParagraphStyle).init({memberid:o,styleName:t,position:e}),s.push(i),s):s)},this.subscribe=function(e,t){U.subscribe(e,t)},this.unsubscribe=function(e,t){U.unsubscribe(e,t)},this.destroy=function(e){F.unsubscribe(ops.Document.signalCursorAdded,m),F.unsubscribe(ops.Document.signalCursorRemoved,m),F.unsubscribe(ops.Document.signalCursorMoved,m),F.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,h),F.unsubscribe(ops.OdtDocument.signalParagraphChanged,g),F.unsubscribe(ops.OdtDocument.signalOperationEnd,S),F.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,f),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),e()},F.subscribe(ops.Document.signalCursorAdded,m),F.subscribe(ops.Document.signalCursorRemoved,m),F.subscribe(ops.Document.signalCursorMoved,m),F.subscribe(ops.OdtDocument.signalParagraphStyleModified,h),F.subscribe(ops.OdtDocument.signalParagraphChanged,g),F.subscribe(ops.OdtDocument.signalOperationEnd,S),F.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),k=new core.LazyProperty(c),_=k.value(),i||(I.formatTextSelection=R,I.setBold=R,I.setItalic=R,I.setHasUnderline=R,I.setHasStrikethrough=R,I.setFontSize=R,I.setFontName=R,I.toggleBold=D,I.toggleItalic=D,I.toggleUnderline=D,I.toggleStrikethrough=D),a||(I.alignParagraphCenter=P,I.alignParagraphJustified=P,I.alignParagraphLeft=P,I.alignParagraphRight=P,I.createParagraphStyleOps=function(){return[]},I.indent=P,I.outdent=P)},gui.DirectFormattingController.enabledChanged="enabled/changed",gui.DirectFormattingController.textStylingChanged="textStyling/changed",gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed",gui.DirectFormattingController.SelectionInfo=function(){},gui.KeyboardHandler=function(){function e(e,n){switch(n||(n=t.None),e){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:n|=t.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:n|=t.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:n|=t.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:n|=t.Shift}return e+":"+n}var t=gui.KeyboardHandler.Modifier,n=null,o={};this.setDefault=function(e){n=e},this.bind=function(t,n,r,i){t=e(t,n),runtime.assert(i||!1===o.hasOwnProperty(t),"tried to overwrite the callback handler of key combo: "+t),o[t]=r},this.unbind=function(t,n){var r=e(t,n);delete o[r]},this.reset=function(){n=null,o={}},this.handleEvent=function(r){var i=r.keyCode,a=t.None;r.metaKey&&(a|=t.Meta),r.ctrlKey&&(a|=t.Ctrl),r.altKey&&(a|=t.Alt),r.shiftKey&&(a|=t.Shift),i=e(i,a),a=!1,(i=o[i])?a=i():null!==n&&(a=n(r)),a&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}},gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12},gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224},gui.HyperlinkClickHandler=function(e,t,n){function o(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.remove("webodf-inactiveLinks")}function r(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.add("webodf-inactiveLinks")}function i(){d.removeEventListener("focus",r,!1),p.forEach(function(e){t.unbind(e.keyCode,e.modifier),n.unbind(e.keyCode,e.modifier)}),p.length=0}function a(e){if(i(),e!==s.None){switch(d.addEventListener("focus",r,!1),e){case s.Ctrl:p.push({keyCode:l.Ctrl,modifier:s.None});break;case s.Meta:p.push({keyCode:l.LeftMeta,modifier:s.None}),p.push({keyCode:l.RightMeta,modifier:s.None}),p.push({keyCode:l.MetaInMozilla,modifier:s.None})}p.forEach(function(e){t.bind(e.keyCode,e.modifier,o),n.bind(e.keyCode,e.modifier,r)})}}var s=gui.KeyboardHandler.Modifier,l=gui.KeyboardHandler.KeyCode,u=xmldom.XPath,c=odf.OdfUtils,d=runtime.getWindow(),f=s.None,p=[];runtime.assert(null!==d,"Expected to be run in an environment which has a global window, like a browser."),this.handleClick=function(t){var n,o,r=t.target||t.srcElement;if(t.ctrlKey?n=s.Ctrl:t.metaKey&&(n=s.Meta),f===s.None||f===n){e:{for(;null!==r;){if(c.isHyperlink(r))break e;if(c.isParagraph(r))break;r=r.parentNode}r=null}r&&(""!==(r=c.getHyperlinkTarget(r))&&("#"===r[0]?(r=r.substring(1),n=e(),0===(o=u.getODFElementsWithXPath(n,"//text:bookmark-start[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI)).length&&(o=u.getODFElementsWithXPath(n,"//text:bookmark[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI)),0<o.length&&o[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(r)?runtime.log("WARN:","potentially malicious URL ignored"):d.open(r),t.preventDefault?t.preventDefault():t.returnValue=!1))}},this.setModifier=function(e){f!==e&&(runtime.assert(e===s.None||e===s.Ctrl||e===s.Meta,"Unsupported KeyboardHandler.Modifier value: "+e),(f=e)!==s.None?r():o(),a(f))},this.getModifier=function(){return f},this.destroy=function(e){r(),i(),e()}},gui.EventManager=function(e){function t(e,t,n){function o(t){n(t,r,function(t){t.type=e,i.emit(e,t)})}var r={},i=new core.EventNotifier([e]);this.subscribe=function(t){i.subscribe(e,t)},this.unsubscribe=function(t){i.unsubscribe(e,t)},this.destroy=function(){t.forEach(function(e){C.unsubscribe(e,o)})},t.forEach(function(e){C.subscribe(e,o)})}function n(e){runtime.clearTimeout(e),delete w[e]}function o(e,t,o){var r=e.touches.length,i=e.touches[0],a=t.timer;"touchmove"===e.type||"touchend"===e.type?a&&n(a):"touchstart"===e.type&&(1!==r?runtime.clearTimeout(a):a=function(e,t){var o=runtime.setTimeout(function(){e(),n(o)},t);return w[o]=!0,o}(function(){o({clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,target:e.target||e.srcElement||null,detail:1})},400)),t.timer=a}function r(e,t,n){var o=e.touches[0],r=e.target||e.srcElement||null,i=t.target;1!==e.touches.length||"touchend"===e.type?i=null:"touchstart"===e.type&&"webodf-draggable"===r.getAttribute("class")?i=r:"touchmove"===e.type&&i&&(e.preventDefault(),e.stopPropagation(),n({clientX:o.clientX,clientY:o.clientY,pageX:o.pageX,pageY:o.pageY,target:i,detail:1})),t.target=i}function i(e,t,n){var o=e.target||e.srcElement||null,r=t.dragging;"drag"===e.type?r=!0:"touchend"===e.type&&r&&(r=!1,n({clientX:(e=e.changedTouches[0]).clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:o,detail:1})),t.dragging=r}function a(){N.classList.add("webodf-touchEnabled"),C.unsubscribe("touchstart",a)}function s(e){var t=e.scrollTop,n=e.scrollLeft;this.restore=function(){e.scrollTop===t&&e.scrollLeft===n||(e.scrollTop=t,e.scrollLeft=n)}}function l(e,t){var n=S[e]||v[e]||null;return!n&&t&&(n=S[e]=new function(e){function t(e,t,n){var o,r=!1;o="on"+t,e.attachEvent&&(e.attachEvent(o,n),r=!0),!r&&e.addEventListener&&(e.addEventListener(t,n,!1),r=!0),r&&!b[t]||!e.hasOwnProperty(o)||(e[o]=n)}function n(e,t,n){var o="on"+t;e.detachEvent&&e.detachEvent(o,n),e.removeEventListener&&e.removeEventListener(t,n,!1),e[o]===n&&(e[o]=null)}function o(t){if(-1===i.indexOf(t)){if(i.push(t),r.filters.every(function(e){return e(t)}))try{a.emit(e,t)}catch(t){runtime.log("Error occurred while processing "+e+":\n"+t.message+"\n"+t.stack)}runtime.setTimeout(function(){i.splice(i.indexOf(t),1)},0)}}var r=this,i=[],a=new core.EventNotifier([e]);this.filters=[],this.subscribe=function(t){a.subscribe(e,t)},this.unsubscribe=function(t){a.unsubscribe(e,t)},this.destroy=function(){n(g,e,o),n(h,e,o),n(N,e,o)},y[e]&&t(g,e,o),t(h,e,o),t(N,e,o)}(e)),n}function u(e,t){l(e,!0).subscribe(t)}function c(e,t){var n=l(e,!1);n&&n.unsubscribe(t)}function d(){return e.getDOMDocument().activeElement===h}function f(){d()&&h.blur(),h.setAttribute("disabled","true")}function p(){h.removeAttribute("disabled")}function m(){var e;d()||(e=function(e){for(var t=[];e;)(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)&&t.push(new s(e)),e=e.parentNode;return t.push(new function(e){var t=e.scrollX,n=e.scrollY;this.restore=function(){e.scrollX===t&&e.scrollY===n||e.scrollTo(t,n)}}(g)),t}(h),p(),h.focus(),e.forEach(function(e){e.restore()}))}var h,g=runtime.getWindow(),b={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},y={mousedown:!0,mouseup:!0,focus:!0},v={},S={},N=e.getCanvas().getElement(),C=this,w={};this.addFilter=function(e,t){l(e,!0).filters.push(t)},this.removeFilter=function(e,t){var n=l(e,!0),o=n.filters.indexOf(t);-1!==o&&n.filters.splice(o,1)},this.subscribe=u,this.unsubscribe=c,this.hasFocus=d,this.focus=m,this.getEventTrap=function(){return h},this.setEditing=function(e){var t=d();t&&h.blur(),e?h.removeAttribute("readOnly"):h.setAttribute("readOnly","true"),t&&m()},this.destroy=function(e){c("touchstart",a),Object.keys(w).forEach(function(e){n(parseInt(e,10))}),w.length=0,Object.keys(v).forEach(function(e){v[e].destroy()}),v={},c("mousedown",f),c("mouseup",p),c("contextmenu",p),Object.keys(S).forEach(function(e){S[e].destroy()}),S={},h.parentNode.removeChild(h),e()},function(){var n=e.getOdfCanvas().getSizer(),s=n.ownerDocument;runtime.assert(Boolean(g),"EventManager requires a window object to operate correctly"),(h=s.createElement("textarea")).id="eventTrap",h.setAttribute("tabindex","-1"),h.setAttribute("readOnly","true"),h.setAttribute("rows","1"),n.appendChild(h),u("mousedown",f),u("mouseup",p),u("contextmenu",p),v.longpress=new t("longpress",["touchstart","touchmove","touchend"],o),v.drag=new t("drag",["touchstart","touchmove","touchend"],r),v.dragstop=new t("dragstop",["drag","touchend"],i),u("touchstart",a)}()},gui.IOSSafariSupport=function(e){function t(){n.innerHeight!==n.outerHeight&&(o.style.display="none",runtime.requestAnimationFrame(function(){o.style.display="block"}))}var n=runtime.getWindow(),o=e.getEventTrap();this.destroy=function(n){e.unsubscribe("focus",t),o.removeAttribute("autocapitalize"),o.style.WebkitTransform="",n()},e.subscribe("focus",t),o.setAttribute("autocapitalize","off"),o.style.WebkitTransform="translateX(-10000px)"},gui.HyperlinkController=function(e,t,n,o){function r(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==u&&(u=e,l.emit(gui.HyperlinkController.enabledChanged,u))}function i(e){e.getMemberId()===o&&r()}var a=odf.OdfUtils,s=e.getOdtDocument(),l=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),u=!1;this.isEnabled=function(){return u},this.subscribe=function(e,t){l.subscribe(e,t)},this.unsubscribe=function(e,t){l.unsubscribe(e,t)},this.addHyperlink=function(t,n){if(u){var r=s.getCursorSelection(o),i=new ops.OpApplyHyperlink,a=[];(0===r.length||n)&&(n=n||t,(i=new ops.OpInsertText).init({memberid:o,position:r.position,text:n}),r.length=n.length,a.push(i)),(i=new ops.OpApplyHyperlink).init({memberid:o,position:r.position,length:r.length,hyperlink:t}),a.push(i),e.enqueue(a)}},this.removeHyperlinks=function(){if(u){var t,n,r=s.createPositionIterator(s.getRootNode()),i=s.getCursor(o).getSelectedRange(),l=a.getHyperlinkElements(i),c=i.collapsed&&1===l.length,d=s.getDOMDocument().createRange(),f=[];0!==l.length&&(l.forEach(function(e){d.selectNodeContents(e),t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}),(n=new ops.OpRemoveHyperlink).init({memberid:o,position:t.position,length:t.length}),f.push(n)}),c||(c=l[0],-1===i.comparePoint(c,0)&&(d.setStart(c,0),d.setEnd(i.startContainer,i.startOffset),0<(t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:o,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(c)}),f.push(n))),l=l[l.length-1],r.moveToEndOfNode(l),r=r.unfilteredDomOffset(),1===i.comparePoint(l,r)&&(d.setStart(i.endContainer,i.endOffset),d.setEnd(l,r),0<(t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:o,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(l)}),f.push(n)))),e.enqueue(f),d.detach())}},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorMoved,i),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},s.subscribe(ops.Document.signalCursorMoved,i),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.HyperlinkController.enabledChanged="enabled/changed",gui.ImageController=function(e,t,n,o,r){function i(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==p&&(p=e,f.emit(gui.ImageController.enabledChanged,p))}function a(e){e.getMemberId()===o&&i()}var s={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},l=odf.Namespaces.textns,u=e.getOdtDocument(),c=odf.OdfUtils,d=u.getFormatting(),f=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),p=!1;this.isEnabled=function(){return p},this.subscribe=function(e,t){f.subscribe(e,t)},this.unsubscribe=function(e,t){f.unsubscribe(e,t)},this.insertImage=function(t,n,i,a){if(p){var f=new core.CSSUnits;if(runtime.assert(0<i&&0<a,"Both width and height of the image should be greater than 0px."),a={width:i,height:a},i=c.getParagraphElement(u.getCursor(o).getNode()).getAttributeNS(l,"style-name")){i=d.getContentSize(i,"paragraph");var m=1,h=1;a.width>i.width&&(m=i.width/a.width),a.height>i.height&&(h=i.height/a.height),i=Math.min(m,h),a={width:a.width*i,height:a.height*i}}i=f.convert(a.width,"px","cm")+"cm",f=f.convert(a.height,"px","cm")+"cm",h=u.getOdfCanvas().odfContainer().rootElement.styles,a=t.toLowerCase();var g;m=s.hasOwnProperty(a)?s[a]:null;a=[],runtime.assert(null!==m,"Image type is not supported: "+t),m="Pictures/"+r.generateImageName()+m,(g=new ops.OpSetBlob).init({memberid:o,filename:m,mimetype:t,content:n}),a.push(g),d.getStyleElement("Graphics","graphic",[h])||((t=new ops.OpAddStyle).init({memberid:o,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),a.push(t)),t=r.generateStyleName(),(n=new ops.OpAddStyle).init({memberid:o,styleName:t,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}}),a.push(n),(g=new ops.OpInsertImage).init({memberid:o,position:u.getCursorPosition(o),filename:m,frameWidth:i,frameHeight:f,frameStyleName:t,frameName:r.generateFrameName()}),a.push(g),e.enqueue(a)}},this.destroy=function(e){u.unsubscribe(ops.Document.signalCursorMoved,a),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),e()},u.subscribe(ops.Document.signalCursorMoved,a),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),i()},gui.ImageController.enabledChanged="enabled/changed",gui.ImageSelector=function(e){function t(){var t=e.getSizer(),n=r.createElement("div");return n.id="imageSelector",n.style.borderWidth="1px",t.appendChild(n),o.forEach(function(e){var t=r.createElement("div");t.className=e,n.appendChild(t)}),n}var n=odf.Namespaces.svgns,o="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),r=e.getElement().ownerDocument,i=!1;this.select=function(o){var a,s,l=r.getElementById("imageSelector");l||(l=t()),i=!0,a=l.parentNode,s=o.getBoundingClientRect();var u=a.getBoundingClientRect(),c=e.getZoomLevel();a=(s.left-u.left)/c-1,s=(s.top-u.top)/c-1,l.style.display="block",l.style.left=a+"px",l.style.top=s+"px",l.style.width=o.getAttributeNS(n,"width"),l.style.height=o.getAttributeNS(n,"height")},this.clearSelection=function(){var e;i&&(e=r.getElementById("imageSelector"))&&(e.style.display="none"),i=!1},this.isSelectorElement=function(e){var t=r.getElementById("imageSelector");return!!t&&(e===t||e.parentNode===t)}},function(){gui.InputMethodEditor=function(e,t){function n(e){h&&(e?h.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(h.getNode().removeAttributeNS("urn:webodf:names:cursor","composing"),c.textContent=""))}function o(){y&&(y=!1,n(!1),S.emit(gui.InputMethodEditor.signalCompositionEnd,{data:v}),v="")}function r(){C||(C=!0,o(),h&&h.getSelectedRange().collapsed?g.value="":g.value=p.writeToString(h.getSelectedRange().cloneContents()),g.setSelectionRange(0,g.value.length),C=!1)}function i(){t.hasFocus()&&d.trigger()}function a(){f=void 0,d.cancel(),n(!0),y||S.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function s(e){e=f=e.data,y=!0,v+=e,d.trigger()}function l(e){e.data!==f&&(e=e.data,y=!0,v+=e,d.trigger()),f=void 0}function u(){c.textContent=g.value}var c,d,f,p,m,h=null,g=t.getEventTrap(),b=g.ownerDocument,y=!1,v="",S=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),N=[],C=!1;this.subscribe=S.subscribe,this.unsubscribe=S.unsubscribe,this.registerCursor=function(n){n.getMemberId()===e&&((h=n).getNode().appendChild(c),n.subscribe(ops.OdtCursor.signalCursorUpdated,i),t.subscribe("input",u),t.subscribe("compositionupdate",u))},this.removeCursor=function(n){h&&n===e&&(h.getNode().removeChild(c),h.unsubscribe(ops.OdtCursor.signalCursorUpdated,i),t.unsubscribe("input",u),t.unsubscribe("compositionupdate",u),h=null)},this.destroy=function(e){t.unsubscribe("compositionstart",a),t.unsubscribe("compositionend",s),t.unsubscribe("textInput",l),t.unsubscribe("keypress",o),t.unsubscribe("focus",r),core.Async.destroyAll(m,e)},(p=new odf.TextSerializer).filter=new odf.OdfNodeFilter,t.subscribe("compositionstart",a),t.subscribe("compositionend",s),t.subscribe("textInput",l),t.subscribe("keypress",o),t.subscribe("focus",r),N.push(new function(e){function t(e){return i=e.which&&String.fromCharCode(e.which)===r,r=void 0,!1===i}function n(){i=!1}function o(e){r=e.data,i=!1}var r,i=!1;this.destroy=function(r){e.unsubscribe("textInput",n),e.unsubscribe("compositionend",o),e.removeFilter("keypress",t),r()},e.subscribe("textInput",n),e.subscribe("compositionend",o),e.addFilter("keypress",t)}(t)),m=N.map(function(e){return e.destroy}),(c=b.createElement("span")).setAttribute("id","composer"),d=core.Task.createTimeoutTask(r,1),m.push(d.destroy)},gui.InputMethodEditor.signalCompositionStart="input/compositionstart",gui.InputMethodEditor.signalCompositionEnd="input/compositionend"}(),gui.MetadataController=function(e,t){function n(e){i.emit(gui.MetadataController.signalMetadataChanged,e)}function o(e){var t=-1===a.indexOf(e);return t||runtime.log("Setting "+e+" is restricted."),t}var r=e.getOdtDocument(),i=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),a=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(n,r){var i,a={},s="";n&&Object.keys(n).filter(o).forEach(function(e){a[e]=n[e]}),r&&(s=r.filter(o).join(",")),(0<s.length||0<Object.keys(a).length)&&((i=new ops.OpUpdateMetadata).init({memberid:t,setProperties:a,removedProperties:0<s.length?{attributes:s}:null}),e.enqueue([i]))},this.getMetadata=function(e){var t;return runtime.assert("string"==typeof e,"Property must be a string"),t=e.split(":"),runtime.assert(2===t.length,"Property must be a namespace-prefixed string"),e=odf.Namespaces.lookupNamespaceURI(t[0]),runtime.assert(Boolean(e),"Prefix must be for an ODF namespace."),r.getOdfCanvas().odfContainer().getMetadata(e,t[1])},this.subscribe=function(e,t){i.subscribe(e,t)},this.unsubscribe=function(e,t){i.unsubscribe(e,t)},this.destroy=function(e){r.unsubscribe(ops.OdtDocument.signalMetadataUpdated,n),e()},r.subscribe(ops.OdtDocument.signalMetadataUpdated,n)},gui.MetadataController.signalMetadataChanged="metadata/changed",gui.PasteController=function(e,t,n,o){function r(){s=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function i(e){e.getMemberId()===o&&r()}var a=e.getOdtDocument(),s=!1,l=odf.Namespaces.textns,u=core.StepDirection.NEXT,c=odf.OdfUtils;this.isEnabled=function(){return s},this.paste=function(t){if(s){var n=a.getCursorPosition(o),r=a.getCursor(o).getNode(),i=(r=c.getParagraphElement(r)).getAttributeNS(l,"style-name")||"",d=n,f=[],p=a.convertDomPointToCursorStep(r,0,u);t.replace(/\r/g,"").split("\n").forEach(function(e){var t=new ops.OpInsertText,n=new ops.OpSplitParagraph;t.init({memberid:o,position:d,text:e,moveCursor:!0}),f.push(t),d+=e.length,n.init({memberid:o,position:d,paragraphStyleName:i,sourceParagraphPosition:p,moveCursor:!0}),f.push(n),p=d+=1}),f.pop(),e.enqueue(f)}},this.destroy=function(e){a.unsubscribe(ops.Document.signalCursorMoved,i),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},a.subscribe(ops.Document.signalCursorMoved,i),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.ClosestXOffsetScanner=function(e){function t(t){return null!==t&&void 0!==o&&Math.abs(t-e)>o}function n(n){null!==n&&!1===t(n)&&(o=Math.abs(n-e))}var o,r=this,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0,this.process=function(e,o,a){var s,l;return e.visualDirection===i?(s=o&&o.right,l=a&&a.left):(s=o&&o.left,l=a&&a.right),!(!t(s)&&!t(l))||((o||a)&&(n(s),n(l),r.token=e.token),!1)}},gui.LineBoundaryScanner=function(){var e=this,t=null;this.token=void 0,this.process=function(n,o,r){var i;if(i=r)if(t){var a=t;i=Math.min(a.bottom-a.top,r.bottom-r.top);var s=Math.max(a.top,r.top);a=Math.min(a.bottom,r.bottom)-s;i=.4>=(0<i?a/i:0)}else i=!1;return!o||r&&!i||(e.token=n.token),!!i||(t=(n=t)&&o?{left:Math.min(n.left,o.left),right:Math.max(n.right,o.right),top:Math.min(n.top,o.top),bottom:Math.min(n.bottom,o.bottom)}:n||o,!1)}},gui.ParagraphBoundaryScanner=function(){var e,t=this,n=!1,o=odf.OdfUtils;this.token=void 0,this.process=function(r){var i=o.getParagraphElement(r.container());return n||(e=i,n=!0),e!==i||(t.token=r.token,!1)}},odf.WordBoundaryFilter=function(e,t){function n(t,n,o){for(var r,i=null,a=e.getRootNode();t!==a&&null!==t&&null===i;)o(r=0>n?t.previousSibling:t.nextSibling)===NodeFilter.FILTER_ACCEPT&&(i=r),t=t.parentNode;return i}function o(e,t){var n;return null===e?p.NO_NEIGHBOUR:a.isCharacterElement(e)?p.SPACE_CHAR:e.nodeType===r||a.isTextSpan(e)||a.isHyperlink(e)?(n=e.textContent.charAt(t()),l.test(n)?p.SPACE_CHAR:s.test(n)?p.PUNCTUATION_CHAR:p.WORD_CHAR):p.OTHER}var r=Node.TEXT_NODE,i=Node.ELEMENT_NODE,a=odf.OdfUtils,s=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,l=/\s/,u=core.PositionFilter.FilterResult.FILTER_ACCEPT,c=core.PositionFilter.FilterResult.FILTER_REJECT,d=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,f=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,p={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var r=e.container(),a=e.leftNode(),s=e.rightNode(),l=e.unfilteredDomOffset,m=function(){return e.unfilteredDomOffset()-1};return r.nodeType===i&&(null===s&&(s=n(r,1,e.getNodeFilter())),null===a&&(a=n(r,-1,e.getNodeFilter()))),r!==s&&(l=function(){return 0}),r!==a&&null!==a&&(m=function(){return a.textContent.length-1}),r=o(a,m),s=o(s,l),r===p.WORD_CHAR&&s===p.WORD_CHAR||r===p.PUNCTUATION_CHAR&&s===p.PUNCTUATION_CHAR||t===d&&r!==p.NO_NEIGHBOUR&&s===p.SPACE_CHAR||t===f&&r===p.SPACE_CHAR&&s!==p.NO_NEIGHBOUR?c:u}},odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2},gui.SelectionController=function(e,t){function n(e){var n=e.spec();(e.isEdit||n.memberid===t)&&(g=void 0,b.cancel())}function o(){var e=y.getCursor(t).getNode();return y.createStepIterator(e,0,[N,w],y.getRootElement(e))}function r(e,t,n){n=new odf.WordBoundaryFilter(y,n);var o=y.getRootElement(e)||y.getRootNode(),r=y.createRootFilter(o);return y.createStepIterator(e,t,[N,r,n],o)}function i(e,t){return t?{anchorNode:e.startContainer,anchorOffset:e.startOffset,focusNode:e.endContainer,focusOffset:e.endOffset}:{anchorNode:e.endContainer,anchorOffset:e.endOffset,focusNode:e.startContainer,focusOffset:e.startOffset}}function a(e,n,o){var r=new ops.OpMoveCursor;return r.init({memberid:t,position:e,length:n||0,selectionType:o}),r}function s(n,o,r){var s;(s=i((s=y.getCursor(t)).getSelectedRange(),s.hasForwardSelection())).focusNode=n,s.focusOffset=o,r||(s.anchorNode=s.focusNode,s.anchorOffset=s.focusOffset),n=y.convertDomToCursorRange(s),e.enqueue([a(n.position,n.length)])}function l(e){var t;(t=r(e.startContainer,e.startOffset,E)).roundToPreviousStep()&&e.setStart(t.container(),t.offset()),(t=r(e.endContainer,e.endOffset,T)).roundToNextStep()&&e.setEnd(t.container(),t.offset())}function u(e){var t=(n=S.getParagraphElements(e))[0],n=n[n.length-1];t&&e.setStart(t,0),n&&(S.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(n):e.setEnd(n,n.childNodes.length))}function c(e,t,n,o){var r,i;o?(r=n.startContainer,i=n.startOffset):(r=n.endContainer,i=n.endOffset),v.containsNode(e,r)||(i=0>v.comparePoints(e,0,r,i)?0:e.childNodes.length,r=e),(e=y.createStepIterator(r,i,t,S.getParagraphElement(r)||e)).roundToClosestStep()||runtime.assert(!1,"No step found in requested range"),o?n.setStart(e.container(),e.offset()):n.setEnd(e.container(),e.offset())}function d(e,t){var n=o();n.advanceStep(e)&&s(n.container(),n.offset(),t)}function f(e,t){var n,r=g,i=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===r&&x&&(r=x()),isNaN(r)||(n=o(),C.moveToFilteredStep(n,e,i)&&n.advanceStep(e)&&(i=[new gui.ClosestXOffsetScanner(r),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],C.moveToFilteredStep(n,e,i)&&(s(n.container(),n.offset(),t),g=r,b.restart())))}function p(e,t){var n=o(),r=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];C.moveToFilteredStep(n,e,r)&&s(n.container(),n.offset(),t)}function m(e,n){var o;(o=r((o=i((o=y.getCursor(t)).getSelectedRange(),o.hasForwardSelection())).focusNode,o.focusOffset,E)).advanceStep(e)&&s(o.container(),o.offset(),n)}function h(e,n,o){var r=!1,a=i((a=y.getCursor(t)).getSelectedRange(),a.hasForwardSelection());r=y.getRootElement(a.focusNode);runtime.assert(Boolean(r),"SelectionController: Cursor outside root"),(a=y.createStepIterator(a.focusNode,a.focusOffset,[N,w],r)).roundToClosestStep(),a.advanceStep(e)&&(o=o(a.container()))&&(e===O?(a.setPosition(o,0),r=a.roundToNextStep()):(a.setPosition(o,o.childNodes.length),r=a.roundToPreviousStep()),r&&s(a.container(),a.offset(),n))}var g,b,y=e.getOdtDocument(),v=core.DomUtils,S=odf.OdfUtils,N=y.getPositionFilter(),C=new gui.GuiStepUtils,w=y.createRootFilter(t),x=null,E=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,T=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,O=core.StepDirection.PREVIOUS,A=core.StepDirection.NEXT;this.selectionToRange=function(e){var t=0<=v.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n=e.focusNode.ownerDocument.createRange();return t?(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)):(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),{range:n,hasForwardSelection:t}},this.rangeToSelection=i,this.selectImage=function(t){var n,o=y.getRootElement(t),r=y.createRootFilter(o);(o=y.createStepIterator(t,0,[r,y.getPositionFilter()],o)).roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame"),r=o.container(),n=o.offset(),o.setPosition(t,t.childNodes.length),o.roundToNextStep()||runtime.assert(!1,"No walkable position after frame"),t=a((t=y.convertDomToCursorRange({anchorNode:r,anchorOffset:n,focusNode:o.container(),focusOffset:o.offset()})).position,t.length,ops.OdtCursor.RegionSelection),e.enqueue([t])},this.expandToWordBoundaries=l,this.expandToParagraphBoundaries=u,this.selectRange=function(n,o,r){var s,d=y.getOdfCanvas().getElement(),f=[N];s=v.containsNode(d,n.startContainer),d=v.containsNode(d,n.endContainer),(s||d)&&(s&&d&&(2===r?l(n):3<=r&&u(n)),(r=o?y.getRootElement(n.startContainer):y.getRootElement(n.endContainer))||(r=y.getRootNode()),f.push(y.createRootFilter(r)),c(r,f,n,!0),c(r,f,n,!1),n=i(n,o),o=y.convertDomToCursorRange(n),n=y.getCursorSelection(t),(o.position!==n.position||o.length!==n.length)&&(n=a(o.position,o.length,ops.OdtCursor.RangeSelection),e.enqueue([n])))},this.moveCursorToLeft=function(){return d(O,!1),!0},this.moveCursorToRight=function(){return d(A,!1),!0},this.extendSelectionToLeft=function(){return d(O,!0),!0},this.extendSelectionToRight=function(){return d(A,!0),!0},this.setCaretXPositionLocator=function(e){x=e},this.moveCursorUp=function(){return f(O,!1),!0},this.moveCursorDown=function(){return f(A,!1),!0},this.extendSelectionUp=function(){return f(O,!0),!0},this.extendSelectionDown=function(){return f(A,!0),!0},this.moveCursorBeforeWord=function(){return m(O,!1),!0},this.moveCursorPastWord=function(){return m(A,!1),!0},this.extendSelectionBeforeWord=function(){return m(O,!0),!0},this.extendSelectionPastWord=function(){return m(A,!0),!0},this.moveCursorToLineStart=function(){return p(O,!1),!0},this.moveCursorToLineEnd=function(){return p(A,!1),!0},this.extendSelectionToLineStart=function(){return p(O,!0),!0},this.extendSelectionToLineEnd=function(){return p(A,!0),!0},this.extendSelectionToParagraphStart=function(){return h(O,!0,S.getParagraphElement),!0},this.extendSelectionToParagraphEnd=function(){return h(A,!0,S.getParagraphElement),!0},this.moveCursorToParagraphStart=function(){return h(O,!1,S.getParagraphElement),!0},this.moveCursorToParagraphEnd=function(){return h(A,!1,S.getParagraphElement),!0},this.moveCursorToDocumentStart=function(){return h(O,!1,y.getRootElement),!0},this.moveCursorToDocumentEnd=function(){return h(A,!1,y.getRootElement),!0},this.extendSelectionToDocumentStart=function(){return h(O,!0,y.getRootElement),!0},this.extendSelectionToDocumentEnd=function(){return h(A,!0,y.getRootElement),!0},this.extendSelectionToEntireDocument=function(){var n,o,r,i=y.getCursor(t);i=y.getRootElement(i.getNode());return runtime.assert(Boolean(i),"SelectionController: Cursor outside root"),(r=y.createStepIterator(i,0,[N,w],i)).roundToClosestStep(),n=r.container(),o=r.offset(),r.setPosition(i,i.childNodes.length),r.roundToClosestStep(),i=y.convertDomToCursorRange({anchorNode:n,anchorOffset:o,focusNode:r.container(),focusOffset:r.offset()}),e.enqueue([a(i.position,i.length)]),!0},this.destroy=function(e){y.unsubscribe(ops.OdtDocument.signalOperationStart,n),core.Async.destroyAll([b.destroy],e)},b=core.Task.createTimeoutTask(function(){g=void 0},2e3),y.subscribe(ops.OdtDocument.signalOperationStart,n)},gui.TextController=function(e,t,n,o,r,i){function a(){h=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function s(e){e.getMemberId()===o&&a()}function l(e,t,n){var o=[f.getPositionFilter()];return n&&o.push(f.createRootFilter(e.startContainer)),(n=f.createStepIterator(e.startContainer,e.startOffset,o,t)).roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start"),t=f.convertDomPointToCursorStep(n.container(),n.offset()),e.collapsed?e=t:(n.setPosition(e.endContainer,e.endOffset),n.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),e=f.convertDomPointToCursorStep(n.container(),n.offset())),{position:t,length:e-t}}function u(e){var t,n,r,i=p.getParagraphElements(e),a=e.cloneRange(),s=[];return t=i[0],1<i.length&&(p.hasNoODFContent(t)&&(t=i[i.length-1]),n=t.getAttributeNS(odf.Namespaces.textns,"style-name")||""),i.forEach(function(t,i){var u,c;a.setStart(t,0),a.collapse(!0),u=l(a,t,!1).position,0<i&&((c=new ops.OpMergeParagraph).init({memberid:o,paragraphStyleName:n,destinationStartPosition:r,sourceStartPosition:u,moveCursor:1===i}),s.unshift(c)),r=u,a.selectNodeContents(t),(u=m.rangeIntersection(a,e))&&(0<(u=l(u,t,!0)).length&&((c=new ops.OpRemoveText).init({memberid:o,position:u.position,length:u.length}),s.unshift(c)))}),s}function c(e){return 0>e.length&&(e.position+=e.length,e.length=-e.length),e}function d(t){if(!h)return!1;var n,r,i=f.getCursor(o).getSelectedRange().cloneRange(),a=c(f.getCursorSelection(o));if(0===a.length){a=void 0,n=f.getCursor(o).getNode(),r=f.getRootElement(n);var s=[f.getPositionFilter(),f.createRootFilter(r)];(r=f.createStepIterator(n,0,s,r)).roundToClosestStep()&&(t?r.nextStep():r.previousStep())&&(a=c(f.convertDomToCursorRange({anchorNode:n,anchorOffset:0,focusNode:r.container(),focusOffset:r.offset()})),t?(i.setStart(n,0),i.setEnd(r.container(),r.offset())):(i.setStart(r.container(),r.offset()),i.setEnd(n,0)))}return a&&e.enqueue(u(i)),void 0!==a}var f=e.getOdtDocument(),p=odf.OdfUtils,m=core.DomUtils,h=!1,g=odf.Namespaces.textns,b=core.StepDirection.NEXT;this.isEnabled=function(){return h},this.enqueueParagraphSplittingOps=function(){if(!h)return!1;var t,n=(t=f.getCursor(o)).getSelectedRange(),r=c(f.getCursorSelection(o)),a=[],s=(t=p.getParagraphElement(t.getNode())).getAttributeNS(g,"style-name")||"";return 0<r.length&&(a=a.concat(u(n))),(n=new ops.OpSplitParagraph).init({memberid:o,position:r.position,paragraphStyleName:s,sourceParagraphPosition:f.convertDomPointToCursorStep(t,0,b),moveCursor:!0}),a.push(n),i&&(r=i(r.position+1),a=a.concat(r)),e.enqueue(a),!0},this.removeTextByBackspaceKey=function(){return d(!1)},this.removeTextByDeleteKey=function(){return d(!0)},this.removeCurrentSelection=function(){if(!h)return!1;var t=f.getCursor(o).getSelectedRange();return e.enqueue(u(t)),!0},this.insertText=function(t){if(h){var n=f.getCursor(o).getSelectedRange(),i=c(f.getCursorSelection(o)),a=[],s=!1;0<i.length&&(a=a.concat(u(n)),s=!0),(n=new ops.OpInsertText).init({memberid:o,position:i.position,text:t,moveCursor:!0}),a.push(n),r&&(t=r(i.position,t.length,s))&&a.push(t),e.enqueue(a)}},this.destroy=function(e){f.unsubscribe(ops.Document.signalCursorMoved,s),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),e()},f.subscribe(ops.Document.signalCursorMoved,s),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),a()},gui.UndoManager=function(){},gui.UndoManager.prototype.subscribe=function(e,t){},gui.UndoManager.prototype.unsubscribe=function(e,t){},gui.UndoManager.prototype.setDocument=function(e){},gui.UndoManager.prototype.setInitialState=function(){},gui.UndoManager.prototype.initialize=function(){},gui.UndoManager.prototype.purgeInitialState=function(){},gui.UndoManager.prototype.setPlaybackFunction=function(e){},gui.UndoManager.prototype.hasUndoStates=function(){},gui.UndoManager.prototype.hasRedoStates=function(){},gui.UndoManager.prototype.moveForward=function(e){},gui.UndoManager.prototype.moveBackward=function(e){},gui.UndoManager.prototype.onOperationExecuted=function(e){},gui.UndoManager.prototype.isDocumentModified=function(){},gui.UndoManager.prototype.setDocumentModified=function(e){},gui.UndoManager.signalUndoStackChanged="undoStackChanged",gui.UndoManager.signalUndoStateCreated="undoStateCreated",gui.UndoManager.signalUndoStateModified="undoStateModified",gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged",gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1},function(){var e=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(t,n,o,r){function i(e,t){var n=F.getDOMDocument(),o=null;return n.caretRangeFromPoint?o={container:(n=n.caretRangeFromPoint(e,t)).startContainer,offset:n.startOffset}:n.caretPositionFromPoint&&(n=n.caretPositionFromPoint(e,t))&&n.offsetNode&&(o={container:n.offsetNode,offset:n.offset}),o}function a(e){var t=F.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():H.setDataFromRange(e,t)?ee.removeCurrentSelection():runtime.log("Cut operation failed")}function s(){return!1!==F.getCursor(n).getSelectedRange().collapsed}function l(e){var t=F.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():H.setDataFromRange(e,t)||runtime.log("Copy operation failed")}function u(e){var t;I.clipboardData&&I.clipboardData.getData?t=I.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),t&&(ee.removeCurrentSelection(),re.paste(t)),e.preventDefault?e.preventDefault():e.returnValue=!1}function c(){return!1}function d(e){J&&J.onOperationExecuted(e)}function f(e){F.emit(ops.OdtDocument.signalUndoStackChanged,e)}function p(){var e;return!!J&&(e=G.hasFocus(),J.moveBackward(1),e&&G.focus(),!0)}function m(){var e;return!!J&&(e=G.hasFocus(),J.moveForward(1),e&&G.focus(),!0)}function h(t){var r=F.getCursor(n).getSelectedRange(),a=(t.target||t.srcElement||null).getAttribute("end");r&&a&&(t=i(t.clientX,t.clientY))&&(oe.setUnfilteredPosition(t.container,t.offset),q.acceptPosition(oe)===e&&(r=r.cloneRange(),"left"===a?r.setStart(oe.container(),oe.unfilteredDomOffset()):r.setEnd(oe.container(),oe.unfilteredDomOffset()),o.setSelectedRange(r,"right"===a),F.emit(ops.Document.signalCursorMoved,o)))}function g(){ue.selectRange(o.getSelectedRange(),o.hasForwardSelection(),1)}function b(){var t=I.getSelection(),n=0<t.rangeCount&&ue.selectionToRange(t);V&&n&&(K=!0,ne.clearSelection(),oe.setUnfilteredPosition(t.focusNode,t.focusOffset),q.acceptPosition(oe)===e&&(2===ae?ue.expandToWordBoundaries(n.range):3<=ae&&ue.expandToParagraphBoundaries(n.range),o.setSelectedRange(n.range,n.hasForwardSelection),F.emit(ops.Document.signalCursorMoved,o)))}function y(e){var t=e.target||e.srcElement||null,o=F.getCursor(n);(V=null!==t&&U.containsNode(F.getOdfCanvas().getElement(),t))&&(K=!1,t=F.getRootElement(t)||F.getRootNode(),q=F.createRootFilter(t),ae=0===e.button?e.detail:0,o&&e.shiftKey?I.getSelection().collapse(o.getAnchorNode(),0):(e=I.getSelection(),t=o.getSelectedRange(),e.extend?o.hasForwardSelection()?(e.collapse(t.startContainer,t.startOffset),e.extend(t.endContainer,t.endOffset)):(e.collapse(t.endContainer,t.endOffset),e.extend(t.startContainer,t.startOffset)):(e.removeAllRanges(),e.addRange(t.cloneRange()))),1<ae&&b())}function v(e){var t=F.getRootElement(e),n=F.createRootFilter(t);return(t=F.createStepIterator(e,0,[n,F.getPositionFilter()],t)).setPosition(e,e.childNodes.length),t.roundToNextStep()?{container:t.container(),offset:t.offset()}:null}function S(e){var t;t=(t=I.getSelection())?{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}:null;var n,o,r=I.getSelection().isCollapsed;t.anchorNode||t.focusNode||!(n=i(e.clientX,e.clientY))||(t.anchorNode=n.container,t.anchorOffset=n.offset,t.focusNode=t.anchorNode,t.focusOffset=t.anchorOffset),L.isImage(t.focusNode)&&0===t.focusOffset&&L.isCharacterFrame(t.focusNode.parentNode)?(n=(o=t.focusNode.parentNode).getBoundingClientRect(),e.clientX>n.left&&(n=v(o))&&(t.focusNode=n.container,t.focusOffset=n.offset,r&&(t.anchorNode=t.focusNode,t.anchorOffset=t.focusOffset))):L.isImage(t.focusNode.firstChild)&&1===t.focusOffset&&L.isCharacterFrame(t.focusNode)&&(n=v(t.focusNode))&&(t.anchorNode=t.focusNode=n.container,t.anchorOffset=t.focusOffset=n.offset),t.anchorNode&&t.focusNode&&(t=ue.selectionToRange(t),ue.selectRange(t.range,t.hasForwardSelection,0===e.button?e.detail:0)),G.focus()}function N(e){var t;(t=i(e.clientX,e.clientY))&&(e={anchorNode:e=t.container,anchorOffset:t=t.offset,focusNode:e,focusOffset:t},e=ue.selectionToRange(e),ue.selectRange(e.range,e.hasForwardSelection,2),G.focus())}function C(e){var t,n,r,i=e.target||e.srcElement||null;D.processRequests(),V&&(L.isImage(i)&&L.isCharacterFrame(i.parentNode)&&I.getSelection().isCollapsed?(ue.selectImage(i.parentNode),G.focus()):ne.isSelectorElement(i)?G.focus():K?(n=(i=o.getSelectedRange()).collapsed,L.isImage(i.endContainer)&&0===i.endOffset&&L.isCharacterFrame(i.endContainer.parentNode)&&(r=v(r=i.endContainer.parentNode))&&(i.setEnd(r.container,r.offset),n&&i.collapse(!1)),ue.selectRange(i,o.hasForwardSelection(),0===e.button?e.detail:0),G.focus()):me?S(e):(t=U.cloneEvent(e),P=runtime.setTimeout(function(){S(t)},0)),ae=0,K=V=!1)}function w(e){var t=F.getCursor(n).getSelectedRange();t.collapsed||z.exportRangeToDataTransfer(e.dataTransfer,t)}function x(){V&&G.focus(),ae=0,K=V=!1}function E(e){C(e)}function T(e){var t=e.target||e.srcElement||null,n=null;"annotationRemoveButton"===t.className?(runtime.assert(Y,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),n=t.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),Q.removeAnnotation(n),G.focus()):"webodf-draggable"!==t.getAttribute("class")&&C(e)}function O(e){(e=e.data)&&(-1===e.indexOf("\n")?ee.insertText(e):re.paste(e))}function A(e){return function(t){return F.getCursor(n).getSelectionType()!==ops.OdtCursor.RangeSelection||e(t)}}function R(e){G.unsubscribe("keydown",W.handleEvent),G.unsubscribe("keypress",j.handleEvent),G.unsubscribe("keyup",X.handleEvent),G.unsubscribe("copy",l),G.unsubscribe("mousedown",y),G.unsubscribe("mousemove",D.trigger),G.unsubscribe("mouseup",T),G.unsubscribe("contextmenu",E),G.unsubscribe("dragstart",w),G.unsubscribe("dragend",x),G.unsubscribe("click",se.handleClick),G.unsubscribe("longpress",N),G.unsubscribe("drag",h),G.unsubscribe("dragstop",g),F.unsubscribe(ops.OdtDocument.signalOperationEnd,_.trigger),F.unsubscribe(ops.Document.signalCursorAdded,ie.registerCursor),F.unsubscribe(ops.Document.signalCursorRemoved,ie.removeCursor),F.unsubscribe(ops.OdtDocument.signalOperationEnd,d),e()}var P,D,_,k,I=runtime.getWindow(),F=t.getOdtDocument(),M=new gui.SessionConstraints,B=new gui.SessionContext(t,n),U=core.DomUtils,L=odf.OdfUtils,z=new gui.MimeDataExporter,H=new gui.Clipboard(z),W=new gui.KeyboardHandler,j=new gui.KeyboardHandler,X=new gui.KeyboardHandler,V=!1,Z=new odf.ObjectNameGenerator(F.getOdfCanvas().odfContainer(),n),K=!1,q=null,J=null,G=new gui.EventManager(F),Y=r.annotationsEnabled,Q=new gui.AnnotationController(t,M,n),$=new gui.DirectFormattingController(t,M,B,n,Z,r.directTextStylingEnabled,r.directParagraphStylingEnabled),ee=new gui.TextController(t,M,B,n,$.createCursorStyleOp,$.createParagraphStyleOps),te=new gui.ImageController(t,M,B,n,Z),ne=new gui.ImageSelector(F.getOdfCanvas()),oe=F.createPositionIterator(F.getRootNode()),re=new gui.PasteController(t,M,B,n),ie=new gui.InputMethodEditor(n,G),ae=0,se=new gui.HyperlinkClickHandler(F.getOdfCanvas().getElement,W,X),le=new gui.HyperlinkController(t,M,B,n),ue=new gui.SelectionController(t,n),ce=new gui.MetadataController(t,n),de=gui.KeyboardHandler.Modifier,fe=gui.KeyboardHandler.KeyCode,pe=-1!==I.navigator.appVersion.toLowerCase().indexOf("mac"),me=-1!==["iPad","iPod","iPhone"].indexOf(I.navigator.platform);runtime.assert(null!==I,"Expected to be run in an environment which has a global window, like a browser."),this.undo=p,this.redo=m,this.insertLocalCursor=function(){runtime.assert(void 0===t.getOdtDocument().getCursor(n),"Inserting local cursor a second time.");var e=new ops.OpAddCursor;e.init({memberid:n}),t.enqueue([e]),G.focus()},this.removeLocalCursor=function(){runtime.assert(void 0!==t.getOdtDocument().getCursor(n),"Removing local cursor without inserting before.");var e=new ops.OpRemoveCursor;e.init({memberid:n}),t.enqueue([e])},this.startEditing=function(){var e;ie.subscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),ie.subscribe(gui.InputMethodEditor.signalCompositionEnd,O),G.subscribe("beforecut",s),G.subscribe("cut",a),G.subscribe("beforepaste",c),G.subscribe("paste",u),J&&J.initialize(),G.setEditing(!0),se.setModifier(pe?de.Meta:de.Ctrl),W.bind(fe.Backspace,de.None,(e=ee.removeTextByBackspaceKey,function(){return e(),!0}),!0),W.bind(fe.Delete,de.None,ee.removeTextByDeleteKey),W.bind(fe.Tab,de.None,A(function(){return ee.insertText("\t"),!0})),pe?(W.bind(fe.Clear,de.None,ee.removeCurrentSelection),W.bind(fe.B,de.Meta,A($.toggleBold)),W.bind(fe.I,de.Meta,A($.toggleItalic)),W.bind(fe.U,de.Meta,A($.toggleUnderline)),W.bind(fe.L,de.MetaShift,A($.alignParagraphLeft)),W.bind(fe.E,de.MetaShift,A($.alignParagraphCenter)),W.bind(fe.R,de.MetaShift,A($.alignParagraphRight)),W.bind(fe.J,de.MetaShift,A($.alignParagraphJustified)),Y&&W.bind(fe.C,de.MetaShift,Q.addAnnotation),W.bind(fe.Z,de.Meta,p),W.bind(fe.Z,de.MetaShift,m)):(W.bind(fe.B,de.Ctrl,A($.toggleBold)),W.bind(fe.I,de.Ctrl,A($.toggleItalic)),W.bind(fe.U,de.Ctrl,A($.toggleUnderline)),W.bind(fe.L,de.CtrlShift,A($.alignParagraphLeft)),W.bind(fe.E,de.CtrlShift,A($.alignParagraphCenter)),W.bind(fe.R,de.CtrlShift,A($.alignParagraphRight)),W.bind(fe.J,de.CtrlShift,A($.alignParagraphJustified)),Y&&W.bind(fe.C,de.CtrlAlt,Q.addAnnotation),W.bind(fe.Z,de.Ctrl,p),W.bind(fe.Z,de.CtrlShift,m)),j.setDefault(A(function(e){var t;return!(!(t=null===e.which||void 0===e.which?String.fromCharCode(e.keyCode):0!==e.which&&0!==e.charCode?String.fromCharCode(e.which):null)||e.altKey||e.ctrlKey||e.metaKey)&&(ee.insertText(t),!0)})),j.bind(fe.Enter,de.None,A(ee.enqueueParagraphSplittingOps))},this.endEditing=function(){ie.unsubscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),ie.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,O),G.unsubscribe("cut",a),G.unsubscribe("beforecut",s),G.unsubscribe("paste",u),G.unsubscribe("beforepaste",c),G.setEditing(!1),se.setModifier(de.None),W.bind(fe.Backspace,de.None,function(){return!0},!0),W.unbind(fe.Delete,de.None),W.unbind(fe.Tab,de.None),pe?(W.unbind(fe.Clear,de.None),W.unbind(fe.B,de.Meta),W.unbind(fe.I,de.Meta),W.unbind(fe.U,de.Meta),W.unbind(fe.L,de.MetaShift),W.unbind(fe.E,de.MetaShift),W.unbind(fe.R,de.MetaShift),W.unbind(fe.J,de.MetaShift),Y&&W.unbind(fe.C,de.MetaShift),W.unbind(fe.Z,de.Meta),W.unbind(fe.Z,de.MetaShift)):(W.unbind(fe.B,de.Ctrl),W.unbind(fe.I,de.Ctrl),W.unbind(fe.U,de.Ctrl),W.unbind(fe.L,de.CtrlShift),W.unbind(fe.E,de.CtrlShift),W.unbind(fe.R,de.CtrlShift),W.unbind(fe.J,de.CtrlShift),Y&&W.unbind(fe.C,de.CtrlAlt),W.unbind(fe.Z,de.Ctrl),W.unbind(fe.Z,de.CtrlShift)),j.setDefault(null),j.unbind(fe.Enter,de.None)},this.getInputMemberId=function(){return n},this.getSession=function(){return t},this.getSessionConstraints=function(){return M},this.setUndoManager=function(e){J&&J.unsubscribe(gui.UndoManager.signalUndoStackChanged,f),(J=e)&&(J.setDocument(F),J.setPlaybackFunction(t.enqueue),J.subscribe(gui.UndoManager.signalUndoStackChanged,f))},this.getUndoManager=function(){return J},this.getMetadataController=function(){return ce},this.getAnnotationController=function(){return Q},this.getDirectFormattingController=function(){return $},this.getHyperlinkClickHandler=function(){return se},this.getHyperlinkController=function(){return le},this.getImageController=function(){return te},this.getSelectionController=function(){return ue},this.getTextController=function(){return ee},this.getEventManager=function(){return G},this.getKeyboardHandlers=function(){return{keydown:W,keypress:j}},this.destroy=function(e){var t=[D.destroy,_.destroy,$.destroy,ie.destroy,G.destroy,se.destroy,le.destroy,ce.destroy,ue.destroy,ee.destroy,R];k&&t.unshift(k.destroy),runtime.clearTimeout(P),core.Async.destroyAll(t,e)},D=core.Task.createRedrawTask(b),_=core.Task.createRedrawTask(function(){var e=F.getCursor(n);e&&e.getSelectionType()===ops.OdtCursor.RegionSelection&&(e=L.getImageElements(e.getSelectedRange())[0])?ne.select(e.parentNode):ne.clearSelection()}),W.bind(fe.Left,de.None,A(ue.moveCursorToLeft)),W.bind(fe.Right,de.None,A(ue.moveCursorToRight)),W.bind(fe.Up,de.None,A(ue.moveCursorUp)),W.bind(fe.Down,de.None,A(ue.moveCursorDown)),W.bind(fe.Left,de.Shift,A(ue.extendSelectionToLeft)),W.bind(fe.Right,de.Shift,A(ue.extendSelectionToRight)),W.bind(fe.Up,de.Shift,A(ue.extendSelectionUp)),W.bind(fe.Down,de.Shift,A(ue.extendSelectionDown)),W.bind(fe.Home,de.None,A(ue.moveCursorToLineStart)),W.bind(fe.End,de.None,A(ue.moveCursorToLineEnd)),W.bind(fe.Home,de.Ctrl,A(ue.moveCursorToDocumentStart)),W.bind(fe.End,de.Ctrl,A(ue.moveCursorToDocumentEnd)),W.bind(fe.Home,de.Shift,A(ue.extendSelectionToLineStart)),W.bind(fe.End,de.Shift,A(ue.extendSelectionToLineEnd)),W.bind(fe.Up,de.CtrlShift,A(ue.extendSelectionToParagraphStart)),W.bind(fe.Down,de.CtrlShift,A(ue.extendSelectionToParagraphEnd)),W.bind(fe.Home,de.CtrlShift,A(ue.extendSelectionToDocumentStart)),W.bind(fe.End,de.CtrlShift,A(ue.extendSelectionToDocumentEnd)),pe?(W.bind(fe.Left,de.Alt,A(ue.moveCursorBeforeWord)),W.bind(fe.Right,de.Alt,A(ue.moveCursorPastWord)),W.bind(fe.Left,de.Meta,A(ue.moveCursorToLineStart)),W.bind(fe.Right,de.Meta,A(ue.moveCursorToLineEnd)),W.bind(fe.Home,de.Meta,A(ue.moveCursorToDocumentStart)),W.bind(fe.End,de.Meta,A(ue.moveCursorToDocumentEnd)),W.bind(fe.Left,de.AltShift,A(ue.extendSelectionBeforeWord)),W.bind(fe.Right,de.AltShift,A(ue.extendSelectionPastWord)),W.bind(fe.Left,de.MetaShift,A(ue.extendSelectionToLineStart)),W.bind(fe.Right,de.MetaShift,A(ue.extendSelectionToLineEnd)),W.bind(fe.Up,de.AltShift,A(ue.extendSelectionToParagraphStart)),W.bind(fe.Down,de.AltShift,A(ue.extendSelectionToParagraphEnd)),W.bind(fe.Up,de.MetaShift,A(ue.extendSelectionToDocumentStart)),W.bind(fe.Down,de.MetaShift,A(ue.extendSelectionToDocumentEnd)),W.bind(fe.A,de.Meta,A(ue.extendSelectionToEntireDocument))):(W.bind(fe.Left,de.Ctrl,A(ue.moveCursorBeforeWord)),W.bind(fe.Right,de.Ctrl,A(ue.moveCursorPastWord)),W.bind(fe.Left,de.CtrlShift,A(ue.extendSelectionBeforeWord)),W.bind(fe.Right,de.CtrlShift,A(ue.extendSelectionPastWord)),W.bind(fe.A,de.Ctrl,A(ue.extendSelectionToEntireDocument))),me&&(k=new gui.IOSSafariSupport(G)),G.subscribe("keydown",W.handleEvent),G.subscribe("keypress",j.handleEvent),G.subscribe("keyup",X.handleEvent),G.subscribe("copy",l),G.subscribe("mousedown",y),G.subscribe("mousemove",D.trigger),G.subscribe("mouseup",T),G.subscribe("contextmenu",E),G.subscribe("dragstart",w),G.subscribe("dragend",x),G.subscribe("click",se.handleClick),G.subscribe("longpress",N),G.subscribe("drag",h),G.subscribe("dragstop",g),F.subscribe(ops.OdtDocument.signalOperationEnd,_.trigger),F.subscribe(ops.Document.signalCursorAdded,ie.registerCursor),F.subscribe(ops.Document.signalCursorRemoved,ie.removeCursor),F.subscribe(ops.OdtDocument.signalOperationEnd,d)}}(),gui.CaretManager=function(e,t){function n(e){return i.hasOwnProperty(e)?i[e]:null}function o(){return Object.keys(i).map(function(e){return i[e]})}function r(t){var n=i[t];n&&(delete i[t],t===e.getInputMemberId()?(s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.unsubscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.unsubscribe("compositionupdate",n.handleUpdate),l.unsubscribe("compositionend",n.handleUpdate),l.unsubscribe("focus",n.setFocus),l.unsubscribe("blur",n.removeFocus),a.removeEventListener("focus",n.show,!1),a.removeEventListener("blur",n.hide,!1)):s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n.destroy(function(){}))}var i={},a=runtime.getWindow(),s=e.getSession().getOdtDocument(),l=e.getEventManager();this.registerCursor=function(n,o,r){var u=n.getMemberId();return n=new gui.Caret(n,t,o,r),i[u]=n,u===e.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+u),s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.subscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.subscribe("compositionupdate",n.handleUpdate),l.subscribe("compositionend",n.handleUpdate),l.subscribe("focus",n.setFocus),l.subscribe("blur",n.removeFocus),a.addEventListener("focus",n.show,!1),a.addEventListener("blur",n.hide,!1),n.setOverlayElement(l.getEventTrap())):s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n},this.getCaret=n,this.getCarets=o,this.destroy=function(t){var n=o().map(function(e){return e.destroy});e.getSelectionController().setCaretXPositionLocator(null),s.unsubscribe(ops.Document.signalCursorRemoved,r),i={},core.Async.destroyAll(n,t)},e.getSelectionController().setCaretXPositionLocator(function(){var t,o=n(e.getInputMemberId());return o&&(t=o.getBoundingClientRect()),t?t.right:void 0}),s.subscribe(ops.Document.signalCursorRemoved,r)},gui.EditInfoHandle=function(e){var t,n=[],o=e.ownerDocument,r=o.documentElement.namespaceURI;this.setEdits=function(e){var i,a,s,l;for(n=e,core.DomUtils.removeAllChildNodes(t),e=0;e<n.length;e+=1)(i=o.createElementNS(r,"div")).className="editInfo",(a=o.createElementNS(r,"span")).className="editInfoColor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(s=o.createElementNS(r,"span")).className="editInfoAuthor",s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(l=o.createElementNS(r,"span")).className="editInfoTime",l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),l.appendChild(o.createTextNode(n[e].time.toString())),i.appendChild(a),i.appendChild(s),i.appendChild(l),t.appendChild(i)},this.show=function(){t.style.display="block"},this.hide=function(){t.style.display="none"},this.destroy=function(n){e.removeChild(t),n()},(t=o.createElementNS(r,"div")).setAttribute("class","editInfoHandle"),t.style.display="none",e.appendChild(t)},ops.EditInfo=function(e,t){var n,o={};this.getNode=function(){return n},this.getOdtDocument=function(){return t},this.getEdits=function(){return o},this.getSortedEdits=function(){return function(){var e,t=[];for(e in o)o.hasOwnProperty(e)&&t.push({memberid:e,time:o[e].time});return t.sort(function(e,t){return e.time-t.time}),t}()},this.addEdit=function(e,t){o[e]={time:t}},this.clearEdits=function(){o={}},this.destroy=function(t){e.parentNode&&e.removeChild(n),t()},n=t.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo"),e.insertBefore(n,e.firstChild)},gui.EditInfoMarker=function(e,t){function n(e,t){return runtime.setTimeout(function(){i.style.opacity=e},t)}var o,r,i,a,s,l,u=this;this.addEdit=function(t,o){var u=Date.now()-o;e.addEdit(t,o),r.setEdits(e.getSortedEdits()),i.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),runtime.clearTimeout(s),runtime.clearTimeout(l),1e4>u?(a=n(1,0),s=n(.5,1e4-u),l=n(.2,2e4-u)):1e4<=u&&2e4>u?(a=n(.5,0),l=n(.2,2e4-u)):a=n(.2,0)},this.getEdits=function(){return e.getEdits()},this.clearEdits=function(){e.clearEdits(),r.setEdits([]),i.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&i.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")},this.getEditInfo=function(){return e},this.show=function(){i.style.display="block"},this.hide=function(){u.hideHandle(),i.style.display="none"},this.showHandle=function(){r.show()},this.hideHandle=function(){r.hide()},this.destroy=function(t){runtime.clearTimeout(a),runtime.clearTimeout(s),runtime.clearTimeout(l),o.removeChild(i),r.destroy(function(n){n?t(n):e.destroy(t)})},function(){var n=e.getOdtDocument().getDOMDocument();(i=n.createElementNS(n.documentElement.namespaceURI,"div")).setAttribute("class","editInfoMarker"),i.onmouseover=function(){u.showHandle()},i.onmouseout=function(){u.hideHandle()},(o=e.getNode()).appendChild(i),r=new gui.EditInfoHandle(o),t||u.hide()}()},gui.HyperlinkTooltipView=function(e,t){var n,o,r,i=core.DomUtils,a=odf.OdfUtils,s=runtime.getWindow();runtime.assert(null!==s,"Expected to be run in an environment which has a global window, like a browser."),this.showTooltip=function(l){var u,c=l.target||l.srcElement,d=e.getSizer(),f=e.getZoomLevel();e:{for(;c;){if(a.isHyperlink(c))break e;if(a.isParagraph(c)||a.isInlineRoot(c))break;c=c.parentNode}c=null}if(c){var p;switch(i.containsNode(d,r)||d.appendChild(r),u=o,t()){case gui.KeyboardHandler.Modifier.Ctrl:p=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:p=runtime.tr("⌘-click to follow link");break;default:p=""}u.textContent=p,n.textContent=a.getHyperlinkTarget(c),r.style.display="block",u=s.innerWidth-r.offsetWidth-15,c=l.clientX>u?u:l.clientX+15,u=s.innerHeight-r.offsetHeight-10,l=l.clientY>u?u:l.clientY+10,c=(c-(d=d.getBoundingClientRect()).left)/f,l=(l-d.top)/f,r.style.left=c+"px",r.style.top=l+"px"}},this.hideTooltip=function(){r.style.display="none"},this.destroy=function(e){r.parentNode&&r.parentNode.removeChild(r),e()},function(){var t=e.getElement().ownerDocument;n=t.createElement("span"),o=t.createElement("span"),n.className="webodf-hyperlinkTooltipLink",o.className="webodf-hyperlinkTooltipText",(r=t.createElement("div")).className="webodf-hyperlinkTooltip",r.appendChild(n),r.appendChild(o),e.getElement().appendChild(r)}()},gui.OdfFieldView=function(e){var t,n=e.getElement().ownerDocument;this.showFieldHighlight=function(){t.appendChild(n.createTextNode(function(){var e;return(e=odf.OdfSchema.getFields().map(function(e){return e.replace(":","|")})).join(",\n")+"\n{ background-color: #D0D0D0; }\n\n"+(e=e.map(function(e){return e+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n")}()))},this.hideFieldHighlight=function(){for(var e=t.sheet,n=e.cssRules;n.length;)e.deleteRule(n.length-1)},this.destroy=function(e){t.parentNode&&t.parentNode.removeChild(t),e()},t=function(){var e=n.getElementsByTagName("head").item(0),t=n.createElement("style"),o="";return t.type="text/css",t.media="screen, print, handheld, projection",odf.Namespaces.forEachPrefix(function(e,t){o+="@namespace "+e+" url("+t+");\n"}),t.appendChild(n.createTextNode(o)),e.appendChild(t),t}()},gui.ShadowCursor=function(e){var t=e.getDOMDocument().createRange(),n=!0;this.removeFromDocument=function(){},this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId},this.getSelectedRange=function(){return t},this.setSelectedRange=function(e,o){t=e,n=!1!==o},this.hasForwardSelection=function(){return n},this.getDocument=function(){return e},this.getSelectionType=function(){return ops.OdtCursor.RangeSelection},t.setStart(e.getRootNode(),0)},gui.ShadowCursor.ShadowCursorMemberId="",gui.SelectionView=function(e){},gui.SelectionView.prototype.rerender=function(){},gui.SelectionView.prototype.show=function(){},gui.SelectionView.prototype.hide=function(){},gui.SelectionView.prototype.destroy=function(e){},gui.SelectionViewManager=function(e){function t(){return Object.keys(n).map(function(e){return n[e]})}var n={};this.getSelectionView=function(e){return n.hasOwnProperty(e)?n[e]:null},this.getSelectionViews=t,this.removeSelectionView=function(e){n.hasOwnProperty(e)&&(n[e].destroy(function(){}),delete n[e])},this.hideSelectionView=function(e){n.hasOwnProperty(e)&&n[e].hide()},this.showSelectionView=function(e){n.hasOwnProperty(e)&&n[e].show()},this.rerenderSelectionViews=function(){Object.keys(n).forEach(function(e){n[e].rerender()})},this.registerCursor=function(t,o){var r=t.getMemberId(),i=new e(t);return o?i.show():i.hide(),n[r]=i},this.destroy=function(e){var n=t();!function t(o,r){r?e(r):o<n.length?n[o].destroy(function(e){t(o+1,e)}):e()}(0,void 0)}},gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0},function(){function e(e,t){return void 0!==e?Boolean(e):t}gui.SessionView=function(t,n,o,r,i,a){function s(e){e.memberId===n&&N.getViewport().scrollIntoView(e.annotation.getBoundingClientRect())}function l(){var e=document.getElementsByTagName("head").item(0),t=document.createElement("style");return t.type="text/css",t.media="screen, print, handheld, projection",e.appendChild(t),t}function u(e){var t,n;for(n in w)w.hasOwnProperty(n)&&(t=w[n],e?t.show():t.hide())}function c(e){i.getCarets().forEach(function(t){e?t.showHandle():t.hideHandle()})}function d(e){!function(e,t,o){function r(t,n,o){n=t+'[editinfo|memberid="'+e+'"]'+o+n;e:{var r=y.firstChild;for(t=t+'[editinfo|memberid="'+e+'"]'+o+"{";r;){if(r.nodeType===Node.TEXT_NODE&&0===r.data.indexOf(t)){t=r;break e}r=r.nextSibling}t=null}t?t.data=n:y.appendChild(document.createTextNode(n))}r("div.editInfoMarker","{ background-color: "+o+"; }",""),r("span.editInfoColor","{ background-color: "+o+"; }",""),r("span.editInfoAuthor",'{ content: "'+t+'"; }',":before"),r("dc|creator","{ background-color: "+o+"; }",""),r(".webodf-selectionOverlay","{ fill: "+o+"; stroke: "+o+";}",""),e===n&&(r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),e=gui.ShadowCursor.ShadowCursorMemberId,r(".webodf-selectionOverlay","{ fill: "+o+"; stroke: "+o+";}",""),r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}(e.getMemberId(),(e=e.getProperties()).fullName,e.color)}function f(e){var t=e.getMemberId(),n=o.getOdtDocument().getMember(t).getProperties();i.registerCursor(e,E,T),a.registerCursor(e,!0),(e=i.getCaret(t))&&(e.setAvatarImageUrl(n.imageUrl),e.setColor(n.color)),runtime.log("+++ View here +++ eagerly created an Caret for '"+t+"'! +++")}function p(e){e=e.getMemberId();var t=a.getSelectionView(n),o=a.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),r=i.getCaret(n);e===n?(o.hide(),t&&t.show(),r&&r.show()):e===gui.ShadowCursor.ShadowCursorMemberId&&(o.show(),t&&t.hide(),r&&r.hide())}function m(e){a.removeSelectionView(e)}function h(e){var t=e.paragraphElement,n=e.memberId;e=e.timeStamp;var r,i="",a=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);a?(i=a.getAttributeNS("urn:webodf:names:editinfo","id"),r=w[i]):(i=Math.random().toString(),r=new ops.EditInfo(t,o.getOdtDocument()),r=new gui.EditInfoMarker(r,x),(a=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0)).setAttributeNS("urn:webodf:names:editinfo","id",i),w[i]=r),r.addEdit(n,new Date(e)),C.trigger()}function g(){var e;v.hasChildNodes()&&core.DomUtils.removeAllChildNodes(v),!0===r.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(e=o.getOdtDocument().getMember(n))&&(e=e.getProperties().fullName,v.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+e+"']) .annotationRemoveButton { display: none; }")))}function b(e){var t=Object.keys(w).map(function(e){return w[e]});S.unsubscribe(ops.Document.signalMemberAdded,d),S.unsubscribe(ops.Document.signalMemberUpdated,d),S.unsubscribe(ops.Document.signalCursorAdded,f),S.unsubscribe(ops.Document.signalCursorRemoved,m),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,h),S.unsubscribe(ops.Document.signalCursorMoved,p),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,a.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalTableAdded,a.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,a.rerenderSelectionViews),r.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),S.unsubscribe(ops.Document.signalMemberAdded,g),S.unsubscribe(ops.Document.signalMemberUpdated,g),y.parentNode.removeChild(y),v.parentNode.removeChild(v),function n(o,r){r?e(r):o<t.length?t[o].destroy(function(e){n(o+1,e)}):e()}(0,void 0)}var y,v,S,N,C,w={},x=e(t.editInfoMarkersInitiallyVisible,!0),E=e(t.caretAvatarsInitiallyVisible,!0),T=e(t.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){x||u(x=!0)},this.hideEditInfoMarkers=function(){x&&u(x=!1)},this.showCaretAvatars=function(){E||c(E=!0)},this.hideCaretAvatars=function(){E&&c(E=!1)},this.getSession=function(){return o},this.getCaret=function(e){return i.getCaret(e)},this.destroy=function(e){var t=[C.destroy,b];S.unsubscribe(ops.OdtDocument.signalAnnotationAdded,s),core.Async.destroyAll(t,e)},S=o.getOdtDocument(),N=S.getOdfCanvas(),S.subscribe(ops.OdtDocument.signalAnnotationAdded,s),S.subscribe(ops.Document.signalMemberAdded,d),S.subscribe(ops.Document.signalMemberUpdated,d),S.subscribe(ops.Document.signalCursorAdded,f),S.subscribe(ops.Document.signalCursorRemoved,m),S.subscribe(ops.OdtDocument.signalParagraphChanged,h),S.subscribe(ops.Document.signalCursorMoved,p),S.subscribe(ops.OdtDocument.signalParagraphChanged,a.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalTableAdded,a.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalParagraphStyleModified,a.rerenderSelectionViews),r.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),S.subscribe(ops.Document.signalMemberAdded,g),S.subscribe(ops.Document.signalMemberUpdated,g),(y=l()).appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);")),y.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);")),v=l(),g(),C=core.Task.createRedrawTask(function(){var e=N.getAnnotationViewManager();e&&(e.rehighlightAnnotations(),S.fixCursorPositions())})}}(),gui.SvgSelectionView=function(e){function t(){var e=h.getRootNode();f!==e&&(f=e,(p=h.getCanvas().getSizer()).appendChild(b),b.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),S.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),S.setAttribute("end","right"),v.setAttribute("r",8),S.setAttribute("r",8),b.appendChild(y),b.appendChild(v),b.appendChild(S))}function n(e){return e=e.getBoundingClientRect(),Boolean(e&&0!==e.height)}function o(e){var t,o=N.getTextElements(e,!0,!1),r=e.cloneRange(),i=e.cloneRange();if(e=e.cloneRange(),!o.length)return null;e:{var a=o[t=0],s=r.startContainer===a?r.startOffset:0,l=s;for(r.setStart(a,s),r.setEnd(a,l);!n(r);){if(a.nodeType===Node.ELEMENT_NODE&&l<a.childNodes.length)l=a.childNodes.length;else if(a.nodeType===Node.TEXT_NODE&&l<a.length)l+=1;else{if(!o[t]){t=!1;break e}a=o[t],t+=1,s=l=0}r.setStart(a,s),r.setEnd(a,l)}t=!0}if(!t)return null;e:{for(a=o[t=o.length-1],l=s=i.endContainer===a?i.endOffset:a.nodeType===Node.TEXT_NODE?a.length:a.childNodes.length,i.setStart(a,s),i.setEnd(a,l);!n(i);){if(a.nodeType===Node.ELEMENT_NODE&&0<s)s=0;else if(a.nodeType===Node.TEXT_NODE&&0<s)--s;else{if(!o[t]){o=!1;break e}a=o[t],--t,s=l=a.length||a.childNodes.length}i.setStart(a,s),i.setEnd(a,l)}o=!0}return o?(e.setStart(r.startContainer,r.startOffset),e.setEnd(i.endContainer,i.endOffset),{firstRange:r,lastRange:i,fillerRange:e}):null}function r(e,t){var n={};return n.top=Math.min(e.top,t.top),n.left=Math.min(e.left,t.left),n.right=Math.max(e.right,t.right),n.bottom=Math.max(e.bottom,t.bottom),n.width=n.right-n.left,n.height=n.bottom-n.top,n}function i(e,t){return t&&0<t.width&&0<t.height&&(e=e?r(e,t):t),e}function a(e){function t(e){return E.setUnfilteredPosition(e,0),b.acceptNode(e)===T&&a.acceptPosition(E)===T?T:O}function n(e){var n=null;return t(e)===T&&(n=C.getBoundingClientRect(e)),n}var o,r,a,s,l=e.commonAncestorContainer,u=e.startContainer,c=e.endContainer,d=e.startOffset,f=e.endOffset,p=null,m=g.createRange(),b=new odf.OdfNodeFilter;if(u===l||c===l)return p=(m=e.cloneRange()).getBoundingClientRect(),m.detach(),p;for(e=u;e.parentNode!==l;)e=e.parentNode;for(r=c;r.parentNode!==l;)r=r.parentNode;for(a=h.createRootFilter(u),l=e.nextSibling;l&&l!==r;)p=i(p,n(l)),l=l.nextSibling;if(N.isParagraph(e))p=i(p,C.getBoundingClientRect(e));else if(e.nodeType===Node.TEXT_NODE)l=e,m.setStart(l,d),m.setEnd(l,l===r?f:l.length),p=i(p,m.getBoundingClientRect());else for(l=(s=g.createTreeWalker(e,NodeFilter.SHOW_TEXT,t,!1)).currentNode=u;l&&l!==c;)m.setStart(l,d),m.setEnd(l,l.length),p=i(p,m.getBoundingClientRect()),o=l,d=0,l=s.nextNode();if(o||(o=u),N.isParagraph(r))p=i(p,C.getBoundingClientRect(r));else if(r.nodeType===Node.TEXT_NODE)l=r,m.setStart(l,l===e?d:0),m.setEnd(l,f),p=i(p,m.getBoundingClientRect());else for(l=(s=g.createTreeWalker(r,NodeFilter.SHOW_TEXT,t,!1)).currentNode=c;l&&l!==o;)m.setStart(l,0),m.setEnd(l,f),p=i(p,m.getBoundingClientRect()),(l=s.previousNode())&&(f=l.length);return p}function s(e,t){var n=e.getBoundingClientRect(),o={width:0};return o.top=n.top,o.bottom=n.bottom,o.height=n.height,o.left=o.right=t?n.right:n.left,o}function l(){var n,i=e.getSelectedRange();if(n=x&&e.getSelectionType()===ops.OdtCursor.RangeSelection&&!i.collapsed){t();var l,u,c,d,f,m,h=C.getBoundingClientRect(p),g=w.getZoomLevel();if(i=o(i)){var N;for(n=i.firstRange,l=i.lastRange,u=i.fillerRange,c=C.translateRect(s(n,!1),h,g),f=C.translateRect(s(l,!0),h,g),m=(d=(d=a(u))?C.translateRect(d,h,g):r(c,f)).left,d=c.left+Math.max(0,d.width-(c.left-d.left)),h=Math.min(c.top,f.top),g=f.top+f.height,m=[{x:c.left,y:h+c.height},{x:c.left,y:h},{x:d,y:h},{x:d,y:g-f.height},{x:f.right,y:g-f.height},{x:f.right,y:g},{x:m,y:g},{x:m,y:h+c.height},{x:c.left,y:h+c.height}],d="",N=0;N<m.length;N+=1)d+=m[N].x+","+m[N].y+" ";y.setAttribute("points",d),v.setAttribute("cx",c.left),v.setAttribute("cy",h+c.height/2),S.setAttribute("cx",f.right),S.setAttribute("cy",g-f.height/2),n.detach(),l.detach(),u.detach()}n=Boolean(i)}b.style.display=n?"block":"none"}function u(t){x&&t===e&&m.trigger()}function c(e){e=8/e,v.setAttribute("r",e),S.setAttribute("r",e)}function d(t){p.removeChild(b),p.classList.remove("webodf-virtualSelections"),e.getDocument().unsubscribe(ops.Document.signalCursorMoved,u),w.unsubscribe(gui.ZoomHelper.signalZoomChanged,c),t()}var f,p,m,h=e.getDocument(),g=h.getDOMDocument(),b=g.createElementNS("http://www.w3.org/2000/svg","svg"),y=g.createElementNS("http://www.w3.org/2000/svg","polygon"),v=g.createElementNS("http://www.w3.org/2000/svg","circle"),S=g.createElementNS("http://www.w3.org/2000/svg","circle"),N=odf.OdfUtils,C=core.DomUtils,w=h.getCanvas().getZoomHelper(),x=!0,E=e.getDocument().createPositionIterator(h.getRootNode()),T=NodeFilter.FILTER_ACCEPT,O=NodeFilter.FILTER_REJECT;this.rerender=function(){x&&m.trigger()},this.show=function(){x=!0,m.trigger()},this.hide=function(){x=!1,m.trigger()},this.destroy=function(e){core.Async.destroyAll([m.destroy,d],e)},function(){var n=e.getMemberId();m=core.Task.createRedrawTask(l),t(),b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n),p.classList.add("webodf-virtualSelections"),e.getDocument().subscribe(ops.Document.signalCursorMoved,u),w.subscribe(gui.ZoomHelper.signalZoomChanged,c),c(w.getZoomLevel())}()},gui.UndoStateRules=function(){function e(e,t){var n=e.length;this.previous=function(){for(--n;0<=n;--n)if(t(e[n]))return e[n];return null}}function t(e){var t;return(e=e.spec()).hasOwnProperty("position")&&(t=e.position),t}function n(e){return e.isEdit}function o(e,n,o){return o?(e=t(e))-(n=t(n))==n-(o=t(o)):0===(o=t(e)-t(n))||1===Math.abs(o)}this.isEditOperation=n,this.isPartOfOperationSet=function(t,r){var i,a=void 0!==t.group;if(!t.isEdit||0===r.length)return!0;if(i=r[r.length-1],a&&t.group===i.group)return!0;e:switch(t.spec().optype){case"RemoveText":case"InsertText":i=!0;break e;default:i=!1}if(i&&r.some(n)){if(a){var s;a=t.spec().optype;var l,u,c=(i=new e(r,n)).previous(),d=null;for(runtime.assert(Boolean(c),"No edit operations found in state"),u=c.group,runtime.assert(void 0!==u,"Operation has no group"),l=1;c&&c.group===u;){if(a===c.spec().optype){s=c;break}c=i.previous()}if(s){for(c=i.previous();c;){if(c.group!==u){if(2===l)break;u=c.group,l+=1}if(a===c.spec().optype){d=c;break}c=i.previous()}s=o(t,s,d)}else s=!1;return s}return s=t.spec().optype,i=(a=new e(r,n)).previous(),runtime.assert(Boolean(i),"No edit operations found in state"),s=s===i.spec().optype&&o(t,i,a.previous())}return!1}},function(){function e(e,t){this.mainId=void 0!==e?e:-1,this.subId=void 0!==t?t:-1}function t(t,o,r){var i,a,s;this.addOperation=function(e){t.isEditOperation(e)&&(s+=1),a.push(e)},this.isNextStateId=function(e){return e.mainId===i&&e.subId===s},this.getNextStateId=function(){return new e(i,s)},this.getOperations=function(){return a},i=n+=1,a=o||[],s=o&&r?o.reduce(function(e,n){return e+(t.isEditOperation(n)?1:0)},0):0}var n=0;gui.TrivialUndoManager=function(n){function o(){return!0!==g.isNextStateId(h)}function r(e){0<(e=e.getOperations()).length&&(w=!0,p(e),w=!1)}function i(){N.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:b.hasUndoStates(),redoAvailable:b.hasRedoStates()})}function a(e){var t=o();e!==t&&N.emit(gui.UndoManager.signalDocumentModifiedChanged,t)}function s(){g!==f&&g!==v[v.length-1]&&v.push(g)}function l(e){var t=e.previousSibling||e.nextSibling;e.parentNode.removeChild(e),y.normalizeTextNodes(t)}function u(e){return Object.keys(e).map(function(t){return e[t]})}function c(){var e=o(),n=d=m.cloneDocumentElement();y.getElementsByTagNameNS(n,"urn:webodf:names:cursor","cursor").forEach(l),y.getElementsByTagNameNS(n,"urn:webodf:names:cursor","anchor").forEach(l),s(),g=f=function(e){function n(e){var t=e.spec();if(s[t.memberid])switch(t.optype){case"AddCursor":i[t.memberid]||(i[t.memberid]=e,delete s[t.memberid],--o);break;case"MoveCursor":a[t.memberid]||(a[t.memberid]=e)}}var o,r,i={},a={},s={};for(r=e.pop(),m.getMemberIds().forEach(function(e){s[e]=!0}),o=Object.keys(s).length;r&&0<o;)(r=r.getOperations()).reverse(),r.forEach(n),r=e.pop();return new t(C,u(i).concat(u(a)))}([f].concat(v)),v.length=0,S.length=0,e||(h=g.getNextStateId()),i(),a(e)}var d,f,p,m,h,g,b=this,y=core.DomUtils,v=[],S=[],N=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),C=n||new gui.UndoStateRules,w=!1;this.subscribe=function(e,t){N.subscribe(e,t)},this.unsubscribe=function(e,t){N.unsubscribe(e,t)},this.isDocumentModified=o,this.setDocumentModified=function(t){o()!==t&&(h=t?new e:g.getNextStateId(),N.emit(gui.UndoManager.signalDocumentModifiedChanged,t))},this.hasUndoStates=function(){return 0<v.length},this.hasRedoStates=function(){return 0<S.length},this.setDocument=function(e){m=e},this.purgeInitialState=function(){var e=o();v.length=0,S.length=0,g=f=new t(C),h=g.getNextStateId(),d=null,i(),a(e)},this.setInitialState=c,this.initialize=function(){d||c()},this.setPlaybackFunction=function(e){p=e},this.onOperationExecuted=function(e){if(!w){var n=o();C.isEditOperation(e)&&(g===f||0<S.length)||!C.isPartOfOperationSet(e,g.getOperations())?(S.length=0,s(),g=new t(C,[e],!0),v.push(g),N.emit(gui.UndoManager.signalUndoStateCreated,{operations:g.getOperations()}),i()):(g.addOperation(e),N.emit(gui.UndoManager.signalUndoStateModified,{operations:g.getOperations()})),a(n)}},this.moveForward=function(e){for(var t,n=0,s=o();e&&S.length;)t=S.pop(),v.push(t),r(t),--e,n+=1;return n&&(g=v[v.length-1],i(),a(s)),n},this.moveBackward=function(e){for(var t=0,n=o();e&&v.length;)S.push(v.pop()),--e,t+=1;return t&&(m.getMemberIds().forEach(function(e){m.hasCursor(e)&&m.removeCursor(e)}),m.setDocumentElement(d.cloneNode(!0)),N.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),r(f),v.forEach(r),g=v[v.length-1]||f,i(),a(n)),t},g=f=new t(C),h=g.getNextStateId()},gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"}(),odf.GraphicProperties=function(e,t,n){var o=this,r=odf.Namespaces.stylens,i=odf.Namespaces.svgns;this.verticalPos=function(){return o.data.value("verticalPos")},this.verticalRel=function(){return o.data.value("verticalRel")},this.horizontalPos=function(){return o.data.value("horizontalPos")},this.horizontalRel=function(){return o.data.value("horizontalRel")},this.strokeWidth=function(){return o.data.value("strokeWidth")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{verticalPos:function(){var t=e.getAttributeNS(r,"vertical-pos");return""===t?void 0:t},verticalRel:function(){var t=e.getAttributeNS(r,"vertical-rel");return""===t?void 0:t},horizontalPos:function(){var t=e.getAttributeNS(r,"horizontal-pos");return""===t?void 0:t},horizontalRel:function(){var t=e.getAttributeNS(r,"horizontal-rel");return""===t?void 0:t},strokeWidth:function(){var n=e.getAttributeNS(i,"stroke-width");return t.parseLength(n)}})},odf.ComputedGraphicProperties=function(){var e;this.setGraphicProperties=function(t){e=t},this.verticalPos=function(){return e&&e.verticalPos()||"from-top"},this.verticalRel=function(){return e&&e.verticalRel()||"page"},this.horizontalPos=function(){return e&&e.horizontalPos()||"from-left"},this.horizontalRel=function(){return e&&e.horizontalRel()||"page"}},odf.PageLayoutProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.pageHeight=function(){return o.data.value("pageHeight")||1123},this.pageWidth=function(){return o.data.value("pageWidth")||794},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{pageHeight:function(){var n;return e&&(n=e.getAttributeNS(r,"page-height"),n=t.parseLength(n)),n},pageWidth:function(){var n;return e&&(n=e.getAttributeNS(r,"page-width"),n=t.parseLength(n)),n}})},odf.PageLayout=function(e,t,n){var o=null;e&&(o=t.getPropertiesElement("page-layout-properties",e)),this.pageLayout=new odf.PageLayoutProperties(o,t,n&&n.pageLayout)},odf.PageLayoutCache=function(){},odf.PageLayoutCache.prototype.getPageLayout=function(e){},odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){},odf.ParagraphProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.marginTop=function(){return o.data.value("marginTop")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{marginTop:function(){var o=e.getAttributeNS(r,"margin-top");return t.parsePositiveLengthOrPercent(o,"marginTop",n&&n.data)}})},odf.ComputedParagraphProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.marginTop=function(){var n,o;if(e.hasOwnProperty("marginTop"))n=e.marginTop;else{for(o=0;void 0===n&&o<t.length;o+=1)n=t[o].marginTop();e.marginTop=n}return n||0}},odf.TextProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.fontSize=function(){return o.data.value("fontSize")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{fontSize:function(){var o=e.getAttributeNS(r,"font-size");return t.parsePositiveLengthOrPercent(o,"fontSize",n&&n.data)}})},odf.ComputedTextProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.fontSize=function(){var n,o;if(e.hasOwnProperty("fontSize"))n=e.fontSize;else{for(o=0;void 0===n&&o<t.length;o+=1)n=t[o].fontSize();e.fontSize=n}return n||12}},odf.MasterPage=function(e,t){var n;e?(n=e.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=t.getPageLayout(n)):this.pageLayout=t.getDefaultPageLayout()},odf.MasterPageCache=function(){},odf.MasterPageCache.prototype.getMasterPage=function(e){},odf.StylePileEntry=function(e,t,n,o){this.masterPage=function(){var t=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),o=null;return t&&(o=n.getMasterPage(t)),o},function(n){var r=e.getAttributeNS(odf.Namespaces.stylens,"family"),i=null;"graphic"!==r&&"chart"!==r||(n.graphic=void 0===o?void 0:o.graphic,null!==(i=t.getPropertiesElement("graphic-properties",e,i))&&(n.graphic=new odf.GraphicProperties(i,t,n.graphic))),"paragraph"!==r&&"table-cell"!==r&&"graphic"!==r&&"presentation"!==r&&"chart"!==r||(n.paragraph=void 0===o?void 0:o.paragraph,null!==(i=t.getPropertiesElement("paragraph-properties",e,i))&&(n.paragraph=new odf.ParagraphProperties(i,t,n.paragraph))),"text"!==r&&"paragraph"!==r&&"table-cell"!==r&&"graphic"!==r&&"presentation"!==r&&"chart"!==r||(n.text=void 0===o?void 0:o.text,null!==(i=t.getPropertiesElement("text-properties",e,i))&&(n.text=new odf.TextProperties(i,t,n.text)))}(this)},odf.StylePile=function(e,t){function n(n,o){var a,s;return n.hasAttributeNS(i,"parent-style-name")&&(s=n.getAttributeNS(i,"parent-style-name"),-1===o.indexOf(s)&&(a=r(s,o))),new odf.StylePileEntry(n,e,t,a)}var o,r,i=odf.Namespaces.stylens,a={},s={},l={},u={};r=function(e,t){var o,r=l[e];return!r&&(o=a[e])&&(t.push(e),r=n(o,t),l[e]=r),r},this.getStyle=function(e){var t,o=u[e]||l[e],r=[];return o||((t=s[e])||(t=a[e])&&r.push(e),t&&(o=n(t,r))),o},this.addCommonStyle=function(e){var t;e.hasAttributeNS(i,"name")&&(t=e.getAttributeNS(i,"name"),a.hasOwnProperty(t)||(a[t]=e))},this.addAutomaticStyle=function(e){var t;e.hasAttributeNS(i,"name")&&(t=e.getAttributeNS(i,"name"),s.hasOwnProperty(t)||(s[t]=e))},this.setDefaultStyle=function(e){void 0===o&&(o=n(e,[]))},this.getDefaultStyle=function(){return o}},odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties,this.graphic=new odf.ComputedGraphicProperties},odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties},odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties},odf.StyleCache=function(e){function t(e,t,n,o){var r;if(t=n.getAttributeNS(t,"class-names"))for(t=t.split(" "),r=0;r<t.length;r+=1)(n=t[r])&&(o.push(e),o.push(n))}function n(e,n){var o=C.getStyleName("paragraph",e);return void 0!==o&&(n.push("paragraph"),n.push(o)),e.namespaceURI!==S||"h"!==e.localName&&"p"!==e.localName||t("paragraph",S,e,n),n}function o(e,t,n){var o,r,i,s,l=[];for(o=0;o<e.length;o+=2)i=e[o],s=e[o+1],void 0!==(s=(i=a[i]).getStyle(s))&&(void 0!==(s=s[t])&&s!==r&&(l.push(s),r=s));return(s=(i=a[n]).getDefaultStyle())&&(void 0!==(s=s[t])&&s!==r&&l.push(s)),l}function r(o,i){var a=C.getStyleName("text",o),s=o.parentNode;return void 0!==a&&(i.push("text"),i.push(a)),"span"===o.localName&&o.namespaceURI===S&&t("text",S,o,i),s&&s!==e?(s.namespaceURI!==S||"p"!==s.localName&&"h"!==s.localName?r(s,i):n(s,i),i):i}function i(e){return e=e.getAttributeNS(N,"family"),a[e]}var a,s,l,u,c,d,f,p,m,h,g,b,y,v=this,S=odf.Namespaces.textns,N=odf.Namespaces.stylens,C=new odf.StyleInfo,w=new odf.StyleParseUtils;this.getComputedGraphicStyle=function(e){var t=[];void 0!==(e=C.getStyleName("graphic",e))&&(t.push("graphic"),t.push(e)),e=t.join("/");var n=u[e];return runtime.assert(0==t.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedGraphicStyle).graphic.setGraphicProperties(o(t,"graphic","graphic")[0]),n.text.setStyleChain(o(t,"text","graphic")),n.paragraph.setStyleChain(o(t,"paragraph","graphic")),u[e]=n),n},this.getComputedParagraphStyle=function(e){var t=(e=n(e,[])).join("/"),r=l[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===r&&((r=new odf.ComputedParagraphStyle).text.setStyleChain(o(e,"text","paragraph")),r.paragraph.setStyleChain(o(e,"paragraph","paragraph")),l[t]=r),r},this.getComputedTextStyle=function(e){var t=(e=r(e,[])).join("/"),n=s[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedTextStyle).text.setStyleChain(o(e,"text","text")),s[t]=n),n},this.getPageLayout=function(e){var t=y[e];return t||((t=b[e])?(t=new odf.PageLayout(t,w,g),y[e]=t):t=g),t},this.getDefaultPageLayout=function(){return g},this.getMasterPage=function(e){var t=m[e];return void 0===t&&((t=p[e])?(t=new odf.MasterPage(t,v),m[e]=t):t=null),t},this.getDefaultMasterPage=function(){return h},this.update=function(){var t,n,o=null,r=null;for(s={},l={},u={},p={},m={},y={},b={},c=new odf.StylePile(w,v),d=new odf.StylePile(w,v),f=new odf.StylePile(w,v),a={text:c,paragraph:d,graphic:f},t=e.styles.firstElementChild;t;)t.namespaceURI===N&&((n=i(t))?"style"===t.localName?n.addCommonStyle(t):"default-style"===t.localName&&n.setDefaultStyle(t):"default-page-layout"===t.localName&&(o=t)),t=t.nextElementSibling;for(g=new odf.PageLayout(o,w),t=e.automaticStyles.firstElementChild;t;)t.namespaceURI===N&&((n=i(t))&&"style"===t.localName?n.addAutomaticStyle(t):"page-layout"===t.localName&&(b[t.getAttributeNS(N,"name")]=t)),t=t.nextElementSibling;for(t=e.masterStyles.firstElementChild;t;)t.namespaceURI===N&&"master-page"===t.localName&&(r=r||t,0<(o=(n=t).getAttributeNS(N,"name")).length&&!p.hasOwnProperty(o)&&(p[o]=n)),t=t.nextElementSibling;h=new odf.MasterPage(r,v)}},ops.OperationTransformMatrix=function(){function e(e){e.position+=e.length,e.length*=-1}function t(t){var n=0>t.length;return n&&e(t),n}function n(e,t){var n=[];return e&&["style:parent-style-name","style:next-style-name"].forEach(function(o){e[o]===t&&n.push(o)}),n}function o(e,t){e&&["style:parent-style-name","style:next-style-name"].forEach(function(n){e[n]===t&&delete e[n]})}function r(e){var t={};return Object.keys(e).forEach(function(n){t[n]="object"==typeof e[n]?r(e[n]):e[n]}),t}function i(e,t,n,o){var r,i,a=!1,s=!1,l=[];if(o&&o.attributes&&(l=o.attributes.split(",")),e&&(n||0<l.length)&&Object.keys(e).forEach(function(t){var o,r=e[t];"object"!=typeof r&&(n&&(o=n[t]),void 0!==o?(delete e[t],s=!0,o===r&&(delete n[t],a=!0)):-1!==l.indexOf(t)&&(delete e[t],s=!0))}),t&&t.attributes&&(n||0<l.length)){for(i=t.attributes.split(","),o=0;o<i.length;o+=1)r=i[o],(n&&void 0!==n[r]||l&&-1!==l.indexOf(r))&&(i.splice(o,1),--o,s=!0);0<i.length?t.attributes=i.join(","):delete t.attributes}return{majorChanged:a,minorChanged:s}}function a(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function s(e){for(var t in e)if(e.hasOwnProperty(t)&&("attributes"!==t||0<e.attributes.length))return!0;return!1}function l(e,t,n,o,r){var l,u=e?e[r]:null,c=t?t[r]:null,d=n?n[r]:null,f=o?o[r]:null;return l=i(u,c,d,f),u&&!a(u)&&delete e[r],c&&!s(c)&&delete t[r],d&&!a(d)&&delete n[r],f&&!s(f)&&delete o[r],l}function u(e,t){return{opSpecsA:[e],opSpecsB:[t]}}var c;c={AddAnnotation:{AddAnnotation:function(e,t,n){var o;return e.position<t.position?(o=e,n=t):t.position<e.position?(o=t,n=e):(o=n?e:t,n=n?t:e),n.position<o.position+o.length&&(o.length+=2),n.position+=2,{opSpecsA:[e],opSpecsB:[t]}},AddCursor:u,AddMember:u,AddStyle:u,ApplyDirectStyling:function(e,t){return e.position<=t.position?t.position+=2:e.position<=t.position+t.length&&(t.length+=2),{opSpecsA:[e],opSpecsB:[t]}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=t.text.length),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return t.sourceStartPosition<=e.position?--e.position:(void 0!==e.length&&t.sourceStartPosition<=e.position+e.length&&--e.length,t.sourceStartPosition+=2,e.position<t.destinationStartPosition&&(t.destinationStartPosition+=2)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,o){var r=t(o);return n.position<o.position?o.position+=2:n.position<o.position+o.length&&(o.length+=2),r&&e(o),{opSpecsA:[n],opSpecsB:[o]}},RemoveAnnotation:function(e,t){return e.position<t.position?(t.position<e.position+e.length&&(e.length-=t.length+2),t.position+=2):e.position-=t.length+2,{opSpecsA:[e],opSpecsB:[t]}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n,o=t.position,r=t.position+t.length,i=[e],a=[t];return e.position<=t.position?t.position+=2:e.position<r&&(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+2,length:r-e.position},a.unshift(n)),t.position+t.length<=e.position?(e.position-=t.length,void 0!==e.length&&n&&(e.length=n.length>=e.length?0:e.length-n.length)):void 0!==e.length&&(r<=(n=e.position+e.length)?e.length-=t.length:o<n&&(e.length=o-e.position)),{opSpecsA:i,opSpecsB:a}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=2),t.position<=e.position?e.position+=1:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=1),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},AddCursor:{AddCursor:u,AddMember:u,AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveAnnotation:u,RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},AddMember:{AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveAnnotation:u,RemoveCursor:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMetadata:u,UpdateParagraphStyle:u},AddStyle:{AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveAnnotation:u,RemoveCursor:u,RemoveMember:u,RemoveStyle:function(e,t){var r,i=[e],a=[t];return e.styleFamily===t.styleFamily&&(0<(r=n(e.setProperties,t.styleName)).length&&(r={optype:"UpdateParagraphStyle",memberid:t.memberid,timestamp:t.timestamp,styleName:e.styleName,removedProperties:{attributes:r.join(",")}},a.unshift(r)),o(e.setProperties,t.styleName)),{opSpecsA:i,opSpecsB:a}},RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},ApplyDirectStyling:{ApplyDirectStyling:function(e,t,n){var o,i,s,u,c,d,f,p;return u=[e],s=[t],e.position+e.length<=t.position||e.position>=t.position+t.length||(o=n?e:t,i=n?t:e,e.position===t.position&&e.length===t.length||(d=r(o),f=r(i)),((t=l(i.setProperties,null,o.setProperties,null,"style:text-properties")).majorChanged||t.minorChanged)&&(s=[],e=[],u=o.position+o.length,c=i.position+i.length,i.position<o.position?t.minorChanged&&((p=r(f)).length=o.position-i.position,e.push(p),i.position=o.position,i.length=c-i.position):o.position<i.position&&t.majorChanged&&((p=r(d)).length=i.position-o.position,s.push(p),o.position=i.position,o.length=u-o.position),c>u?t.minorChanged&&((d=f).position=u,d.length=c-u,e.push(d),i.length=u-i.position):u>c&&t.majorChanged&&(d.position=c,d.length=u-c,s.push(d),o.length=c-o.position),o.setProperties&&a(o.setProperties)&&s.push(o),i.setProperties&&a(i.setProperties)&&e.push(i),n?(u=s,s=e):u=e)),{opSpecsA:u,opSpecsB:s}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:t.position<=e.position+e.length&&(e.length+=t.text.length),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){var n=e.position,o=e.position+e.length;return n>=t.sourceStartPosition&&--n,o>=t.sourceStartPosition&&--o,e.position=n,e.length=o-n,{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:u,RemoveAnnotation:function(e,t){var n=e.position,o=e.position+e.length,r=t.position+t.length,i=[e],a=[t];return t.position<=n&&o<=r?i=[]:(r<n&&(n-=t.length+2),r<o&&(o-=t.length+2),e.position=n,e.length=o-n),{opSpecsA:i,opSpecsB:a}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n=e.position+e.length,o=t.position+t.length,r=[e],i=[t];return o<=e.position?e.position-=t.length:t.position<n&&(e.position<t.position?e.length=o<n?e.length-t.length:t.position-e.position:(e.position=t.position,o<n?e.length=n-o:r=[])),{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:u,SplitParagraph:function(e,t){return t.position<e.position?e.position+=1:t.position<e.position+e.length&&(e.length+=1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},InsertText:{InsertText:function(e,t,n){return e.position<t.position?t.position+=e.text.length:e.position>t.position?e.position+=t.text.length:n?t.position+=e.text.length:e.position+=t.text.length,{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return e.position>=t.sourceStartPosition?--e.position:(e.position<t.sourceStartPosition&&(t.sourceStartPosition+=e.text.length),e.position<t.destinationStartPosition&&(t.destinationStartPosition+=e.text.length)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,o){var r=t(o);return n.position<o.position?o.position+=n.text.length:n.position<o.position+o.length&&(o.length+=n.text.length),r&&e(o),{opSpecsA:[n],opSpecsB:[o]}},RemoveAnnotation:function(e,t){var n=e.position,o=t.position+t.length,r=[e],i=[t];return t.position<=n&&n<=o?(r=[],t.length+=e.text.length):o<e.position?e.position-=t.length+2:t.position+=e.text.length,{opSpecsA:r,opSpecsB:i}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n,o=[e],r=[t];return(n=t.position+t.length)<=e.position?e.position-=t.length:e.position<=t.position?t.position+=e.text.length:(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+e.text.length,length:n-e.position},r.unshift(n),e.position=t.position),{opSpecsA:o,opSpecsB:r}},SetParagraphStyle:function(e,t){return t.position>e.position&&(t.position+=e.text.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=e.text.length),e.position<=t.position?t.position+=e.text.length:e.position+=1,{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},MergeParagraph:{MergeParagraph:function(e,t,n){var o,r=[e],i=[t];return e.destinationStartPosition===t.destinationStartPosition?(r=[],i=[],e.moveCursor&&(o={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:e.sourceStartPosition-1},r.push(o)),t.moveCursor&&(o={optype:"MoveCursor",memberid:t.memberid,timestamp:t.timestamp,position:t.sourceStartPosition-1},i.push(o)),e={optype:"SetParagraphStyle",memberid:(e=n?e:t).memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},n?r.push(e):i.push(e)):t.sourceStartPosition===e.destinationStartPosition?(e.destinationStartPosition=t.destinationStartPosition,--e.sourceStartPosition,e.paragraphStyleName=t.paragraphStyleName):e.sourceStartPosition===t.destinationStartPosition?(t.destinationStartPosition=e.destinationStartPosition,--t.sourceStartPosition,t.paragraphStyleName=e.paragraphStyleName):e.destinationStartPosition<t.destinationStartPosition?(--t.destinationStartPosition,--t.sourceStartPosition):(--e.destinationStartPosition,--e.sourceStartPosition),{opSpecsA:r,opSpecsB:i}},MoveCursor:function(e,t){var n=t.position,o=t.position+t.length,r=Math.min(n,o);n=Math.max(n,o);return r>=e.sourceStartPosition&&--r,n>=e.sourceStartPosition&&--n,0<=t.length?(t.position=r,t.length=n-r):(t.position=n,t.length=r-n),{opSpecsA:[e],opSpecsB:[t]}},RemoveAnnotation:function(e,t){var n=t.position+t.length,o=[e],r=[t];return t.position<=e.destinationStartPosition&&e.sourceStartPosition<=n?(o=[],--t.length):e.sourceStartPosition<t.position?--t.position:(n<e.destinationStartPosition&&(e.destinationStartPosition-=t.length+2),n<e.sourceStartPosition&&(e.sourceStartPosition-=t.length+2)),{opSpecsA:o,opSpecsB:r}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){return t.position>=e.sourceStartPosition?--t.position:(t.position<e.destinationStartPosition&&(e.destinationStartPosition-=t.length),t.position<e.sourceStartPosition&&(e.sourceStartPosition-=t.length)),{opSpecsA:[e],opSpecsB:[t]}},SetParagraphStyle:function(e,t){var n=[e],o=[t];return t.position>e.sourceStartPosition?--t.position:t.position!==e.destinationStartPosition&&t.position!==e.sourceStartPosition||(t.position=e.destinationStartPosition,e.paragraphStyleName=t.styleName),{opSpecsA:n,opSpecsB:o}},SplitParagraph:function(e,t){var n,o=[e],r=[t];return t.position<e.destinationStartPosition?(e.destinationStartPosition+=1,e.sourceStartPosition+=1):t.position>=e.destinationStartPosition&&t.position<e.sourceStartPosition?(t.paragraphStyleName=e.paragraphStyleName,n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},o.push(n),t.position===e.sourceStartPosition-1&&e.moveCursor&&(n={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:t.position,length:0},o.push(n)),e.destinationStartPosition=t.position+1,e.sourceStartPosition+=1):t.position>=e.sourceStartPosition&&(--t.position,--t.sourceParagraphPosition),{opSpecsA:o,opSpecsB:r}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},MoveCursor:{MoveCursor:u,RemoveAnnotation:function(n,o){var r=t(n),i=n.position+n.length,a=o.position+o.length;return o.position<=n.position&&i<=a?(n.position=o.position-1,n.length=0):(a<n.position?n.position-=o.length+2:a<i&&(n.length-=o.length+2),r&&e(n)),{opSpecsA:[n],opSpecsB:[o]}},RemoveCursor:function(e,t){return{opSpecsA:e.memberid===t.memberid?[]:[e],opSpecsB:[t]}},RemoveMember:u,RemoveStyle:u,RemoveText:function(n,o){var r=t(n),i=n.position+n.length,a=o.position+o.length;return a<=n.position?n.position-=o.length:o.position<i&&(n.position<o.position?n.length=a<i?n.length-o.length:o.position-n.position:(n.position=o.position,n.length=a<i?i-a:0)),r&&e(n),{opSpecsA:[n],opSpecsB:[o]}},SetParagraphStyle:u,SplitParagraph:function(n,o){var r=t(n);return o.position<n.position?n.position+=1:o.position<n.position+n.length&&(n.length+=1),r&&e(n),{opSpecsA:[n],opSpecsB:[o]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveAnnotation:{RemoveAnnotation:function(e,t){var n=[e],o=[t];return e.position===t.position&&e.length===t.length?(n=[],o=[]):e.position<t.position?t.position-=e.length+2:e.position-=t.length+2,{opSpecsA:n,opSpecsB:o}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n=e.position+e.length,o=t.position+t.length,r=[e],i=[t];return e.position<=t.position&&o<=n?(i=[],e.length-=t.length):o<e.position?e.position-=t.length:t.position<e.position?(e.position=t.position+1,t.length-=e.length+2):t.position-=e.length+2,{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:function(e,t){var n=t.position,o=e.position+e.length,r=[e],i=[t];return e.position<=n&&n<=o?i=[]:o<n&&(t.position-=e.length+2),{opSpecsA:r,opSpecsB:i}},SplitParagraph:function(e,t){var n=t.position,o=e.position+e.length,r=[e],i=[t];return e.position<=n&&n<=o?(i=[],e.length+=1):(o<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length+2),o<n?t.position-=e.length+2:e.position+=1),{opSpecsA:r,opSpecsB:i}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveCursor:{RemoveCursor:function(e,t){var n=e.memberid===t.memberid;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveMember:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveMember:{RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveStyle:{RemoveStyle:function(e,t){var n=e.styleName===t.styleName&&e.styleFamily===t.styleFamily;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveText:u,SetParagraphStyle:function(e,t){var n,o=[e],r=[t];return"paragraph"===e.styleFamily&&e.styleName===t.styleName&&(n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:t.position,styleName:""},o.unshift(n),t.styleName=""),{opSpecsA:o,opSpecsB:r}},SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:function(e,t){var r,i=[e],a=[t];return"paragraph"===e.styleFamily&&(0<(r=n(t.setProperties,e.styleName)).length&&(r={optype:"UpdateParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,styleName:t.styleName,removedProperties:{attributes:r.join(",")}},i.unshift(r)),e.styleName===t.styleName?a=[]:o(t.setProperties,e.styleName)),{opSpecsA:i,opSpecsB:a}}},RemoveText:{RemoveText:function(e,t){var n=e.position+e.length,o=t.position+t.length,r=[e],i=[t];return o<=e.position?e.position-=t.length:n<=t.position?t.position-=e.length:t.position<n&&(e.position<t.position?(e.length=o<n?e.length-t.length:t.position-e.position,n<o?(t.position=e.position,t.length=o-n):i=[]):(n<o?t.length-=e.length:t.position<e.position?t.length=e.position-t.position:i=[],o<n?(e.position=t.position,e.length=n-o):r=[])),{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position-=e.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n=e.position+e.length,o=[e],r=[t];return t.position<=e.position?e.position+=1:t.position<n&&(e.length=t.position-e.position,n={optype:"RemoveText",memberid:e.memberid,timestamp:e.timestamp,position:t.position+1,length:n-t.position},o.unshift(n)),e.position+e.length<=t.position?t.position-=e.length:e.position<t.position&&(t.position=e.position),e.position+e.length<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length),{opSpecsA:o,opSpecsB:r}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},SetParagraphStyle:{SetParagraphStyle:function(e,t,n){return e.position===t.position&&(n?t.styleName=e.styleName:e.styleName=t.styleName),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n,o=[e],i=[t];return e.position>t.position?e.position+=1:e.position===t.sourceParagraphPosition&&(t.paragraphStyleName=e.styleName,(n=r(e)).position=t.position+1,o.push(n)),{opSpecsA:o,opSpecsB:i}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},SplitParagraph:{SplitParagraph:function(e,t,n){var o,r;return e.position<t.position?o=!0:t.position<e.position?r=!0:e.position===t.position&&(n?o=!0:r=!0),o?(t.position+=1,t.sourceParagraphPosition=e.position<t.sourceParagraphPosition?t.sourceParagraphPosition+1:e.position+1):r&&(e.position+=1,e.sourceParagraphPosition=t.position<t.sourceParagraphPosition?e.sourceParagraphPosition+1:t.position+1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},UpdateMember:{UpdateMetadata:u,UpdateParagraphStyle:u},UpdateMetadata:{UpdateMetadata:function(e,t,n){var o,r=[e],l=[t];return o=n?e:t,i((e=n?t:e).setProperties||null,e.removedProperties||null,o.setProperties||null,o.removedProperties||null),o.setProperties&&a(o.setProperties)||o.removedProperties&&s(o.removedProperties)||(n?r=[]:l=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?l=[]:r=[]),{opSpecsA:r,opSpecsB:l}},UpdateParagraphStyle:u},UpdateParagraphStyle:{UpdateParagraphStyle:function(e,t,n){var o,r=[e],u=[t];return e.styleName===t.styleName&&(o=n?e:t,l((e=n?t:e).setProperties,e.removedProperties,o.setProperties,o.removedProperties,"style:paragraph-properties"),l(e.setProperties,e.removedProperties,o.setProperties,o.removedProperties,"style:text-properties"),i(e.setProperties||null,e.removedProperties||null,o.setProperties||null,o.removedProperties||null),o.setProperties&&a(o.setProperties)||o.removedProperties&&s(o.removedProperties)||(n?r=[]:u=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?u=[]:r=[])),{opSpecsA:r,opSpecsB:u}}}},this.passUnchanged=u,this.extendTransformations=function(e){Object.keys(e).forEach(function(t){var n,o=e[t],r=c.hasOwnProperty(t);runtime.log((r?"Extending":"Adding")+" map for optypeA: "+t),r||(c[t]={}),n=c[t],Object.keys(o).forEach(function(e){var r=n.hasOwnProperty(e);runtime.assert(t<=e,"Wrong order:"+t+", "+e),runtime.log("  "+(r?"Overwriting":"Adding")+" entry for optypeB: "+e),n[e]=o[e]})})},this.transformOpspecVsOpspec=function(e,t){var n,o=e.optype<=t.optype;return runtime.log("Crosstransforming:"),runtime.log(runtime.toJson(e)),runtime.log(runtime.toJson(t)),o||(n=e,e=t,t=n),(n=(n=c[e.optype])&&n[t.optype])?(n=n(e,t,!o),o||null===n||(n={opSpecsA:n.opSpecsB,opSpecsB:n.opSpecsA})):n=null,runtime.log("result:"),n?(runtime.log(runtime.toJson(n.opSpecsA)),runtime.log(runtime.toJson(n.opSpecsB))):runtime.log("null"),n}},ops.OperationTransformer=function(){function e(n,o){for(var r,i,a=[],s=[];0<n.length&&o;){if(r=n.shift(),!(r=t.transformOpspecVsOpspec(r,o)))return null;if(a=a.concat(r.opSpecsA),0===r.opSpecsB.length){a=a.concat(n),o=null;break}for(;1<r.opSpecsB.length;){if(!(i=e(n,r.opSpecsB.shift())))return null;s=s.concat(i.opSpecsB),n=i.opSpecsA}o=r.opSpecsB.pop()}return o&&s.push(o),{opSpecsA:a,opSpecsB:s}}var t=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return t},this.transform=function(t,n){for(var o,r=[];0<n.length;){if(!(o=e(t,n.shift())))return null;t=o.opSpecsA,r=r.concat(o.opSpecsB)}return{opSpecsA:t,opSpecsB:r}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "×";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}',globalScope;return globalScope="undefined"!=typeof window?window:"undefined"!=typeof global?global:{},(globalScope.externs||(globalScope.externs={})).JSZip=function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,module,exports){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.encode=function(e,n){for(var o,r,i,a,s,l,u,c="",d=0;d<e.length;)o=e.charCodeAt(d++),r=e.charCodeAt(d++),i=e.charCodeAt(d++),a=o>>2,s=(3&o)<<4|r>>4,l=(15&r)<<2|i>>6,u=63&i,isNaN(r)?l=u=64:isNaN(i)&&(u=64),c=c+t.charAt(a)+t.charAt(s)+t.charAt(l)+t.charAt(u);return c},exports.decode=function(e,n){var o,r,i,a,s,l,u,c="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)a=t.indexOf(e.charAt(d++)),s=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),u=t.indexOf(e.charAt(d++)),o=a<<2|s>>4,r=(15&s)<<4|l>>2,i=(3&l)<<6|u,c+=String.fromCharCode(o),64!=l&&(c+=String.fromCharCode(r)),64!=u&&(c+=String.fromCharCode(i));return c}},{}],2:[function(e,module,exports){function t(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}t.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},module.exports=t},{}],3:[function(e,module,exports){exports.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},exports.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,module,exports){var t=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];module.exports=function(e,o){if(void 0===e||!e.length)return 0;var r="string"!==t.getTypeOf(e);void 0===o&&(o=0);var i=0;o^=-1;for(var a=0,s=e.length;a<s;a++)i=r?e[a]:e.charCodeAt(a),o=o>>>8^n[255&(o^i)];return-1^o}},{"./utils":21}],5:[function(e,module,exports){var t=e("./utils");function n(e){this.data=null,this.length=0,this.index=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return t.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},module.exports=n},{"./utils":21}],6:[function(e,module,exports){exports.base64=!1,exports.binary=!1,exports.dir=!1,exports.createFolders=!1,exports.date=null,exports.compression=null,exports.comment=null},{}],7:[function(e,module,exports){var t=e("./utils");exports.string2binary=function(e){return t.string2binary(e)},exports.string2Uint8Array=function(e){return t.transformTo("uint8array",e)},exports.uint8Array2String=function(e){return t.transformTo("string",e)},exports.string2Blob=function(e){var n=t.transformTo("arraybuffer",e);return t.arrayBuffer2Blob(n)},exports.arrayBuffer2Blob=function(e){return t.arrayBuffer2Blob(e)},exports.transformTo=function(e,n){return t.transformTo(e,n)},exports.getTypeOf=function(e){return t.getTypeOf(e)},exports.checkSupport=function(e){return t.checkSupport(e)},exports.MAX_VALUE_16BITS=t.MAX_VALUE_16BITS,exports.MAX_VALUE_32BITS=t.MAX_VALUE_32BITS,exports.pretty=function(e){return t.pretty(e)},exports.findCompression=function(e){return t.findCompression(e)},exports.isRegExp=function(e){return t.isRegExp(e)}},{"./utils":21}],8:[function(e,module,exports){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako");exports.uncompressInputType=t?"uint8array":"array",exports.compressInputType=t?"uint8array":"array",exports.magic="\b\0",exports.compress=function(e){return n.deflateRaw(e)},exports.uncompress=function(e){return n.inflateRaw(e)}},{pako:24}],9:[function(e,module,exports){var t=e("./base64");function n(e,t){if(!(this instanceof n))return new n(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=e("./object"),n.prototype.load=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.utils=e("./deprecatedPublicUtils"),n.base64={encode:function(e){return t.encode(e)},decode:function(e){return t.decode(e)}},n.compressions=e("./compressions"),module.exports=n},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,module,exports){var t=e("./base64"),n=e("./zipEntries");module.exports=function(e,o){var r,i,a,s;for((o=o||{}).base64&&(e=t.decode(e)),i=new n(e,o),r=i.files,a=0;a<r.length;a++)s=r[a],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:o.createFolders});return i.zipComment.length&&(this.comment=i.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,module,exports){(function(e){module.exports=function(t,n){return new e(t,n)},module.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,module,exports){var t=e("./uint8ArrayReader");function n(e){this.data=e,this.length=this.data.length,this.index=0}n.prototype=new t,n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},module.exports=n},{"./uint8ArrayReader":18}],13:[function(e,module,exports){var t=e("./support"),n=e("./utils"),o=e("./crc32"),r=e("./signature"),i=e("./defaults"),a=e("./base64"),s=e("./compressions"),l=e("./compressedObject"),u=e("./nodeBuffer"),c=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof l&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},m=function(e){var o=p(e),r=n.getTypeOf(o);return"string"===r?!e.options.binary&&t.nodebuffer?u(o,"utf-8"):e.asBinary():o},h=function(e){var t=p(this);return null===t||void 0===t?"":(this.options.base64&&(t=a.decode(t)),t=e&&this.options.binary?x.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",x.utf8encode(t))),t)},g=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};g.prototype={asText:function(){return h.call(this,!0)},asBinary:function(){return h.call(this,!1)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(e,t){var n,o="";for(n=0;n<t;n++)o+=String.fromCharCode(255&e),e>>>=8;return o},y=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},v=function(e,t,o){var r,a=n.getTypeOf(t);if((o=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=y(e,i)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e}(o)).createFolders&&(r=S(e))&&N.call(this,r,!0),o.dir||null===t||void 0===t)o.base64=!1,o.binary=!1,t=null;else if("string"===a)o.binary&&!o.base64&&!0!==o.optimizedBinaryString&&(t=n.string2binary(t));else{if(o.base64=!1,o.binary=!0,!(a||t instanceof l))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var s=new g(e,t,o);return this.files[e]=s,s},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},N=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||v.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},C=function(e,t){var r,i=new l;return e._data instanceof l?(i.uncompressedSize=e._data.uncompressedSize,i.crc32=e._data.crc32,0===i.uncompressedSize||e.dir?(t=s.STORE,i.compressedContent="",i.crc32=0):e._data.compressionMethod===t.magic?i.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),i.compressedContent=t.compress(n.transformTo(t.compressInputType,r)))):((r=m(e))&&0!==r.length&&!e.dir||(t=s.STORE,r=""),i.uncompressedSize=r.length,i.crc32=o(r),i.compressedContent=t.compress(n.transformTo(t.compressInputType,r))),i.compressedSize=i.compressedContent.length,i.compressionMethod=t.magic,i},w=function(e,t,i,a){i.compressedContent;var s,l,u,d,f=n.transformTo("string",c.utf8encode(t.name)),p=t.comment||"",m=n.transformTo("string",c.utf8encode(p)),h=f.length!==t.name.length,g=m.length!==p.length,y=t.options,v="",S="",N="";u=t._initialMetadata.dir!==t.dir?t.dir:y.dir,d=t._initialMetadata.date!==t.date?t.date:y.date,s=d.getHours(),s<<=6,s|=d.getMinutes(),s<<=5,s|=d.getSeconds()/2,l=d.getFullYear()-1980,l<<=4,l|=d.getMonth()+1,l<<=5,l|=d.getDate(),h&&(S=b(1,1)+b(o(f),4)+f,v+="up"+b(S.length,2)+S),g&&(N=b(1,1)+b(this.crc32(m),4)+m,v+="uc"+b(N.length,2)+N);var C="";C+="\n\0",C+=h||g?"\0\b":"\0\0",C+=i.compressionMethod,C+=b(s,2),C+=b(l,2),C+=b(i.crc32,4),C+=b(i.compressedSize,4),C+=b(i.uncompressedSize,4),C+=b(f.length,2),C+=b(v.length,2);var w=r.LOCAL_FILE_HEADER+C+f+v,x=r.CENTRAL_FILE_HEADER+"\0"+C+b(m.length,2)+"\0\0\0\0"+(!0===u?"\0\0\0":"\0\0\0\0")+b(a,4)+f+v+m;return{fileRecord:w,dirRecord:x,compressedObject:i}},x={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,n,o,r,i=[];for(t in this.files)this.files.hasOwnProperty(t)&&(o=this.files[t],r=new g(o.name,o._data,y(o.options)),n=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(n,r)&&i.push(r));return i},file:function(e,t,o){if(1===arguments.length){if(n.isRegExp(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,v.call(this,e,t,o),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,o=N.call(this,t),r=this.clone();return r.root=o.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),o=0;o<n.length;o++)delete this.files[n[o].name];return this},generate:function(e){e=y(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,o,i=[],l=0,u=0,c=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var p in this.files)if(this.files.hasOwnProperty(p)){var m=this.files[p],h=m.options.compression||e.compression.toUpperCase(),g=s[h];if(!g)throw new Error(h+" is not a valid compression method !");var v=C.call(this,m,g),S=w.call(this,p,m,v,l);l+=S.fileRecord.length+v.compressedSize,u+=S.dirRecord.length,i.push(S)}var N="";N=r.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(i.length,2)+b(i.length,2)+b(u,4)+b(l,4)+b(c.length,2)+c;var x=e.type.toLowerCase();for(t="uint8array"===x||"arraybuffer"===x||"blob"===x||"nodebuffer"===x?new f(l+u+N.length):new d(l+u+N.length),o=0;o<i.length;o++)t.append(i[o].fileRecord),t.append(i[o].compressedObject.compressedContent);for(o=0;o<i.length;o++)t.append(i[o].dirRecord);t.append(N);var E=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),E);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",E));case"base64":return e.base64?a.encode(E):E;default:return E}},crc32:function(e,t){return o(e,t)},utf8encode:function(e){return n.transformTo("string",c.utf8encode(e))},utf8decode:function(e){return c.utf8decode(e)}};module.exports=x},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,module,exports){exports.LOCAL_FILE_HEADER="PK",exports.CENTRAL_FILE_HEADER="PK",exports.CENTRAL_DIRECTORY_END="PK",exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",exports.ZIP64_CENTRAL_DIRECTORY_END="PK",exports.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,module,exports){var t=e("./dataReader"),n=e("./utils");function o(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}o.prototype=new t,o.prototype.byteAt=function(e){return this.data.charCodeAt(e)},o.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},o.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},module.exports=o},{"./dataReader":5,"./utils":21}],16:[function(e,module,exports){var t=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=t.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},module.exports=n},{"./utils":21}],17:[function(e,module,exports){(function(e){if(exports.base64=!0,exports.array=!0,exports.string=!0,exports.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,exports.nodebuffer=void 0!==e,exports.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)exports.blob=!1;else{var t=new ArrayBuffer(0);try{exports.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=new n;o.append(t),exports.blob=0===o.getBlob("application/zip").size}catch(e){exports.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,module,exports){var t=e("./dataReader");function n(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}n.prototype=new t,n.prototype.byteAt=function(e){return this.data[e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),o=e.charCodeAt(2),r=e.charCodeAt(3),i=this.length-4;i>=0;--i)if(this.data[i]===t&&this.data[i+1]===n&&this.data[i+2]===o&&this.data[i+3]===r)return i;return-1},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},module.exports=n},{"./dataReader":5}],19:[function(e,module,exports){var t=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=t.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},module.exports=n},{"./utils":21}],20:[function(e,module,exports){for(var t=e("./utils"),n=e("./support"),o=e("./nodeBuffer"),r=new Array(256),i=0;i<256;i++)r[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;r[254]=r[254]=1;var a=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+r[e[n]]>t?n:t},s=function(e){var n,o,i,a,s=e.length,l=new Array(2*s);for(o=0,n=0;n<s;)if((i=e[n++])<128)l[o++]=i;else if((a=r[i])>4)l[o++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<s;)i=i<<6|63&e[n++],a--;a>1?l[o++]=65533:i<65536?l[o++]=i:(i-=65536,l[o++]=55296|i>>10&1023,l[o++]=56320|1023&i)}return l.length!==o&&(l.subarray?l=l.subarray(0,o):l.length=o),t.applyFromCharCode(l)};exports.utf8encode=function(e){return n.nodebuffer?o(e,"utf-8"):function(e){var t,o,r,i,a,s=e.length,l=0;for(i=0;i<s;i++)55296==(64512&(o=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(o=65536+(o-55296<<10)+(r-56320),i++),l+=o<128?1:o<2048?2:o<65536?3:4;for(t=n.uint8array?new Uint8Array(l):new Array(l),a=0,i=0;a<l;i++)55296==(64512&(o=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(o=65536+(o-55296<<10)+(r-56320),i++),o<128?t[a++]=o:o<2048?(t[a++]=192|o>>>6,t[a++]=128|63&o):o<65536?(t[a++]=224|o>>>12,t[a++]=128|o>>>6&63,t[a++]=128|63&o):(t[a++]=240|o>>>18,t[a++]=128|o>>>12&63,t[a++]=128|o>>>6&63,t[a++]=128|63&o);return t}(e)},exports.utf8decode=function(e){if(n.nodebuffer)return t.transformTo("nodebuffer",e).toString("utf-8");for(var o=[],r=0,i=(e=t.transformTo(n.uint8array?"uint8array":"array",e)).length;r<i;){var l=a(e,Math.min(r+65536,i));n.uint8array?o.push(s(e.subarray(r,l))):o.push(s(e.slice(r,l))),r=l}return o.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,module,exports){var t=e("./support"),n=e("./compressions"),o=e("./nodeBuffer");function r(e){return e}function i(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function a(e){var t=65536,n=[],r=e.length,i=exports.getTypeOf(e),a=0,s=!0;try{switch(i){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,o(0))}}catch(e){s=!1}if(!s){for(var l="",u=0;u<e.length;u++)l+=String.fromCharCode(e[u]);return l}for(;a<r&&t>1;)try{"array"===i||"nodebuffer"===i?n.push(String.fromCharCode.apply(null,e.slice(a,Math.min(a+t,r)))):n.push(String.fromCharCode.apply(null,e.subarray(a,Math.min(a+t,r)))),a+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function s(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}exports.string2binary=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n));return t},exports.arrayBuffer2Blob=function(e){exports.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(o){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new t;return n.append(e),n.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},exports.applyFromCharCode=a;var l={};l.string={string:r,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,o(e.length))}},l.array={string:a,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(e)}},l.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return s(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(new Uint8Array(e))}},l.uint8array={string:a,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return o(e)}},l.nodebuffer={string:a,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:r},exports.transformTo=function(e,t){if(t||(t=""),!e)return t;exports.checkSupport(e);var n=exports.getTypeOf(t),o=l[n][e](t);return o},exports.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":t.nodebuffer&&o.test(e)?"nodebuffer":t.uint8array&&e instanceof Uint8Array?"uint8array":t.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},exports.checkSupport=function(e){var n=t[e.toLowerCase()];if(!n)throw new Error(e+" is not supported by this browser")},exports.MAX_VALUE_16BITS=65535,exports.MAX_VALUE_32BITS=-1,exports.pretty=function(e){var t,n,o="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),o+="\\x"+(t<16?"0":"")+t.toString(16).toUpperCase();return o},exports.findCompression=function(e){for(var t in n)if(n.hasOwnProperty(t)&&n[t].magic===e)return n[t];return null},exports.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,module,exports){var t=e("./stringReader"),n=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),r=e("./utils"),i=e("./signature"),a=e("./zipEntry"),s=e("./support"),l=e("./object");function u(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}u.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,o=this.zip64EndOfCentralSize-44;0<o;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===i.CENTRAL_FILE_HEADER;)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var i=r.getTypeOf(e);"string"!==i||s.uint8array?this.reader="nodebuffer"===i?new n(e):new o(r.transformTo("uint8array",e)):this.reader=new t(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},module.exports=u},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,module,exports){var t=e("./stringReader"),n=e("./utils"),o=e("./compressedObject"),r=e("./object");function i(e,t){this.options=e,this.loadOptions=t}i.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,n){return function(){var o=e.index;e.setIndex(t);var r=e.readData(n);return e.setIndex(o),r}},prepareContent:function(e,t,o,r,i){return function(){var e=n.transformTo(r.uncompressInputType,this.getCompressedContent()),t=r.uncompress(e);if(t.length!==i)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=n.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),r.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var o=new t(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=o.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=o.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=o.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=o.readInt(4))}},readExtraFields:function(e){var t,n,o,r=e.index;for(this.extraFields=this.extraFields||{};e.index<r+this.extraFieldsLength;)t=e.readInt(2),n=e.readInt(2),o=e.readString(n),this.extraFields[t]={id:t,length:n,value:o}},handleUTF8:function(){if(this.useUTF8())this.fileName=r.utf8decode(this.fileName),this.fileComment=r.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var n=new t(e.value);return 1!==n.readInt(1)?null:r.crc32(this.fileName)!==n.readInt(4)?null:r.utf8decode(n.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var n=new t(e.value);return 1!==n.readInt(1)?null:r.crc32(this.fileComment)!==n.readInt(4)?null:r.utf8decode(n.readString(e.length-5))}return null}},module.exports=i},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,module,exports){var t=e("./lib/utils/common").assign,n=e("./lib/deflate"),o=e("./lib/inflate"),r=e("./lib/zlib/constants"),i={};t(i,n,o,r),module.exports=i},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,module,exports){var t=e("./zlib/deflate.js"),n=e("./utils/common"),o=e("./utils/strings"),r=e("./zlib/messages"),i=e("./zlib/zstream"),a=function(e){this.options=n.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var o=this.options;o.raw&&o.windowBits>0?o.windowBits=-o.windowBits:o.gzip&&o.windowBits>0&&o.windowBits<16&&(o.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var a=t.deflateInit2(this.strm,o.level,o.method,o.windowBits,o.memLevel,o.strategy);if(0!==a)throw new Error(r[a]);o.header&&t.deflateSetHeader(this.strm,o.header)};function s(e,t){var n=new a(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}a.prototype.push=function(e,r){var i,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=r===~~r?r:!0===r?4:0,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new n.Buf8(l),s.next_out=0,s.avail_out=l),1!==(i=t.deflate(s,a))&&0!==i)return this.onEnd(i),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&4===a)&&("string"===this.options.to?this.onData(o.buf2binstring(n.shrinkBuf(s.output,s.next_out))):this.onData(n.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==i);return 4!==a||(i=t.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i)},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},exports.Deflate=a,exports.deflate=s,exports.deflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},exports.gzip=function(e,t){return(t=t||{}).gzip=!0,s(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,module,exports){var t=e("./zlib/inflate.js"),n=e("./utils/common"),o=e("./utils/strings"),r=e("./zlib/constants"),i=e("./zlib/messages"),a=e("./zlib/zstream"),s=e("./zlib/gzheader"),l=function(e){this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,0===o.windowBits&&(o.windowBits=-15)),!(o.windowBits>=0&&o.windowBits<16)||e&&e.windowBits||(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&0==(15&o.windowBits)&&(o.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var l=t.inflateInit2(this.strm,o.windowBits);if(l!==r.Z_OK)throw new Error(i[l]);this.header=new s,t.inflateGetHeader(this.strm,this.header)};function u(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}l.prototype.push=function(e,i){var a,s,l,u,c,d=this.strm,f=this.options.chunkSize;if(this.ended)return!1;s=i===~~i?i:!0===i?r.Z_FINISH:r.Z_NO_FLUSH,d.input="string"==typeof e?o.binstring2buf(e):e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(f),d.next_out=0,d.avail_out=f),(a=t.inflate(d,r.Z_NO_FLUSH))!==r.Z_STREAM_END&&a!==r.Z_OK)return this.onEnd(a),this.ended=!0,!1;d.next_out&&(0===d.avail_out||a===r.Z_STREAM_END||0===d.avail_in&&s===r.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(d.output,d.next_out),u=d.next_out-l,c=o.buf2string(d.output,l),d.next_out=u,d.avail_out=f-u,u&&n.arraySet(d.output,d.output,l,u,0),this.onData(c)):this.onData(n.shrinkBuf(d.output,d.next_out)))}while(d.avail_in>0&&a!==r.Z_STREAM_END);return a===r.Z_STREAM_END&&(s=r.Z_FINISH),s!==r.Z_FINISH||(a=t.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===r.Z_OK)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===r.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},exports.Inflate=l,exports.inflate=u,exports.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},exports.ungzip=u},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,module,exports){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}}return e},exports.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,n,o,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),r);else for(var i=0;i<o;i++)e[r+i]=t[n+i]},flattenChunks:function(e){var t,n,o,r,i,a;for(o=0,t=0,n=e.length;t<n;t++)o+=e[t].length;for(a=new Uint8Array(o),r=0,t=0,n=e.length;t<n;t++)i=e[t],a.set(i,r),r+=i.length;return a}},o={arraySet:function(e,t,n,o,r){for(var i=0;i<o;i++)e[r+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};exports.setTyped=function(e){e?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,n)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,o))},exports.setTyped(t)},{}],28:[function(e,module,exports){var t=e("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var r=new t.Buf8(256),i=0;i<256;i++)r[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;function a(e,r){if(r<65537&&(e.subarray&&o||!e.subarray&&n))return String.fromCharCode.apply(null,t.shrinkBuf(e,r));for(var i="",a=0;a<r;a++)i+=String.fromCharCode(e[a]);return i}r[254]=r[254]=1,exports.string2buf=function(e){var n,o,r,i,a,s=e.length,l=0;for(i=0;i<s;i++)55296==(64512&(o=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(o=65536+(o-55296<<10)+(r-56320),i++),l+=o<128?1:o<2048?2:o<65536?3:4;for(n=new t.Buf8(l),a=0,i=0;a<l;i++)55296==(64512&(o=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(o=65536+(o-55296<<10)+(r-56320),i++),o<128?n[a++]=o:o<2048?(n[a++]=192|o>>>6,n[a++]=128|63&o):o<65536?(n[a++]=224|o>>>12,n[a++]=128|o>>>6&63,n[a++]=128|63&o):(n[a++]=240|o>>>18,n[a++]=128|o>>>12&63,n[a++]=128|o>>>6&63,n[a++]=128|63&o);return n},exports.buf2binstring=function(e){return a(e,e.length)},exports.binstring2buf=function(e){for(var n=new t.Buf8(e.length),o=0,r=n.length;o<r;o++)n[o]=e.charCodeAt(o);return n},exports.buf2string=function(e,t){var n,o,i,s,l=t||e.length,u=new Array(2*l);for(o=0,n=0;n<l;)if((i=e[n++])<128)u[o++]=i;else if((s=r[i])>4)u[o++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<l;)i=i<<6|63&e[n++],s--;s>1?u[o++]=65533:i<65536?u[o++]=i:(i-=65536,u[o++]=55296|i>>10&1023,u[o++]=56320|1023&i)}return a(u,o)},exports.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+r[e[n]]>t?n:t}},{"./common":27}],29:[function(e,module,exports){module.exports=function(e,t,n,o){for(var r=65535&e|0,i=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{r=r+t[o++]|0,i=i+r|0}while(--a);r%=65521,i%=65521}return r|i<<16|0}},{}],30:[function(e,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,module,exports){var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();module.exports=function(e,n,o,r){var i=t,a=r+o;e^=-1;for(var s=r;s<a;s++)e=e>>>8^i[255&(e^n[s])];return-1^e}},{}],32:[function(e,module,exports){var t=e("../utils/common"),n=e("./trees"),o=e("./adler32"),r=e("./crc32"),i=e("./messages"),a=0,s=1,l=3,u=4,c=5,d=0,f=1,p=-2,m=-3,h=-5,g=-1,b=1,y=2,v=3,S=4,N=0,C=2,w=8,x=9,E=15,T=8,O=286,A=30,R=19,P=2*O+1,D=15,_=3,k=258,I=k+_+1,F=32,M=42,B=69,U=73,L=91,z=103,H=113,W=666,j=1,X=2,V=3,Z=4,K=3;function q(e,t){return e.msg=i[t],t}function J(e){return(e<<1)-(e>4?9:0)}function G(e){for(var t=e.length;--t>=0;)e[t]=0}function Y(e){var n=e.state,o=n.pending;o>e.avail_out&&(o=e.avail_out),0!==o&&(t.arraySet(e.output,n.pending_buf,n.pending_out,o,e.next_out),e.next_out+=o,n.pending_out+=o,e.total_out+=o,e.avail_out-=o,n.pending-=o,0===n.pending&&(n.pending_out=0))}function Q(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Y(e.strm)}function $(e,t){e.pending_buf[e.pending++]=t}function ee(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function te(e,t){var n,o,r=e.max_chain_length,i=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-I?e.strstart-(e.w_size-I):0,u=e.window,c=e.w_mask,d=e.prev,f=e.strstart+k,p=u[i+a-1],m=u[i+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+a]===m&&u[n+a-1]===p&&u[n]===u[i]&&u[++n]===u[i+1]){i+=2,n++;do{}while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<f);if(o=k-(f-i),i=f-k,o>a){if(e.match_start=t,a=o,o>=s)break;p=u[i+a-1],m=u[i+a]}}}while((t=d[t&c])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function ne(e){var n,i,a,s,l,u,c,d,f,p,m=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-I)){t.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,i=e.hash_size,n=i;do{a=e.head[--n],e.head[n]=a>=m?a-m:0}while(--i);n=i=m;do{a=e.prev[--n],e.prev[n]=a>=m?a-m:0}while(--i);s+=m}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,d=e.strstart+e.lookahead,f=s,p=void 0,(p=u.avail_in)>f&&(p=f),i=0===p?0:(u.avail_in-=p,t.arraySet(c,u.input,u.next_in,p,d),1===u.state.wrap?u.adler=o(u.adler,c,p,d):2===u.state.wrap&&(u.adler=r(u.adler,c,p,d)),u.next_in+=p,u.total_in+=p,p),e.lookahead+=i,e.lookahead+e.insert>=_)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+_-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<_)););}while(e.lookahead<I&&0!==e.strm.avail_in)}function oe(e,t){for(var o,r;;){if(e.lookahead<I){if(ne(e),e.lookahead<I&&t===a)return j;if(0===e.lookahead)break}if(o=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==o&&e.strstart-o<=e.w_size-I&&(e.match_length=te(e,o)),e.match_length>=_)if(r=n._tr_tally(e,e.strstart-e.match_start,e.match_length-_),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Q(e,!1),0===e.strm.avail_out))return j}return e.insert=e.strstart<_-1?e.strstart:_-1,t===u?(Q(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(Q(e,!1),0===e.strm.avail_out)?j:X}function re(e,t){for(var o,r,i;;){if(e.lookahead<I){if(ne(e),e.lookahead<I&&t===a)return j;if(0===e.lookahead)break}if(o=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_-1,0!==o&&e.prev_length<e.max_lazy_match&&e.strstart-o<=e.w_size-I&&(e.match_length=te(e,o),e.match_length<=5&&(e.strategy===b||e.match_length===_&&e.strstart-e.match_start>4096)&&(e.match_length=_-1)),e.prev_length>=_&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-_,r=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-_),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=_-1,e.strstart++,r&&(Q(e,!1),0===e.strm.avail_out))return j}else if(e.match_available){if((r=n._tr_tally(e,0,e.window[e.strstart-1]))&&Q(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return j}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<_-1?e.strstart:_-1,t===u?(Q(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(Q(e,!1),0===e.strm.avail_out)?j:X}var ie,ae=function(e,t,n,o,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=r};function se(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=C,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?M:H,e.adler=2===t.wrap?0:1,t.last_flush=a,n._tr_init(t),d):q(e,p)}function le(e){var t,n=se(e);return n===d&&((t=e.state).window_size=2*t.w_size,G(t.head),t.max_lazy_match=ie[t.level].max_lazy,t.good_match=ie[t.level].good_length,t.nice_match=ie[t.level].nice_length,t.max_chain_length=ie[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=_-1,t.match_available=0,t.ins_h=0),n}function ue(e,n,o,r,i,a){if(!e)return p;var s=1;if(n===g&&(n=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>x||o!==w||r<8||r>15||n<0||n>9||a<0||a>S)return q(e,p);8===r&&(r=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*P),this.dyn_dtree=new t.Buf16(2*(2*A+1)),this.bl_tree=new t.Buf16(2*(2*R+1)),G(this.dyn_ltree),G(this.dyn_dtree),G(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(D+1),this.heap=new t.Buf16(2*O+1),G(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*O+1),G(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+_-1)/_),l.window=new t.Buf8(2*l.w_size),l.head=new t.Buf16(l.hash_size),l.prev=new t.Buf16(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new t.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=n,l.strategy=a,l.method=o,le(e)}ie=[new ae(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ne(e),0===e.lookahead&&t===a)return j;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+n;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,Q(e,!1),0===e.strm.avail_out))return j;if(e.strstart-e.block_start>=e.w_size-I&&(Q(e,!1),0===e.strm.avail_out))return j}return e.insert=0,t===u?(Q(e,!0),0===e.strm.avail_out?V:Z):(e.strstart>e.block_start&&(Q(e,!1),e.strm.avail_out),j)}),new ae(4,4,8,4,oe),new ae(4,5,16,8,oe),new ae(4,6,32,32,oe),new ae(4,4,16,16,re),new ae(8,16,32,32,re),new ae(8,16,128,128,re),new ae(8,32,128,256,re),new ae(32,128,258,1024,re),new ae(32,258,258,4096,re)],exports.deflateInit=function(e,t){return ue(e,t,w,E,T,N)},exports.deflateInit2=ue,exports.deflateReset=le,exports.deflateResetKeep=se,exports.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?p:(e.state.gzhead=t,d):p},exports.deflate=function(e,t){var o,i,m,g;if(!e||!e.state||t>c||t<0)return e?q(e,p):p;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==u)return q(e,0===e.avail_out?h:p);if(i.strm=e,o=i.last_flush,i.last_flush=t,i.status===M)if(2===i.wrap)e.adler=0,$(i,31),$(i,139),$(i,8),i.gzhead?($(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),$(i,255&i.gzhead.time),$(i,i.gzhead.time>>8&255),$(i,i.gzhead.time>>16&255),$(i,i.gzhead.time>>24&255),$(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),$(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&($(i,255&i.gzhead.extra.length),$(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=r(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):($(i,0),$(i,0),$(i,0),$(i,0),$(i,0),$(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),$(i,K),i.status=H);else{var b=w+(i.w_bits-8<<4)<<8,S=-1;S=i.strategy>=y||i.level<2?0:i.level<6?1:6===i.level?2:3,b|=S<<6,0!==i.strstart&&(b|=F),b+=31-b%31,i.status=H,ee(i,b),0!==i.strstart&&(ee(i,e.adler>>>16),ee(i,65535&e.adler)),e.adler=1}if(i.status===B)if(i.gzhead.extra){for(m=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),Y(e),m=i.pending,i.pending!==i.pending_buf_size));)$(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.name){m=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),Y(e),m=i.pending,i.pending===i.pending_buf_size)){g=1;break}g=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,$(i,g)}while(0!==g);i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),0===g&&(i.gzindex=0,i.status=L)}else i.status=L;if(i.status===L)if(i.gzhead.comment){m=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),Y(e),m=i.pending,i.pending===i.pending_buf_size)){g=1;break}g=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,$(i,g)}while(0!==g);i.gzhead.hcrc&&i.pending>m&&(e.adler=r(e.adler,i.pending_buf,i.pending-m,m)),0===g&&(i.status=z)}else i.status=z;if(i.status===z&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Y(e),i.pending+2<=i.pending_buf_size&&($(i,255&e.adler),$(i,e.adler>>8&255),e.adler=0,i.status=H)):i.status=H),0!==i.pending){if(Y(e),0===e.avail_out)return i.last_flush=-1,d}else if(0===e.avail_in&&J(t)<=J(o)&&t!==u)return q(e,h);if(i.status===W&&0!==e.avail_in)return q(e,h);if(0!==e.avail_in||0!==i.lookahead||t!==a&&i.status!==W){var N=i.strategy===y?function(e,t){for(var o;;){if(0===e.lookahead&&(ne(e),0===e.lookahead)){if(t===a)return j;break}if(e.match_length=0,o=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,o&&(Q(e,!1),0===e.strm.avail_out))return j}return e.insert=0,t===u?(Q(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(Q(e,!1),0===e.strm.avail_out)?j:X}(i,t):i.strategy===v?function(e,t){for(var o,r,i,s,l=e.window;;){if(e.lookahead<=k){if(ne(e),e.lookahead<=k&&t===a)return j;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=_&&e.strstart>0&&(i=e.strstart-1,(r=l[i])===l[++i]&&r===l[++i]&&r===l[++i])){s=e.strstart+k;do{}while(r===l[++i]&&r===l[++i]&&r===l[++i]&&r===l[++i]&&r===l[++i]&&r===l[++i]&&r===l[++i]&&r===l[++i]&&i<s);e.match_length=k-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_?(o=n._tr_tally(e,1,e.match_length-_),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(o=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),o&&(Q(e,!1),0===e.strm.avail_out))return j}return e.insert=0,t===u?(Q(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(Q(e,!1),0===e.strm.avail_out)?j:X}(i,t):ie[i.level].func(i,t);if(N!==V&&N!==Z||(i.status=W),N===j||N===V)return 0===e.avail_out&&(i.last_flush=-1),d;if(N===X&&(t===s?n._tr_align(i):t!==c&&(n._tr_stored_block(i,0,0,!1),t===l&&(G(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Y(e),0===e.avail_out))return i.last_flush=-1,d}return t!==u?d:i.wrap<=0?f:(2===i.wrap?($(i,255&e.adler),$(i,e.adler>>8&255),$(i,e.adler>>16&255),$(i,e.adler>>24&255),$(i,255&e.total_in),$(i,e.total_in>>8&255),$(i,e.total_in>>16&255),$(i,e.total_in>>24&255)):(ee(i,e.adler>>>16),ee(i,65535&e.adler)),Y(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?d:f)},exports.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==M&&t!==B&&t!==U&&t!==L&&t!==z&&t!==H&&t!==W?q(e,p):(e.state=null,t===H?q(e,m):d):p},exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,module,exports){module.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,module,exports){module.exports=function(e,t){var n,o,r,i,a,s,l,u,c,d,f,p,m,h,g,b,y,v,S,N,C,w,x,E,T;n=e.state,o=e.next_in,E=e.input,r=o+(e.avail_in-5),i=e.next_out,T=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,d=n.wnext,f=n.window,p=n.hold,m=n.bits,h=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{m<15&&(p+=E[o++]<<m,m+=8,p+=E[o++]<<m,m+=8),v=h[p&b];t:for(;;){if(p>>>=S=v>>>24,m-=S,0==(S=v>>>16&255))T[i++]=65535&v;else{if(!(16&S)){if(0==(64&S)){v=h[(65535&v)+(p&(1<<S)-1)];continue t}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}N=65535&v,(S&=15)&&(m<S&&(p+=E[o++]<<m,m+=8),N+=p&(1<<S)-1,p>>>=S,m-=S),m<15&&(p+=E[o++]<<m,m+=8,p+=E[o++]<<m,m+=8),v=g[p&y];n:for(;;){if(p>>>=S=v>>>24,m-=S,!(16&(S=v>>>16&255))){if(0==(64&S)){v=g[(65535&v)+(p&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(C=65535&v,m<(S&=15)&&(p+=E[o++]<<m,(m+=8)<S&&(p+=E[o++]<<m,m+=8)),(C+=p&(1<<S)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=S,m-=S,C>(S=i-a)){if((S=C-S)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=0,x=f,0===d){if(w+=u-S,S<N){N-=S;do{T[i++]=f[w++]}while(--S);w=i-C,x=T}}else if(d<S){if(w+=u+d-S,(S-=d)<N){N-=S;do{T[i++]=f[w++]}while(--S);if(w=0,d<N){N-=S=d;do{T[i++]=f[w++]}while(--S);w=i-C,x=T}}}else if(w+=d-S,S<N){N-=S;do{T[i++]=f[w++]}while(--S);w=i-C,x=T}for(;N>2;)T[i++]=x[w++],T[i++]=x[w++],T[i++]=x[w++],N-=3;N&&(T[i++]=x[w++],N>1&&(T[i++]=x[w++]))}else{w=i-C;do{T[i++]=T[w++],T[i++]=T[w++],T[i++]=T[w++],N-=3}while(N>2);N&&(T[i++]=T[w++],N>1&&(T[i++]=T[w++]))}break}}break}}while(o<r&&i<s);o-=N=m>>3,p&=(1<<(m-=N<<3))-1,e.next_in=o,e.next_out=i,e.avail_in=o<r?r-o+5:5-(o-r),e.avail_out=i<s?s-i+257:257-(i-s),n.hold=p,n.bits=m}},{}],35:[function(e,module,exports){var t=e("../utils/common"),n=e("./adler32"),o=e("./crc32"),r=e("./inffast"),i=e("./inftrees"),a=0,s=1,l=2,u=4,c=5,d=6,f=0,p=1,m=2,h=-2,g=-3,b=-4,y=-5,v=8,S=1,N=2,C=3,w=4,x=5,E=6,T=7,O=8,A=9,R=10,P=11,D=12,_=13,k=14,I=15,F=16,M=17,B=18,U=19,L=20,z=21,H=22,W=23,j=24,X=25,V=26,Z=27,K=28,q=29,J=30,G=31,Y=32,Q=852,$=592,ee=15;function te(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ne(e){var n;return e&&e.state?(n=e.state,e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=S,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new t.Buf32(Q),n.distcode=n.distdyn=new t.Buf32($),n.sane=1,n.back=-1,f):h}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ne(e)):h}function re(e,t){var n,o;return e&&e.state?(o=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,oe(e))):h}function ie(e,n){var o,r;return e?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=r,r.window=null,(o=re(e,n))!==f&&(e.state=null),o):h}var ae,se,le=!0;function ue(e){if(le){var n;for(ae=new t.Buf32(512),se=new t.Buf32(32),n=0;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(i(s,e.lens,0,288,ae,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;i(l,e.lens,0,32,se,0,e.work,{bits:5}),le=!1}e.lencode=ae,e.lenbits=9,e.distcode=se,e.distbits=5}exports.inflateReset=oe,exports.inflateReset2=re,exports.inflateResetKeep=ne,exports.inflateInit=function(e){return ie(e,ee)},exports.inflateInit2=ie,exports.inflate=function(e,Q){var $,ee,ne,oe,re,ie,ae,se,le,ce,de,fe,pe,me,he,ge,be,ye,ve,Se,Ne,Ce,we,xe,Ee=0,Te=new t.Buf8(4),Oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;($=e.state).mode===D&&($.mode=_),re=e.next_out,ne=e.output,ae=e.avail_out,oe=e.next_in,ee=e.input,ie=e.avail_in,se=$.hold,le=$.bits,ce=ie,de=ae,Ce=f;e:for(;;)switch($.mode){case S:if(0===$.wrap){$.mode=_;break}for(;le<16;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(2&$.wrap&&35615===se){$.check=0,Te[0]=255&se,Te[1]=se>>>8&255,$.check=o($.check,Te,2,0),se=0,le=0,$.mode=N;break}if($.flags=0,$.head&&($.head.done=!1),!(1&$.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",$.mode=J;break}if((15&se)!==v){e.msg="unknown compression method",$.mode=J;break}if(le-=4,Ne=8+(15&(se>>>=4)),0===$.wbits)$.wbits=Ne;else if(Ne>$.wbits){e.msg="invalid window size",$.mode=J;break}$.dmax=1<<Ne,e.adler=$.check=1,$.mode=512&se?R:D,se=0,le=0;break;case N:for(;le<16;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if($.flags=se,(255&$.flags)!==v){e.msg="unknown compression method",$.mode=J;break}if(57344&$.flags){e.msg="unknown header flags set",$.mode=J;break}$.head&&($.head.text=se>>8&1),512&$.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,$.check=o($.check,Te,2,0)),se=0,le=0,$.mode=C;case C:for(;le<32;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.head&&($.head.time=se),512&$.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,Te[2]=se>>>16&255,Te[3]=se>>>24&255,$.check=o($.check,Te,4,0)),se=0,le=0,$.mode=w;case w:for(;le<16;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.head&&($.head.xflags=255&se,$.head.os=se>>8),512&$.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,$.check=o($.check,Te,2,0)),se=0,le=0,$.mode=x;case x:if(1024&$.flags){for(;le<16;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.length=se,$.head&&($.head.extra_len=se),512&$.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,$.check=o($.check,Te,2,0)),se=0,le=0}else $.head&&($.head.extra=null);$.mode=E;case E:if(1024&$.flags&&((fe=$.length)>ie&&(fe=ie),fe&&($.head&&(Ne=$.head.extra_len-$.length,$.head.extra||($.head.extra=new Array($.head.extra_len)),t.arraySet($.head.extra,ee,oe,fe,Ne)),512&$.flags&&($.check=o($.check,ee,fe,oe)),ie-=fe,oe+=fe,$.length-=fe),$.length))break e;$.length=0,$.mode=T;case T:if(2048&$.flags){if(0===ie)break e;fe=0;do{Ne=ee[oe+fe++],$.head&&Ne&&$.length<65536&&($.head.name+=String.fromCharCode(Ne))}while(Ne&&fe<ie);if(512&$.flags&&($.check=o($.check,ee,fe,oe)),ie-=fe,oe+=fe,Ne)break e}else $.head&&($.head.name=null);$.length=0,$.mode=O;case O:if(4096&$.flags){if(0===ie)break e;fe=0;do{Ne=ee[oe+fe++],$.head&&Ne&&$.length<65536&&($.head.comment+=String.fromCharCode(Ne))}while(Ne&&fe<ie);if(512&$.flags&&($.check=o($.check,ee,fe,oe)),ie-=fe,oe+=fe,Ne)break e}else $.head&&($.head.comment=null);$.mode=A;case A:if(512&$.flags){for(;le<16;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(se!==(65535&$.check)){e.msg="header crc mismatch",$.mode=J;break}se=0,le=0}$.head&&($.head.hcrc=$.flags>>9&1,$.head.done=!0),e.adler=$.check=0,$.mode=D;break;case R:for(;le<32;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}e.adler=$.check=te(se),se=0,le=0,$.mode=P;case P:if(0===$.havedict)return e.next_out=re,e.avail_out=ae,e.next_in=oe,e.avail_in=ie,$.hold=se,$.bits=le,m;e.adler=$.check=1,$.mode=D;case D:if(Q===c||Q===d)break e;case _:if($.last){se>>>=7&le,le-=7&le,$.mode=Z;break}for(;le<3;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}switch($.last=1&se,le-=1,3&(se>>>=1)){case 0:$.mode=k;break;case 1:if(ue($),$.mode=L,Q===d){se>>>=2,le-=2;break e}break;case 2:$.mode=M;break;case 3:e.msg="invalid block type",$.mode=J}se>>>=2,le-=2;break;case k:for(se>>>=7&le,le-=7&le;le<32;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",$.mode=J;break}if($.length=65535&se,se=0,le=0,$.mode=I,Q===d)break e;case I:$.mode=F;case F:if(fe=$.length){if(fe>ie&&(fe=ie),fe>ae&&(fe=ae),0===fe)break e;t.arraySet(ne,ee,oe,fe,re),ie-=fe,oe+=fe,ae-=fe,re+=fe,$.length-=fe;break}$.mode=D;break;case M:for(;le<14;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if($.nlen=257+(31&se),se>>>=5,le-=5,$.ndist=1+(31&se),se>>>=5,le-=5,$.ncode=4+(15&se),se>>>=4,le-=4,$.nlen>286||$.ndist>30){e.msg="too many length or distance symbols",$.mode=J;break}$.have=0,$.mode=B;case B:for(;$.have<$.ncode;){for(;le<3;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.lens[Oe[$.have++]]=7&se,se>>>=3,le-=3}for(;$.have<19;)$.lens[Oe[$.have++]]=0;if($.lencode=$.lendyn,$.lenbits=7,we={bits:$.lenbits},Ce=i(a,$.lens,0,19,$.lencode,0,$.work,we),$.lenbits=we.bits,Ce){e.msg="invalid code lengths set",$.mode=J;break}$.have=0,$.mode=U;case U:for(;$.have<$.nlen+$.ndist;){for(;Ee=$.lencode[se&(1<<$.lenbits)-1],ge=Ee>>>16&255,be=65535&Ee,!((he=Ee>>>24)<=le);){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(be<16)se>>>=he,le-=he,$.lens[$.have++]=be;else{if(16===be){for(xe=he+2;le<xe;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(se>>>=he,le-=he,0===$.have){e.msg="invalid bit length repeat",$.mode=J;break}Ne=$.lens[$.have-1],fe=3+(3&se),se>>>=2,le-=2}else if(17===be){for(xe=he+3;le<xe;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}le-=he,Ne=0,fe=3+(7&(se>>>=he)),se>>>=3,le-=3}else{for(xe=he+7;le<xe;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}le-=he,Ne=0,fe=11+(127&(se>>>=he)),se>>>=7,le-=7}if($.have+fe>$.nlen+$.ndist){e.msg="invalid bit length repeat",$.mode=J;break}for(;fe--;)$.lens[$.have++]=Ne}}if($.mode===J)break;if(0===$.lens[256]){e.msg="invalid code -- missing end-of-block",$.mode=J;break}if($.lenbits=9,we={bits:$.lenbits},Ce=i(s,$.lens,0,$.nlen,$.lencode,0,$.work,we),$.lenbits=we.bits,Ce){e.msg="invalid literal/lengths set",$.mode=J;break}if($.distbits=6,$.distcode=$.distdyn,we={bits:$.distbits},Ce=i(l,$.lens,$.nlen,$.ndist,$.distcode,0,$.work,we),$.distbits=we.bits,Ce){e.msg="invalid distances set",$.mode=J;break}if($.mode=L,Q===d)break e;case L:$.mode=z;case z:if(ie>=6&&ae>=258){e.next_out=re,e.avail_out=ae,e.next_in=oe,e.avail_in=ie,$.hold=se,$.bits=le,r(e,de),re=e.next_out,ne=e.output,ae=e.avail_out,oe=e.next_in,ee=e.input,ie=e.avail_in,se=$.hold,le=$.bits,$.mode===D&&($.back=-1);break}for($.back=0;Ee=$.lencode[se&(1<<$.lenbits)-1],ge=Ee>>>16&255,be=65535&Ee,!((he=Ee>>>24)<=le);){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(ge&&0==(240&ge)){for(ye=he,ve=ge,Se=be;Ee=$.lencode[Se+((se&(1<<ye+ve)-1)>>ye)],ge=Ee>>>16&255,be=65535&Ee,!(ye+(he=Ee>>>24)<=le);){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}se>>>=ye,le-=ye,$.back+=ye}if(se>>>=he,le-=he,$.back+=he,$.length=be,0===ge){$.mode=V;break}if(32&ge){$.back=-1,$.mode=D;break}if(64&ge){e.msg="invalid literal/length code",$.mode=J;break}$.extra=15&ge,$.mode=H;case H:if($.extra){for(xe=$.extra;le<xe;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.length+=se&(1<<$.extra)-1,se>>>=$.extra,le-=$.extra,$.back+=$.extra}$.was=$.length,$.mode=W;case W:for(;Ee=$.distcode[se&(1<<$.distbits)-1],ge=Ee>>>16&255,be=65535&Ee,!((he=Ee>>>24)<=le);){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(0==(240&ge)){for(ye=he,ve=ge,Se=be;Ee=$.distcode[Se+((se&(1<<ye+ve)-1)>>ye)],ge=Ee>>>16&255,be=65535&Ee,!(ye+(he=Ee>>>24)<=le);){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}se>>>=ye,le-=ye,$.back+=ye}if(se>>>=he,le-=he,$.back+=he,64&ge){e.msg="invalid distance code",$.mode=J;break}$.offset=be,$.extra=15&ge,$.mode=j;case j:if($.extra){for(xe=$.extra;le<xe;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}$.offset+=se&(1<<$.extra)-1,se>>>=$.extra,le-=$.extra,$.back+=$.extra}if($.offset>$.dmax){e.msg="invalid distance too far back",$.mode=J;break}$.mode=X;case X:if(0===ae)break e;if(fe=de-ae,$.offset>fe){if((fe=$.offset-fe)>$.whave&&$.sane){e.msg="invalid distance too far back",$.mode=J;break}fe>$.wnext?(fe-=$.wnext,pe=$.wsize-fe):pe=$.wnext-fe,fe>$.length&&(fe=$.length),me=$.window}else me=ne,pe=re-$.offset,fe=$.length;fe>ae&&(fe=ae),ae-=fe,$.length-=fe;do{ne[re++]=me[pe++]}while(--fe);0===$.length&&($.mode=z);break;case V:if(0===ae)break e;ne[re++]=$.length,ae--,$.mode=z;break;case Z:if($.wrap){for(;le<32;){if(0===ie)break e;ie--,se|=ee[oe++]<<le,le+=8}if(de-=ae,e.total_out+=de,$.total+=de,de&&(e.adler=$.check=$.flags?o($.check,ne,de,re-de):n($.check,ne,de,re-de)),de=ae,($.flags?se:te(se))!==$.check){e.msg="incorrect data check",$.mode=J;break}se=0,le=0}$.mode=K;case K:if($.wrap&&$.flags){for(;le<32;){if(0===ie)break e;ie--,se+=ee[oe++]<<le,le+=8}if(se!==(4294967295&$.total)){e.msg="incorrect length check",$.mode=J;break}se=0,le=0}$.mode=q;case q:Ce=p;break e;case J:Ce=g;break e;case G:return b;case Y:default:return h}return e.next_out=re,e.avail_out=ae,e.next_in=oe,e.avail_in=ie,$.hold=se,$.bits=le,($.wsize||de!==e.avail_out&&$.mode<J&&($.mode<Z||Q!==u))&&function(e,n,o,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new t.Buf8(a.wsize)),r>=a.wsize?(t.arraySet(a.window,n,o-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),t.arraySet(a.window,n,o-r,i,a.wnext),(r-=i)?(t.arraySet(a.window,n,o-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}(e,e.output,e.next_out,de-e.avail_out)?($.mode=G,b):(ce-=e.avail_in,de-=e.avail_out,e.total_in+=ce,e.total_out+=de,$.total+=de,$.wrap&&de&&(e.adler=$.check=$.flags?o($.check,ne,de,e.next_out-de):n($.check,ne,de,e.next_out-de)),e.data_type=$.bits+($.last?64:0)+($.mode===D?128:0)+($.mode===L||$.mode===I?256:0),(0===ce&&0===de||Q===u)&&Ce===f&&(Ce=y),Ce)},exports.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,f},exports.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?h:(n.head=t,t.done=!1,f):h},exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,module,exports){var t=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],i=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function(e,a,s,l,u,c,d,f){var p,m,h,g,b,y,v,S,N,C=f.bits,w=0,x=0,E=0,T=0,O=0,A=0,R=0,P=0,D=0,_=0,k=null,I=0,F=new t.Buf16(16),M=new t.Buf16(16),B=null,U=0;for(w=0;w<=15;w++)F[w]=0;for(x=0;x<l;x++)F[a[s+x]]++;for(O=C,T=15;T>=1&&0===F[T];T--);if(O>T&&(O=T),0===T)return u[c++]=20971520,u[c++]=20971520,f.bits=1,0;for(E=1;E<T&&0===F[E];E++);for(O<E&&(O=E),P=1,w=1;w<=15;w++)if(P<<=1,(P-=F[w])<0)return-1;if(P>0&&(0===e||1!==T))return-1;for(M[1]=0,w=1;w<15;w++)M[w+1]=M[w]+F[w];for(x=0;x<l;x++)0!==a[s+x]&&(d[M[a[s+x]]++]=x);if(0===e?(k=B=d,y=19):1===e?(k=n,I-=257,B=o,U-=257,y=256):(k=r,B=i,y=-1),_=0,x=0,w=E,b=c,A=O,R=0,h=-1,g=(D=1<<O)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){v=w-R,d[x]<y?(S=0,N=d[x]):d[x]>y?(S=B[U+d[x]],N=k[I+d[x]]):(S=96,N=0),p=1<<w-R,E=m=1<<A;do{u[b+(_>>R)+(m-=p)]=v<<24|S<<16|N|0}while(0!==m);for(p=1<<w-1;_&p;)p>>=1;if(0!==p?(_&=p-1,_+=p):_=0,x++,0==--F[w]){if(w===T)break;w=a[s+d[x]]}if(w>O&&(_&g)!==h){for(0===R&&(R=O),b+=E,P=1<<(A=w-R);A+R<T&&!((P-=F[A+R])<=0);)A++,P<<=1;if(D+=1<<A,1===e&&D>852||2===e&&D>592)return 1;u[h=_&g]=O<<24|A<<16|b-c|0}}return 0!==_&&(u[b+_]=w-R<<24|64<<16|0),f.bits=O,0}},{"../utils/common":27}],37:[function(e,module,exports){module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,module,exports){var t=e("../utils/common"),n=4,o=0,r=1,i=2;function a(e){for(var t=e.length;--t>=0;)e[t]=0}var s=0,l=1,u=2,c=29,d=256,f=d+1+c,p=30,m=19,h=2*f+1,g=15,b=16,y=7,v=256,S=16,N=17,C=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(f+2));a(O);var A=new Array(2*p);a(A);var R=new Array(512);a(R);var P=new Array(256);a(P);var D=new Array(c);a(D);var _=new Array(p);a(_);var k,I,F,M=function(e,t,n,o,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=r,this.has_stree=e&&e.length},B=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t};function U(e){return e<256?R[e]:R[256+(e>>>7)]}function L(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function z(e,t,n){e.bi_valid>b-n?(e.bi_buf|=t<<e.bi_valid&65535,L(e,e.bi_buf),e.bi_buf=t>>b-e.bi_valid,e.bi_valid+=n-b):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function H(e,t,n){z(e,n[2*t],n[2*t+1])}function W(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function j(e,t,n){var o,r,i=new Array(g+1),a=0;for(o=1;o<=g;o++)i[o]=a=a+n[o-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=W(i[s]++,s))}}function X(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function V(e){e.bi_valid>8?L(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,n,o){var r=2*t,i=2*n;return e[r]<e[i]||e[r]===e[i]&&o[t]<=o[n]}function K(e,t,n){for(var o=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&Z(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Z(t,o,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=o}function q(e,t,n){var o,r,i,a,s=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===o?H(e,r,t):(i=P[r],H(e,i+d+1,t),0!==(a=w[i])&&(r-=D[i],z(e,r,a)),i=U(--o),H(e,i,n),0!==(a=x[i])&&(o-=_[i],z(e,o,a)))}while(s<e.last_lit);H(e,v,t)}function J(e,t){var n,o,r,i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=h,n=0;n<l;n++)0!==i[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=u<2?++u:0,i[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)K(e,i,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,i[2*r]=i[2*n]+i[2*o],e.depth[r]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,i[2*n+1]=i[2*o+1]=r,e.heap[1]=r++,K(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,o,r,i,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,b=0;for(i=0;i<=g;i++)e.bl_count[i]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<h;n++)o=e.heap[n],(i=l[2*l[2*o+1]+1]+1)>m&&(i=m,b++),l[2*o+1]=i,o>u||(e.bl_count[i]++,a=0,o>=p&&(a=f[o-p]),s=l[2*o],e.opt_len+=s*(i+a),d&&(e.static_len+=s*(c[2*o+1]+a)));if(0!==b){do{for(i=m-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[m]--,b-=2}while(b>0);for(i=m;0!==i;i--)for(o=e.bl_count[i];0!==o;)(r=e.heap[--n])>u||(l[2*r+1]!==i&&(e.opt_len+=(i-l[2*r+1])*l[2*r],l[2*r+1]=i),o--)}}(e,t),j(i,u,e.bl_count)}function G(e,t,n){var o,r,i=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)r=a,a=t[2*(o+1)+1],++s<l&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==i&&e.bl_tree[2*r]++,e.bl_tree[2*S]++):s<=10?e.bl_tree[2*N]++:e.bl_tree[2*C]++,s=0,i=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4))}function Y(e,t,n){var o,r,i=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),o=0;o<=n;o++)if(r=a,a=t[2*(o+1)+1],!(++s<l&&r===a)){if(s<u)do{H(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==i&&(H(e,r,e.bl_tree),s--),H(e,S,e.bl_tree),z(e,s-3,2)):s<=10?(H(e,N,e.bl_tree),z(e,s-3,3)):(H(e,C,e.bl_tree),z(e,s-11,7));s=0,i=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4)}}var Q=!1;function $(e,n,o,r){z(e,(s<<1)+(r?1:0),3),function(e,n,o,r){V(e),r&&(L(e,o),L(e,~o)),t.arraySet(e.pending_buf,e.window,n,o,e.pending),e.pending+=o}(e,n,o,!0)}exports._tr_init=function(e){Q||(function(){var e,t,n,o,r,i=new Array(g+1);for(n=0,o=0;o<c-1;o++)for(D[o]=n,e=0;e<1<<w[o];e++)P[n++]=o;for(P[n-1]=o,r=0,o=0;o<16;o++)for(_[o]=r,e=0;e<1<<x[o];e++)R[r++]=o;for(r>>=7;o<p;o++)for(_[o]=r<<7,e=0;e<1<<x[o]-7;e++)R[256+r++]=o;for(t=0;t<=g;t++)i[t]=0;for(e=0;e<=143;)O[2*e+1]=8,e++,i[8]++;for(;e<=255;)O[2*e+1]=9,e++,i[9]++;for(;e<=279;)O[2*e+1]=7,e++,i[7]++;for(;e<=287;)O[2*e+1]=8,e++,i[8]++;for(j(O,f+1,i),e=0;e<p;e++)A[2*e+1]=5,A[2*e]=W(e,5);k=new M(O,w,d+1,f,g),I=new M(A,x,0,p,g),F=new M(new Array(0),E,0,m,y)}(),Q=!0),e.l_desc=new B(e.dyn_ltree,k),e.d_desc=new B(e.dyn_dtree,I),e.bl_desc=new B(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,X(e)},exports._tr_stored_block=$,exports._tr_flush_block=function(e,t,a,s){var c,f,p=0;e.level>0?(e.strm.data_type===i&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return r;for(t=32;t<d;t++)if(0!==e.dyn_ltree[2*t])return r;return o}(e)),J(e,e.l_desc),J(e,e.d_desc),p=function(e){var t;for(G(e,e.dyn_ltree,e.l_desc.max_code),G(e,e.dyn_dtree,e.d_desc.max_code),J(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*T[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),c=e.opt_len+3+7>>>3,(f=e.static_len+3+7>>>3)<=c&&(c=f)):c=f=a+5,a+4<=c&&-1!==t?$(e,t,a,s):e.strategy===n||f===c?(z(e,(l<<1)+(s?1:0),3),q(e,O,A)):(z(e,(u<<1)+(s?1:0),3),function(e,t,n,o){var r;for(z(e,t-257,5),z(e,n-1,5),z(e,o-4,4),r=0;r<o;r++)z(e,e.bl_tree[2*T[r]+1],3);Y(e,e.dyn_ltree,t-1),Y(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,p+1),q(e,e.dyn_ltree,e.dyn_dtree)),X(e),s&&V(e)},exports._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+d+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},exports._tr_align=function(e){z(e,l<<1,3),H(e,v,O),function(e){16===e.bi_valid?(L(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,module,exports){module.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9),{runtime:runtime,odf:odf}});
//# sourceMappingURL=sourcemaps/webodf.js.map
